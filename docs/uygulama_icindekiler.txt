CringeBank Uygulama Icindekiler
===============================

Uygulama Icindekiler Rev1

GENEL DEĞİŞİKLİK

CringeGold (CG): Artık sadece uygulama içi dijital değer birimi olarak kullanılacaktır.

Veri Katmanı: Hibrit mimarideki tüm raporlama, operasyonel SQL ve finansal kayıtlar Azure SQL (serverless) üzerinde konsolide edildi; Firestore gerçek zamanlı deneyim ve kullanıcı ayarları için kullanılmaya devam eder.

CG ile sadece içerik öne çıkarma, rozet alma, yarışma katılımı gibi işlemler yapılabilir.

CG ile ürün satışı yapılamaz.

Kullanıcı Ürün Satışları: Sıfır ve 2. el ürün satışları yalnızca canlı para (TL, USD, EUR) ile gerçekleşecektir.

CG ile ödeme bu işlemlerde geçerli değildir.

Tüm satışlar için ödeme altyapısı kullanılacaktır (örneğin: iyzico, PayTR, Stripe).

PROJE TODO DURUM ÖZETİ

FRONTEND TODO DURUMU (20 Ekim 2025)

Mevcut liste `docs/frontend_todo.md` ile senkron. Kayıt, login, feed, etiketleme, tema, durum yönetimi, telemetri ve test modüllerinin tamamı Flutter tarafında kapatıldı. Konfigürasyon ve dokümantasyon eşitlemeleri de güncel. Yeni gereksinim çıkmadıkça açık görev bulunmuyor; olası eklemeler bu dosyaya ve ilgili TODO listesine yansıtılacak.

BACKEND TODO DURUMU (20 Ekim 2025)

Kaynak: `docs/backend_todo.md`. Tamamlananlar arasında Azure IaC paketleri, ortam yapılandırmaları, Managed Identity rehberi ile auth & social EF Core entity/migration + varsayılan RBAC seed altyapısı yer alıyor. Öncelikli açık başlıklar aşağıda özetlenmiştir:

- Veritabanı ve EF Core: auth/social/chat/wallet migration paketleri ile migration test koleksiyonu kapatıldı; sıradaki iş domain aggregate düzeni ve ek otomasyonlar.
- Domain & Application katmanı: aggregate/value object düzeni, CQRS command/query handler yapısı, validation kuralları ve Mapster tabanlı DTO/mapper katmanı tamamlandı; domain event altyapısı (dispatcher + handler seti) 20 Ekim 2025 itibarıyla üretimde.
- Domain aggregate çalışmaları: AuthUser, AuthUserProfile, SocialPost, Conversation, WalletAccount ve Order için value object tabanlı domain metotları eklendi; kalan CQRS/validation katmanı için hazırlık sürüyor (20 Ekim 2025).
- Application katmanı: Komut/sorgu arayüzleri, dispatcher, FluentValidation pipeline'ı, Firebase kullanıcı senkronizasyon komutu ve public profil okuma sorgusu hazır; diğer handler ve kural setleri sırada (20 Ekim 2025).
- API yüzeyi: Auth, Profile, Feed, Chat, Wallet ve Admin controller’ları ile Swagger/OpenAPI dokümantasyonunun yayınlanması.
- Güvenlik ve gözlemlenebilirlik: JWT anahtar rotasyonu, refresh token revoke, merkezi RBAC policy evaluator, rate limiting, Serilog/OTel entegrasyonu, health check ve metrik uçları.
- Entegrasyon, otomasyon ve test: Firebase↔Azure SQL senkron işleri, ödeme adapterleri, bildirim servisi tetikleyicileri, unit/integration/load test setleri, CI/CD pipeline’larının genişletilmesi ve veri göçü senaryoları.

CRINGESTORE MODÜLÜ (PAZAR YERİ)

Yeni İşleyiş:

Ürünler canlı para ile listelenir ve satın alınır.

Uygulama her satıştan otomatik olarak %10 komisyon alır.

Komisyonlar doğrudan uygulamanın "kazanç" havuzuna aktarılır.

Satıcılar ödeme almak için IBAN bilgisi girer.

Ödemeler manuel onaylı veya otomatik periyotlarla gerçekleştirilir (haftalık/aylık).

Yasal Sorumluluklar:

Tüm satışlar faturalandırmaya ve yasal kayıtlamaya tabidir.

Satıcı vergi yükümlülüğünden kendisi sorumludur.

CringeBank yalnızca platform aracılığı ve komisyon alımı yapar.

Kullanıcı, satış yapmadan önce "Satıcı Kullanım Sözleşmesi"ni onaylar.

ÖDEME & CÜZDAN SİSTEMİ (azure + FIRESTORE)

Cüzdan Yapısı Ayrıştırıldı:

cgBalance: Kullanıcının CG bakiyesi (sadece uygulama içi kullanım için)

fiatBalance / totalEarnings: Kullanıcının TL/USD/EUR cinsinden kazancı

payoutHistory: Ödeme geçmişi

Fiat Ödeme Detayları:

Tüm canlı para işlemleri azure tarafında Transactions, Orders, Payouts tablosunda izlenir.

Satın alma, iade, komisyon kesintisi ve ödeme işlemleri bu sistemde takip edilir.

SATIŞ YAPAN KULLANICILAR İÇİN EK AYARLAR

Satıcı Profili İçeriği:

Ad Soyad

TC Kimlik No / Vergi No (opsiyonel ama önerilir)

IBAN

Satıcı Tipi: Bireysel / Kurumsal (ileride ayrıştırma yapılabilir)

Yeni Ayar Sekmeleri:

"Satıcı Paneli"

Ürün ekle, düzenle, sil

Siparişleri yönet

Gelirleri takip et

Öne çıkarma için CG kullan

"Ödeme Ayarları"

IBAN ekle/değiştir

Otomatik ödeme talimatı ver

YASAL & KVKK GÜNCELLEMELERİ

Kullanıcılar satış yapmaya başlamadan önce, "Canlı Para ile Satış Sözleşmesi"ni onaylar.

Tüm kullanıcı satış verileri KVKK/GDPR’ye uygun şekilde işlenir.

Satıcı kendi adına fatura keser veya aracı ödeme platformunun sunduğu e-fatura sistemine yönlendirilir.

Uyarı Metni:

Bu platform üzerinden ürün satışı yapan kullanıcılar, ilgili ülke vergi kanunlarına göre yükümlülük altındadır. CringeBank sadece komisyon alır, satıcının vergi ve yasal bildirimlerini yapmaz.

DİĞER GÜNCELLEMELER

Ana sayfa sponsorlu gönderi öne çıkarma alanları CG ile çalışmaya devam eder.

Yarışmalara katılımda CG geçerliliği korunur.

Satışlar ile ilgili tüm işlem geçmişi Firestore yerine azure tarafında tutulur.

Not: Bu revizyon ile birlikte tüm "CG ile ürün satışı" içeren açıklamalar, UI metinleri ve yardım belgeleri güncellenmelidir.

Son Güncelleme: 12 Ekim 2025 Yapan: Ümit Yeke / Moonpik Yazılım

UYGULAMA RESPONSİVE OLACAK

CringeBank İşleyiş

1 - Kayıt Paneli : 
Amaç: Yeni kullanıcıların minimum sürtünme ile güvenli, hızlı ve yasalara uygun şekilde hesap oluşturmasını sağlamak.
Kapsam: E-posta/telefon ile kayıt, OTP doğrulama, kullanıcı adı seçimi, temel profil, sözleşme onayları, hibrit mimari (Firebase Auth + Firestore + azure) senkronizasyonu, güvenlik/anti-abuse, loglama/izleme, geri alma/rollout.
b) Roller ve Yetkiler (Kayıt Bağlamı)
Anonim kullanıcı: Kayıt akışını başlatabilir, OTP isteyebilir, doğrulayabilir.
Yeni kayıtlı kullanıcı: Varsayılan rol “user”. Giriş yapar, profilini görebilir.
Admin/Super Admin: Kayıt verilerini raporlayabilir, şüpheli kayıtları inceleyebilir. (Rol ataması kayıt akışında yapılmaz, sonradan verilir.)
Not: Super Admin tüm profilleri görebilir (politika gereği); bu kayıt paneli kapsamına yalnızca “rol alanları için placeholder/claim hazırlığı” girer. umityeke@gmail.com
c) Uçtan Uca Kayıt Akışı (State Machine Mantığı)
Yöntem seçimi: “E-posta ile” veya “Telefon ile”.
Kimlik girişi: E-posta/Telefon + Şifre + Şifre Tekrarı. Bot koruması aktif (App Check / reCAPTCHA).
OTP üretimi ve gönderimi: Kanal (e-posta/SMS) bazlı. Cooldown + deneme limitleri uygulanır.
OTP doğrulama: Süreli tek kullanımlık kod (örn. 2 dk). Başarılı olursa “kimlik doğrulandı” durumuna geçilir.
Kullanıcı adı seçimi: Kurallara uygunluk + benzersizlik kontrolü (banlı/rezerve isimler).
Temel profil ve onaylar: Ad-Soyad, doğum yılı (≥13), ülke/şehir; sözleşme onayları (Kullanım Şartları, KVKK zorunlu; pazarlama opsiyonel).
Hesap oluşturma ve senkron: Firebase’de kullanıcı; Firestore’da profil; azure rapor/arama/denetim için kaydı aç; cüzdan hazırlığı.
Claims & Policy set: claims_version, policy_version, locale vb. ayarlanır.
Onboarding: Hoş geldin ekranı, temel tercihlerin alınması (opsiyonel).
Çıkış koşulları: Başarılı tamamlandı / Kullanıcı vazgeçti / Limit aşıldı / Güvenlik politikası tetiklendi (örn. disposable e-posta).
d) Ekranlar ve Durumlar (Kullanıcı Deneyimi)
Ekran A – Kimlik ve Şifre
Alanlar: e-posta veya telefon, şifre, şifre tekrar.
Durumlar: “Devam” butonu yalnızca tüm yerel validasyonlar geçince aktif.
Hata durumları: geçersiz format, zayıf şifre, bot koruması başarısız, disposable domain.
Ekran B – Doğrulama (OTP)
6 haneli kod alanı.
“Yeniden gönder” butonu 60 sn cooldown; günlük resend limiti var.
Kalan süre ve deneme sayacı görünür.
Ekran C – Kullanıcı Adı
Kural setine göre anında geri bildirim (başta harf, 3–20 karakter, küçük harf, nokta/alt çizgi kuralları).
Benzersizlik ve banlı liste kontrolü.
Ekran D – Profil & Onaylar
Ad-Soyad, doğum yılı, ülke/şehir.
Zorunlu onaylar (Kullanım Şartları, KVKK) işaretlenmeden buton pasif.
Pazarlama izni opsiyonel; varsayılan “kapalı”.
Ekran E – Tamamlandı / Hoş Geldin
Kısa başarı mesajı.
(Opsiyonel) “Profil fotoğrafı yükle”, “Kullanım rehberi”, “Bildirim tercihleri”.
e) Form Alanları ve Kurallar (İş Kuralları)
E-posta: Standart formata uygun olmalı; disposable/tek kullanımlık domain listesi reddedilir; MX kontrolü sunucu tarafında yapılır.
Telefon: E.164 formatı; ülkeye göre maskeleme (UI); doğrulama SMS’i aynı ülke formatında gönderildiği teyit edilir.
Şifre: Minimum 10 karakter; küçük/büyük/sayı/sembolden en az üç sınıf; yaygın/zayıf/parola sızıntısı listesine takılırsa reddedilir (k-anonimlik yaklaşımıyla).
Kullanıcı adı: Küçük harf/harfle başlar; nokta/alt çizgi ikili tekrar yok; baş/sonda nokta/alt çizgi yok; 3–20 karakter; banlı/rezerve isimler ve küfür listesi reddedilir; normalize edilmiş anahtar benzersiz olmalı.
Ad-Soyad: 2–60 karakter; emoji/URL/spam karakterleri reddedilir.
Yaş kontrolü: Doğum yılına göre ≥13 zorunlu; aksi halde kayıt tamamlanmaz.
Onaylar: Kullanım Şartları ve KVKK zorunlu; bu metinlerin versiyon numarası ve hash’i kabul log’unda saklanır; Pazarlama izni açık/seçili gelmez.
f) Güvenlik, Kötüye Kullanım Önleme ve Limitler
Bot koruması: Mobilde App Check; web’de reCAPTCHA (gerekirse v3→v2 fallback).
OTP politikası:
Deneme limiti: kanal başına günlük toplam doğrulama denemeleri (ör. 5).
Yeniden gönderim limiti: günlük toplam resend (ör. 3); arada 60 sn bekleme.
OTP geçerlilik süresi: e-posta için 2 dk (öneri), SMS için 2 dk.
Oran sınırlama (Rate limit):
Kayıt başlatma (IP + cihaz + e-posta/telefon hash): ör. 10/60 dk.
OTP doğrulama: ör. 15/60 dk/hesap.
Disposable e-posta reddi: Liste güncel tutulur; şüpheli alan adları “manuel gözden geçirme kuyruğu”na düşebilir.
Şifre sızıntı kontrolü: Bilinen sızıntı örüntüsü yakalanırsa kullanıcıdan farklı parola istenir.
Cihaz bağlama (opsiyonel): İlk oturumda cihaz parmak izi hash’i ilişkilendirilebilir (güven puanı).
Şüpheli davranış: Aynı IP/deviceden yüksek hacim, çoklu başarısız deneme veya çoklu hesap açma girişimi otomatik engel/gözden geçirme tetikler.
g) Hibrit Mimari İşleyişi (Kod Yok – Adımsal Mantık)
Kim doğrular? Kimlik/doğrulama Firebase Auth üzerinden; gerçek zamanlı profil Firestore’da; raporlama/arama/denetim amaçlı veriler Azure SQL veritabanında tutulur.
Önerilen çağrı sırası:
Kayıt girişinin ön kontrolü (rate limit, disposable kontrol, bot koruması).
OTP üretimi ve gönderimi; geçici başvuru kaydı (durum: “OTP bekliyor”).
OTP doğrulanınca Auth’ta kullanıcı oluşturulur (doğrulama bayrağı işaretli).
Kullanıcı adı/profil/onaylar tamamlanır; Firestore’da profil dokümanı açılır.
Azure SQL veritabanı tarafında “Kullanıcılar/Profiler/Usernames/Consents” gibi gerekli kayıtlar oluşturulur.
Not: Mevcut tablolar (ör. Wallets) ile ilişki kurulur; yeni kullanıcıya varsayılan cüzdan satırı hazırlanır (bakiye 0).
Claims ve policy versiyonları set edilir; locale kullanıcı cihaz dilinden alınır.
Senkron stratejisi:
Tercihen event/outbox yaklaşımı: “UserCreated” benzeri bir olay, idempotent çalışan senkronizasyon işleyicisi tarafından Azure SQL veritabanına işlenir.
Tekrarlı çağrıların çift kayıt açmaması için “istek kimliği” (idempotency key) zorunlu tutulur.
h) Claims ve Politika Sürümleme
Claims: role=user, email_verified/phone_verified, locale, claims_version.
Politikalar: terms_version ve privacy/kvkk_version zorunlu; pazarlama izni ayrı sürümlenir.
Sürüm değişikliği etkisi: Yeni sürüm çıktığında, eski sürümü onaylayan kullanıcılar ilk girişte “onay yenileme” ekranına yönlendirilebilir.
i) KVKK / Gizlilik / Hukuki
Aydınlatma ve onay: Kayıt sırasında kısa özet + detay sayfası linki; onay kutuları açık gelmez.
Kayıt: Hangi metin/versiyon, kabul zamanı, IP ve user-agent hash’i.
Veri minimizasyonu: Zorunlu alanlar dışında veri talep edilmez; pazarlama izni opsiyoneldir.
Silme/Talepler: Kullanıcı verisi silme/indir talebi akışı ayrı süreçte tanımlı (kayıt panelinin kapsamına girmez; sadece referans verilir).
j) Hata Senaryoları ve Kullanıcı Mesajları (Örnek Ton)
OTP süresi doldu: “Doğrulama süren doldu. Tekrar kod isteyebilirsin.”
Yanlış OTP: “Kod eşleşmedi. Kalan deneme: X.”
Limit aşıldı: “Güvenlik nedeniyle deneme limitine ulaşıldı. Daha sonra tekrar dene.”
Disposable e-posta: “Bu e-posta adresini kabul edemiyoruz. Lütfen farklı bir adres kullan.”
Kullanıcı adı uygun değil: “Kullanıcı adın yalnızca küçük harf, sayı, nokta ve alt çizgi içerebilir; harfle başlamalıdır.”
Zayıf parola: “Parola güvenlik kriterlerini karşılamıyor. Daha güçlü bir parola belirle.”
Sunucu sorunu: “Beklenmeyen bir hata oluştu. Kısa süre sonra tekrar dene.”
Mesajlar net, kısa, suçlayıcı olmayan ve kullanıcıyı çözüm yoluna yönlendiren tonda olmalı.
k) Kenar Uçlar (Edge Cases)
Aynı e-posta/telefonla eşzamanlı iki kayıt penceresi → en son onaylanan kazanır; önceki süreç iptal edilir.
OTP’yi çok geç girme → süre aşımı; yeniden gönderim kuralları devreye girer.
Ağ kesintisi → “kayıt durumunu sürdür” yaklaşımı; kullanıcı geri döndüğünde kaldığı adıma taşı (durum makinesi).
Cihaz değişimi → OTP doğrulandıktan sonra bile “kayıt tamamlanmadan” süreç başka cihazda devam ettirilememeli (opsiyonel kısıt).
Bölge/dil sapması → locale ve saat dilimi TRT/UTC+3 uyumlu loglanır, UI metinleri cihaz diline göre.
l) Loglama, Telemetri ve Audit
Kritik olaylar: Kayıt başlatıldı, OTP gönderildi, OTP doğrulandı (başarılı/başarısız), disposable reddi, kullanıcı adı reddi/kabulü, sözleşme onayı, kayıt tamamlandı.
Alanlar: zaman damgası, user id (varsa), başvuru id, IP hash, device id hash, kanal (e-posta/SMS), sonuç (success/fail), hata nedeni.
Gizlilik: IP ve cihaz parmak izi gibi hassas veriler hash’lenmiş/anonimleştirilmiş saklanır.
Kalite metrikleri: Kayıt dönüşüm oranı, OTP başarı oranı, ortalama süreler, p95 gecikmeler.
m) İzleme ve Alarmlar
OTP başarısızlık oranı (ör. 15 dk penceresinde %X eşiği) aşıldığında uyarı.
Kayıt akışı hata oranı (5xx) artışı uyarı.
Disposable e-posta kullanım oranı patlaması uyarı (spam dalgası göstergesi).
Rate limit tetiklenmeleri olağandışı yükselirse inceleme alarmı.
n) Performans ve Hedefler
Kayıt tamamlanma süresi: p95 < 90 sn (e-posta), p95 < 60 sn (SMS).
OTP teslim süresi: p95 < 10 sn (SMS), p95 < 30 sn (e-posta).
Kayıt-tamamlama dönüşümü: İlk hafta baz çizgisi alınır; deneyler ile artırılır.
Kullanıcı adı kontrol gecikmesi: p95 < 300 ms.
o) A/B ve Deney Alanları (Opsiyonel)
Telefon-öncelikli vs E-posta-öncelikli kayıt.
Kullanıcı adı seçimi sırası: OTP’den önce/sonra.
OTP uzunluğu/süresi: 6 vs 7 hane; 120 sn vs 90 sn.
Şifre politikası iletişimi: Rehberli (güç göstergesi) vs sade.
p) Test Planı (Pozitif/Negatif Senaryolar – Örnek Kimlikler)
Pozitif
REG-001: Geçerli e-posta + güçlü şifre + OTP başarı + benzersiz kullanıcı adı → kayıt tamam.
REG-002: Telefonla kayıt + OTP gecikmesi ama süre dolmadan doğrulama → tamam.
REG-003: Zorunlu sözleşmeler onaylı, pazarlama izni boş → tamam.
REG-004: Locale TR, saat dilimi +03; loglarda doğru işleniyor.
REG-005: Kayıt sonrası profil/claim/policy sürümleri doğru set, varsayılan cüzdan hazır.
Negatif
NEG-101: Disposable e-posta → reddedilir, net mesaj.
NEG-102: Zayıf şifre → reddedilir, rehber mesajı gösterilir.
NEG-103: OTP yanlış 5 kez → hesap/kanal geçici kilit.
NEG-104: OTP süresi dolmuş → yeniden gönderim akışı, cooldown uygulanır.
NEG-105: Kullanıcı adı uygunsuz (banlı kelime) → reddedilir.
NEG-106: Rate limit aşımı → 429 eşdeğeri hata ve bekleme uyarısı.
NEG-107: Ağ kesintisi (OTP ekranında) → geri dönünce kaldığı adım korunur.
NEG-108: Aynı e-posta ile eşzamanlı iki kayıt → birisi başarı, diğeri düzgün iptal.
Senkron/Veri Bütünlüğü
SYNC-201: Firestore profil oluşturulmuş, Azure SQL kayıtları eksiksiz (Usernames/Consents/Wallet).
SYNC-202: Outbox/event tekrar denense bile çift kayıt oluşmuyor (idempotency).
SYNC-203: Claims/policy sürümü kayıt sonrası UI’da görünür akışlarla tutarlı.
Güvenlik
SEC-301: reCAPTCHA/App Check olmadan kayıt yolu → engellenir.
SEC-302: Şüpheli hacimde OTP talebi → rate limit devreye girer.
SEC-303: Şifre sızıntı listesinde → reddedilir.
SEC-304: Loglarda PII gizliliği (IP hash vs) doğrulanır.
Erişilebilirlik/UX
A11Y-401: Odak sırası, ekran okuyucu etiketleri, hata mesajlarının duyurulması.
A11Y-402: Renk kontrastı ve klavye ile tamamlanabilir akış.
r) Test Verisi ve Senaryoların Hazırlanması
E-posta örnekleri: kurumsal, ücretsiz, türkçe karakter içeren adlar, disposable domain.
Telefon örnekleri: TR +90 ve farklı ülkeler, geçersiz uzunluk/başlangıç.
Kullanıcı adı: 3, 20, 21 karakter; nokta/alt çizgi kenar durumları; banlı liste.
Şifreler: çok zayıf, orta, güçlü; sızıntı listesinde bulunan örnek.
Ağ durumları: yavaş bağlantı, paket kaybı, offline/online geçişi.
s) Rollout, Geri Alma ve Özellik Bayrakları
Özellik bayrakları: Telefon-kayıt açık/kapalı, e-posta-kayıt açık/kapalı, pazarlama izni alanı göster/gizle.
Kademeli açılış: %5 → %25 → %100.
Geri alma: Hata oranı/başarı oranı eşiklerini aştığında otomatik bayrak kapatma.
Sürüm notu: claims_version/policy_version değişiklikleri belgelenir.
t) Raporlama ve Başarı Göstergeleri
Kayıt başlatan → OTP alan → OTP doğrulayan → kullanıcı adı seçen → tamamlayan hunisi.
Kanal bazında OTP başarı oranı (e-posta vs SMS).
Ortalama tamamlanma süresi, p95 gecikmeler.
Disposable reddi oranı, rate-limit tetiklenmeleri.
Haftalık cohort ile 1. gün/7. gün geri dönüş oranları (kayda doğrudan bağlı değil ama onboarding kalitesi için izlenir).
u) Veri Yapıları ve Tablolar (Açıklama Düzeyi – Şemasız)
Auth kullanıcı kaydı: e-posta/telefon doğrulama bayrakları.
Profil kaydı (Firestore): e-posta/telefon, kullanıcı adı (normalize edilmiş anahtar ile), ad-soyad, doğum yılı, ülke/şehir, locale, created/updated zamanları, claims_version, policy_version, consents, güvenlik meta.
Azure SQL tarafı (raporlama/arama):
Kullanıcı temel bilgileri (normalize anahtarlar, benzersiz kullanıcı adı),
Onaylar (hangi metin sürümü, zaman),
Cüzdan (varsa başlangıç satırı, bakiye 0),
Kayıt akışı telemetrisi (başlatma, OTP, tamamlanma).
v) UI Metin İlkeleri
Net, kısa, çözüm öneren dil.
Hata mesajlarında teknik detay yok; kullanıcıya eylem önerisi var.
Zorunlu alanlar yıldız veya “Zorunlu” etiketiyle belirtilir; gizlilik/onay metinleri kolay erişilebilir.
y) Bakım ve Operasyon
Disposable domain listesi düzenli güncellenir.
OTP sağlayıcı izlemesi: teslim gecikmeleri ve başarısızlıklarına karşı otomatik failover (varsa ikinci kanal).
Sürümleme: Policy/claims versiyon değişimlerinde UI metinleri ve yasal sayfalar senkron tutulur.
Denetim: Şüpheli kayıtlar için periyodik rapor; yüksek riskli kayıtların gözden geçirilmesi.
UYGULAMA RESPONSİVE OLACAK

2 - Login Paneli : Mail adresi ve şifre ile giriş yapılıyor.
a) Amaç & Kapsam
Amaç: Kullanıcıların güvenli, hızlı ve hatasız şekilde oturum açmasını, çoklu cihaz/oturum yönetimini ve kötüye kullanımın engellenmesini sağlamak.
Kapsam: E-posta/telefon + parola ile giriş, OTP/MFA, “Beni hatırla”, parola sıfırlama, kilitleme/rate-limit, cihaz tanıma, session yönetimi, hibrit mimari (Firebase Auth + Firestore + Azure SQL), Super Admin güvenliği, log/telemetri, UAT.
b) Roller
User: Normal giriş, opsiyonel MFA.
Moderator/Admin: Panel erişimi (ayrı giriş politikaları).
Super Admin: Yüksek güvenlik (zorunlu MFA/Passkey, IP allowlist, ayrı alan adı).
c) Giriş Yöntemleri
E-posta + Parola (varsayılan)
Telefon + OTP (SMS/WhatsApp gateway; parola olmadan “şifresiz” giriş modu opsiyonel)
MFA/2FA (opsiyonel/zorunlu):
TOTP (Authenticator)
WebAuthn Passkey (önerilir)
SMS/Email OTP (yedek kanal)
Sosyal giriş (ileride, bayrakla aç/kapa)
Not: İlk kayıt aşamasında e-posta/telefon doğrulanmış olmalı. Doğrulanmamış hesap girişte “doğrulama tamamlama” ekranına yönlendirilir.
d) Akış (State Machine)
1. Kimlik Doğrulama (Primary)
Kullanıcı e-posta/telefon ve parola girer → App Check/reCAPTCHA (risk durumunda) → Auth verify
Başarılıysa kullanıcı MFA gerekli mi? kontrolüne gider.
2. MFA
Hesapta MFA etkinse: TOTP/Passkey/SMS-OTP ekranı
Başarılı → oturum oluştur
Başarısız → kalan deneme sayısı, rate-limit/kilit politikası
3. Oturum Kurulumu
Access + refresh token (mobil/web)
“Beni hatırla”: uzun ömürlü refresh token + cihaz parmak izi kaydı (hash)
Firestore /users/{uid} durum güncelleme (lastLoginAt, lastIpHash, deviceIdHash)
4. Hata ve Güvenlik
Yanlış parola art arda X kez → hesap geçici kilidi
Çalıntı kimlik/paste saldırıları → reCAPTCHA zorunlu
Olağandışı giriş (yeni cihaz/konum) → ek doğrulama istemi
e) UI Ekranları & Durumlar
Login Ekranı
Alanlar: e-posta/telefon, parola
“Giriş yap” (disabled → validasyon geçince aktif)
“Beni hatırla” (checkbox)
“Şifremi unuttum” / “Kodla giriş yap” (telefon-OTP)
MFA Ekranı
TOTP kutusu / Passkey prompt / SMS-OTP
“Yedek kod kullan” (kurtarma kodları)
Güvenlik Bildirimi
Yeni cihaz/konum algılandı → doğrulama adımı + e-posta bilgilendirmesi
Hata Ekranları
Kilit, rate-limit, yanlış kimlik bilgisi, doğrulanmamış hesap, vb.
f) Validasyon & Politikalar
E-posta: RFC format; disposable domain uyarısı (girişte de engellenebilir).
Telefon: E.164; ülkeye göre maske.
Parola: Sunucu tarafı hatalarında “yanlış kullanıcı adı/parola” birleşik mesaj (bilgi sızdırma önleme).
MFA: Zaman eşleşmesi toleransı (TOTP drift, ±1 aralık).
Captcha: 3 ardışık başarısızlıktan sonra göster; risk puanına göre zorunlu kıl.
g) Güvenlik & Anti-Abuse
Rate-limit (IP + device + hesap):
Parola denemesi: ör. 10/15 dk → ardından 15 dk kilit
MFA denemesi: 5/15 dk
Hesap Kilidi:
Fail sayısı eşiğini aşınca geçici kilit + e-posta bildirimi
Super Admin: daha düşük eşik + zorunlu MFA/Passkey
Cihaz Tanıma:
deviceIdHash + ua + bölge → güven puanı
Yeni cihaz/konum → ek doğrulama adımı & e-posta bildirimi
Oturum Güvenliği:
Refresh token rotasyonu; çalınma şüphesinde tüm oturumları revoke
“Tüm cihazlardan çık” butonu
Super Admin Ekstra:
Ayrı subdomain (örn. admin.cringebank…)
IP allowlist / ülke kısıtı
Zorunlu Passkey + TOTP, SMS yok
Kısa oturum ömrü (idle 10 dk), clipboard koruması (kopya uyarıları)
h) Hibrit Mimari (Firebase + Firestore + Azure SQL)
Kimlik doğrulama: Firebase Auth
Profil/claim: Firestore /users/{uid}
Raporlama/denetim: Azure SQL (LoginEvents, FailedAttempts, Sessions)
İşleyiş:
Giriş başarılı → Firestore lastLoginAt, lastIpHash güncelle
Azure SQL’e LoginEvents insert (timestamp, channel, result, device hash, ip hash)
Rate-limit kararları Azure SQL tarafında da saklanır (deterministik denetim)
i) Oturum Yönetimi
Web (SPA): Kısa ömürlü access token, secure httpOnly cookie; refresh token ayrı cookie veya memory + silent refresh
Mobil: SDK standardı; background refresh; token süresi yaklaşınca yenileme
Sona Erdirme: Token revoke; aktif oturum listesi ve kapatma
“Beni hatırla”: Refresh token ömrü uzun (örn. 30 gün); yoksa 24–72 saat
j) Parola Sıfırlama & Hesap Kurtarma
Parola sıfırla: E-posta linki (tek kullanımlık, kısa TTL) → yeni parola politikaya uygun
Telefon kurtarma: SMS-OTP ile parola sıfırlama (opsiyon)
MFA yedek kodları: 8–10 tek kullanımlık kod, kullanıcı güvenli alanda saklar
E-posta değişimi: Eski e-postaya uyarı maili; yeni e-posta doğrulaması olmadan giriş açılmaz
k) Hata Mesajı İlkeleri (Örnekler)
Genel: “Girdiğin bilgiler hatalı veya giriş denemesi sınırına ulaşıldı. Bir süre sonra tekrar dene.”
Captcha: “Güvenlik doğrulamasını tamamla.”
Kilit: “Hesabın geçici olarak kilitlendi. X dakika sonra tekrar dene.”
MFA: “Doğrulama kodu eşleşmedi. Kalan deneme: N.”
Yeni cihaz: “Güvenlik için e-postana gönderdiğimiz onayı tamamla.”
(Asla “bu e-posta yok” gibi bilgi sızdıran mesajlar verme.)
l) Telemetri, Log & Alarm
Kritik event’ler: login_attempt, login_success, login_fail, mfa_challenge, mfa_success, account_lock, captcha_required, token_refresh, session_revoked
Alanlar: zaman, uid (varsa), deviceIdHash, ipHash, country, userAgent, result, reason
Alarmlar:
15 dk penceresinde login_fail oranı ↑
Aynı IP’den çoklu hesap denemesi
Super Admin başarısız denemelerinde instant alert
m) Performans & Hedefler
p95 giriş süresi: < 2 sn (captcha yokken)
MFA ek adımı: < 6 sn (SMS), < 2 sn (TOTP/Passkey)
Başarı oranı: İlk denemede ≥ %95 (mevcut kullanıcılar)
Token yenileme: arka planda < 500 ms
n) Özellik Bayrakları (Rollout)
FEATURE_LOGIN_WITH_PHONE (telefon-OTP)
FEATURE_WEBAUTHN_PASSKEY
FEATURE_REQUIRE_MFA_FOR_ADMINS
FEATURE_ENFORCE_CAPTCHA_AFTER_3_FAILS
Kademeli açılış: %5 → %25 → %100; eşik aşımında otomatik geri alma
o) Edge-Cases
E-posta doğrulanmamış hesap: Girişte doğrulama tamamlat
E-posta/telefon değişmiş ama doğrulanmamış: Eski kimlik bilgisiyle girişe izin verme
Saat farkı/TOTP drift: ±1 aralık toleransı
VPN/ülke değişimi: Ek doğrulama iste; anomali olarak logla
Offline mod (mobil): Yalnızca mevcut geçerli access token varsa kısa süreli “devam” et; refresh gerekirse girişe geri döndür
p) UAT / Test Planı (Örnek Senaryolar)
Pozitif
LOG-001: Geçerli e-posta + parola → tek adımda giriş; p95 < 2 sn
LOG-002: Telefon + OTP (captcha’sız) → giriş başarılı
LOG-003: MFA (TOTP) etkin → TOTP doğru → giriş
LOG-004: Passkey ile giriş → prompt başarı → giriş
LOG-005: “Beni hatırla” açık → 7. gün otomatik token yenileme
Negatif / Güvenlik
NEG-101: Yanlış parola 3 kez → captcha istensin
NEG-102: Ardışık 10 hata → hesap 15 dk kilit + e-posta bildirimi
NEG-103: MFA 5 kez yanlış → geçici kilit
NEG-104: Yeni cihazdan giriş → ek doğrulama ve e-posta bildirimi
NEG-105: Disposable e-posta ile giriş denemesi → reddet (opsiyon)
NEG-106: Aynı IP’den 5 farklı hesapla 1 dk içinde deneme → rate-limit uyarısı
Süreç & Bütünlük
SYNC-201: LoginEvents Azure SQL’e eksiksiz yazıldı
SYNC-202: lastLoginAt, lastIpHash Firestore’da güncellendi
SYNC-203: “Tüm cihazlardan çık” → tüm refresh token’lar revoke
Parola Sıfırlama
RST-301: Şifremi unuttum → e-posta linki → yeni parola politikaya uygun → giriş
RST-302: Sıfırlama linki süresi dolmuş → geçersiz uyarısı + yeniden istek
Erişilebilirlik/UX
A11Y-401: Klavye-yalnız kullanım; odak sırası doğru
A11Y-402: Hata mesajları ekran okuyucuda duyuruluyor
Super Admin
SA-501: Sadece admin.cringebank… üzerinden giriş
SA-502: Passkey zorunlu; TOTP yedek; SMS devre dışı
SA-503: IP allowlist dışında → reddet + alert
r) Kabul Kriterleri (Örnek)
3 başarısız denemeden sonra captcha tetiklenir.
10 başarısız denemede hesap 15 dk kilitlenir ve kullanıcıya e-posta gider.
MFA etkin hesaplarda ikinci faktör olmadan login olmaz.
Yeni cihaz/konum girişlerinde ek doğrulama ve bildirim zorunludur.
“Tüm cihazlardan çık” tüm refresh token’ları iptal eder ve 60 sn içinde tüm oturumlar düşer.
LoginEvents Azure SQL’de, profil lastLoginAt Firestore’da güncellenir.
s) Operasyon & Bakım
Captcha eşikleri, rate-limit değerleri konfigürasyonla yönetilir.
OTP/MFA başarısızlık oranları için alarmlar; sağlayıcı failover (varsa).
Düzenli güvenlik incelemeleri: parola sızıntı kontrolleri, yedek kodların tüketimi, Passkey kayıt istatistikleri.
Super Admin hesaplarında 90 günde bir güvenlik denetimi (IP listesi, cihazlar, yedek kod yenileme).
UYGULAMA RESPONSİVE OLACAK

3 - Ana sayfa : 
a) Amaç & Kapsam
Amaç: Kullanıcının açılışta hızlı yüklenen, kişiselleştirilmiş, güvenli ve akışkan bir sosyal besleme deneyimi yaşaması.
Kapsam: Home feed veri kaynakları, sıralama algoritması, sponsorlu yerleşimler (CG), hedefleme, etkileşimler (like/yorum/kaydet/paylaş), hikâyeler (opsiyon), bildirim tetikleyicileri, moderasyon, hız/önbellek, offline davranış, telemetri ve kapsamlı test.
b) Home Feed Bileşenleri (Varsayılan düzen)
Başlık Şeridi: Logo, arama kısayolu, DM kısayolu, bildirim ikonu, yeni gönderi butonu.
Hikâyeler (opsiyonel bayrak): Takip edilenlerin 24 saatlik görsel/short formatlı paylaşımları.
Besleme (Feed) Akışı:
Takip Beslemesi (Following): Kullanıcının takip ettiği hesapların gönderileri.
Önerilen/Keşfet Karışımı (For You/Explore): İlgili içerik önerileri.
Sponsorlu Slotlar (CG ile öne çıkarılmış): Hedeflemeli, etik etiketli.
Etkileşim Çubuğu: Beğen, yorum, paylaş, kaydet; gönderi seçenekleri (bildir, gizle, takipten çık vb.).
Alt Menü (TabBar): Ana sayfa / Ara / Oluştur / Aktivite / Profil.
Bayraklar: FEATURE_STORIES, FEATURE_FOR_YOU, FEATURE_SPONSORED_SLOTS, FEATURE_REELS_SHORTS
c) Veri Kaynakları & Hibrit Mimari
Birincil okuma: Firestore (gerçek zamanlı akış, kullanıcı etkileşimleri, abonelik/ilişki grafı).
Sekonder/indeksleme & rapor: Azure SQL (öneri ön-hazırlığı, hedefleme segmentleri, spam/ban sinyalleri, raporlar).
İşleyiş:
Akış ilk sayfa (hero) hızlıca Firestore’dan;
Sonraki sayfalar ve öneriler için Azure SQL ön-hazırlanmış “candidate set” kullanılır (server-side seç/karıştır).
Sponsorlu yerler için Azure SQL hedefleme + bütçe/limit kontrolü.
d) Gönderi Türleri (şimdilik aktif)
Fotoğraf, Video (kısa), Metin ve Mix (çoklu görsel/video).
Reels/Shorts (opsiyonel akış).
Stickers/anket (ileride).
Not: Müstehcenlik/küfür/nefret vb. filtreleri katı; rapor/şikayet akışı aktif.
e) Sıralama (Ranking) – Basit ama etkili V1
Amaç: “Takip + ForYou + Sponsor” karışımını dengeli sunmak, spam ve düşük kaliteyi bastırmak.
e.1 Aday Havuzu (Candidates)
Takip: Son 48 saatte takip edilen hesapların gönderileri (+ eski ama yüksek etkileşimli).
For You: Kullanıcının ilgi alanlarına, geçmiş etkileşimlerine, profil meta’sına (şehir/yaş aralık) ve benzer kullanıcı kümelerine göre seçilen gönderiler.
Sponsor: Hedeflemeye uyan ve frekans/cap limitleri içinde kalan kampanyalar.
e.2 Sinyaller (örnek)
Yakınlık: Takip ilişkisi, gönderi sahibine önceki etkileşim sıklığı.
Tazelik: Gönderi yaşı (saat), güncellik penceresi.
Kalite: Beğeni/yorum/kaydet oranları, görüntüleme süresi (video), rapor/şikayet oranı.
İçerik tipi eşleşmesi: Kullanıcının sevdiği formatlara yakınlık (görsel/video/metin).
Güven: Hesap güven skoru, rapor geçmişi, doğrulanmışlık, spam sinyalleri.
e.3 Puanlama (V1 heüristik)
Basit doğrusal kombinasyon (ağırlıklar konfigürasyonla yönetilir).
score = w1*yakınlık + w2*tazelik + w3*kalite + w4*içerikUyumu + w5*güven - w6*spamRiski
Çeşitlilik (Diversity): Peş peşe aynı hesap/gönderi türü sınırlanır.
Takip/ForYou oranı: %70 Takip / %30 ForYou (ilk sürüm; A/B ile optimize edilir).
e.4 Sponsor Yerleşimi
Yerleşim kuralı: Her X gönderide 1 sponsor slotu (örn. 1/8–1/12 arası, A/B).
Etiket: “Sponsorlu / CG ile öne çıkarıldı”.
Frekans sınırı: Kullanıcı başına/günlük gösterim üst sınırı.
Kalite filtresi: Düşük etkileşim/çok raporlanan sponsorlar otomatik geri basılır.
f) Hedefleme (Sponsor & Öneri)
Kriterler: cinsiyet (opsiyon), yaş aralığı, konum (ülke/şehir), ilgi alanları, cihaz türü, aktif saatler.
FrekanS & Cap: Kullanıcı başına/günlük gösterim limiti, kampanya toplam gösterim/bütçe.
Şeffaflık: Kullanıcı sponsoru gizleyebilir; benzer sponsorları azalt talebi kayıt altına alınır.
g) Etkileşimler ve UI Davranışı
Beğeni / Kaydet / Paylaş / Yorum: Anında optimistik güncelleme; arkaplanda doğrulama.
“Gizle / İlgi duymuyorum / Şikayet et / Kullanıcıyı sessize al / Engelle”: Hem sıralama sinyallerini, hem öneri havuzunu etkiler.
Takip/Çıkar: Akışı anında yeniden hesaplat (soft refresh).
Boş Durum (Empty State):
Takip yoksa: Onboarding öneri listesi + kategori önerileri.
Zayıf sinyalde: “İlgi alanlarını seç” veya “X hesabı takip et” öneri modülü.
h) Moderasyon & Güvenlik
Otomatik filtreler: Müstehcenlik, nefret söylemi, şiddet, çocuk istismarı, telif ihlali, küfür/toxicity (metin/görsel/video sinyalleri).
Topluluk ihlali: İhlal içerik gizleme, hesap geçici kısıtlama, tekrar ihlalde kalıcı işlem.
Rapor akışı: Tek tıkla rapor → inceleme kuyruğu → SLAlı moderasyon.
Gölge kısıtlama (shadow limits): Spam/vahşi paylaşım hızlarında gösterim düşürme.
Yasal: ACİL/HUKUKİ taleplerde audit & saklama; KVKK uyumlu maskeleme.
i) Performans, Önbellek ve Offline
İlk boyama (TTI): Kahraman (hero) cache’den; 300–500 ms içinde ilk kart.
Sayfalama: Sonsuz kaydırma; sayfa boyutu dinamik (ağ kalitesine göre).
Önbellek:
Disk cache: Son 20–50 gönderi (görsel küçük önizlemeler).
Bellek cache: Son görülen 5–10 kart.
Prefetch: Kullanıcı aşağı inerken +1 sayfa adaylarını hazırla.
Offline: Önbellekten okunur; etkileşimler “kuyruklanır”, online olunca senkron edilir.
Hata geri dönüş: Zayıf ağda “yalın” mod – düşük çözünür görseller, autoplay kapalı.
j) Bildirimler (Home ile bağlantılı)
Gerçek zamanlı tetikleyiciler: Yeni yorum, mention, DM, takip;
Susturma/özelleştirme: Kullanıcı bazında detaylı bildirim tercihleri;
Spam önleme: Toplu mention/etiket saldırılarına tavan limiti ve temp. blok.
k) Telemetri, Log & Alarm
Olaylar: feed_load, feed_scroll_depth, card_view, like, comment, save, share, hide, report, follow, unfollow, sponsor_impression, sponsor_click.
Metrikler: p50/p95 ilk içerik zamanı, seans başına görüntülenen kart sayısı, izleme süresi, sponsor CTR, raport oranı, “gizle” oranı, bounce.
Alarmlar: p95 yükleme süresi eşiği, sponsor CTR anomali, rapor oranı patlaması, öneri havuzu boşalma.
l) Özellik Bayrakları (Rollout Stratejisi)
FEATURE_FOR_YOU (öneri karışımı)
FEATURE_SPONSORED_SLOTS (CG öne çıkarma)
FEATURE_STORIES
FEATURE_REELS_SHORTS
Kademeli açılış: %5 → %25 → %50 → %100; eşik aşımında otomatik geri alma.
m) UAT / Test Senaryoları (Örnek)
Pozitif
FEED-001: Takip edilen hesaplar varsa ilk ekranda 1 sn içinde içerik görünüyor.
FEED-002: Çeşitlilik kuralı; aynı hesaptan arka arkaya 2’den fazla kart gelmiyor.
FEED-003: “İlgi duymuyorum” seçilince benzer içeriklerin oranı düşüyor (bir sonraki sayfada gözlenir).
FEED-004: Sponsor slotu etiketi doğru; tıklama raporlanıyor.
FEED-005: Video kartı autoplay Wi-Fi’de açık, hücreselde kapalı (ayarlarla değiştirilebilir).
Negatif / Güvenlik
NEG-101: Müstehcen içerik örneği → otomatik filtre → akıştan gizlenir.
NEG-102: Seri spam paylaşım → shadow limit devreye girer, görünürlük düşer.
NEG-103: Çoklu rapor alan gönderi → inceleme kuyruğuna düşer, kullanıcıya şeffaf mesaj.
NEG-104: Sponsor hedefleme dışı kullanıcı → slot görünmez.
NEG-105: Aşırı düşük bağlantı → yalın mod; büyük görseller yerine düşük çözünür.
Performans / Offline
PERF-201: p95 ilk kart < 1.0 sn (cache varken).
PERF-202: 3 sayfa peş peşe scroll → takılma yok; bellek kullanımı kontrollü.
OFF-301: Offline modda son 20 gönderi açılıyor; online olunca like/yorum kuyruğu boşalıyor.
Öneri & Ranking
RANK-401: Beğen/kaydet davranışı kısa sürede For You karışımını etkiliyor (gözlenebilir).
RANK-402: Takip/ForYou oranı konfigürasyonla değiştirildiğinde yansıyor.
n) Kabul Kriterleri (Örnek)
Ana sayfa ilk yüklemede 1 sn içinde en az 1 kart gösterir (cache doluysa).
Sponsor slotları etiketli ve frekans sınırına uyar.
“Gizle/İlgi duymuyorum” tercihleri aynı tür içerikleri görünür şekilde azaltır.
Spam/müstehcen raporları moderasyon kuyruğuna <30 sn içinde düşer.
Offline modda son görülen gönderiler görüntülenir ve etkileşimler senkron edilir.
 A/B oranları (Takip/ForYou) bayrak ile yönetilir ve anında etkiler.
o) Operasyon & Bakım
Hedefleme listeleri/segmentler haftalık güncellenir.
Banlı kelime ve hassas içerik sözlüğü periyodik revize.
Önbellek politikaları ve sayfalama boyutu ağ/cihaz bazlı ayarlanır.
Kullanıcı şikayetleri için SLA (örn. 24 saat) ve temyiz süreci tanımlı.
p) Yol Haritası (V2+)
İçerik üreticisi paneli (performans analitiği).
Detaylı kişiselleştirme (konu/etiket takibi).
Multi-modal öneri (görsel/içerik anlayan modeller).
Topluluk etiketleri ve trendler (şehir/ülke bazlı).
Uzun video ve canlı yayın entegrasyonları (bayraklı).
UYGULAMA RESPONSİVE OLACAK

4 - Uygulama Ayarlar Paneli:
1) Amaç & Kapsam
Amaç: Kullanıcının hesap, gizlilik, güvenlik, bildirim, içerik tercihi, veri & depolama, dil/bölge, ödeme/CG, erişilebilirlik ve yasal ayarlarını tek merkezden yönetebilmesi.
Kapsam: UI bölümleri, akışlar (e-posta/telefon değişimi, parola, MFA, cihaz/oturum yönetimi, veri indirme/silme), hibrit mimari eşleşmeleri (Firebase Auth + Firestore + Azure SQL), log/telemetri, UAT ve kabul kriterleri.
2) Üst Düzey Bilgi Mimarisi (Sekmeler)
Hesap (profil, kullanıcı adı, e-posta/telefon değişimi, hesap durumu)
Gizlilik (profil görünürlüğü, DM izni, okundu bilgisi, engelle/sessize al)
Güvenlik (şifre, MFA/Passkey, cihaz & oturumlar, giriş uyarıları)
Bildirimler (push/e-posta/SMS, sessiz saatler, kategorisel anahtarlar)
İçerik Tercihleri (hassas içerik filtresi, dilsel filtre, sponsor görünürlüğü)
Veri & Depolama (önbellek, otomatik indirme, veri tasarrufu)
Dil & Bölge (uygulama dili, saat dilimi, yerel formatlar)
Ödemeler & CringeGold (CG) (satın alma geçmişi, iade/fiş, abonelikler)
Erişilebilirlik (metin boyutu, animasyonlar, kontrast, altyazı)
Gelişmiş (diagnostics, beta özellikler, geliştirici günlükleri paylaş)
Hakkında & Hukuki (sürüm, lisanslar, şartlar & KVKK, açık kaynak)
Yardım & Destek (SSS, talep/şikayet, rapor gönder, log paylaş)
Hesabı Dondur / Sil (kalıcı silme, veri indirme/taşınabilirlik)
Yönetimsel (admin/super admin) ayarlar bu panelin dışındadır (ayrı domain/panel).
3) Kritik Akışlar (State Machine)
3.1 E-posta Değiştirme
Adımlar:
Kimlik yeniden doğrulama (parola/Passkey/MFA gerektir).
Yeni e-posta gir → format & disposable kontrol.
Yeni e-postaya doğrulama linki → tıklayınca emailVerified = true.
Eski e-postaya güvenlik bildirimi.
Kurallar: Eski e-posta doğrulanmadan giriş izni değişmez; yeni e-posta doğrulanana kadar hesap e-postası değiştirilmiş sayılmaz.
Hata mesajı ilkesi: Bilgi sızdırmayan, “Doğrulama tamamlanana kadar eski e-postan geçerli” tonunda.
3.2 Telefon Değiştirme
Adımlar:
Kimlik yeniden doğrulama.
Yeni telefon → E.164 kontrol → SMS OTP (2 dk, 5 deneme, 60 sn resend).
Doğrulanınca phoneVerified = true; eski telefona uyarı.
3.3 Parola Değiştirme
Adımlar: Eski parola + yeni parola (min. 10, 3 sınıf), pwned check.
Opsiyonel: ParolasızPasskey etkin hesaplarda yalnızca Passkey ile onay.
3.4 MFA / Passkey Yönetimi
MFA türleri: TOTP (zorunlu yedek kodlar), WebAuthn Passkey (önerilir), SMS/E-posta OTP (yedek kanal).
Akış: Etkinleştirme → yedek kodları güvenli yere kaydet → kurtarma süreçleri.
Kural: Admin/Super Admin için zorunlu MFA + Passkey.
3.5 Cihaz & Oturum Yönetimi
Liste: Aktif cihazlar (adı, son giriş, konum/ülke, IP hash).
İşlemler: “Bu cihazdan çıkış”, “Tüm cihazlardan çık”.
Uyarı: Yeni cihaz algılandığında e-posta bildirimi (+ isteğe bağlı onay).
3.6 Hesabı Dondur / Sil
Dondurma: Hesap görünmez/etkileşim kapalı; tekrar girişle açılır.
Silme (kalıcı):
Bilgilendirme (silinecek veriler, istisnalar: yasal/ticari kayıtlar).
Kimlik yeniden doğrulama + MFA.
14 gün bekleme penceresi (iptal/geri alma seçeneği).
Veri Taşınabilirliği: Silmeden önce “verilerimi indir” (JSON/ZIP; gönderiler, yorumlar, CG hareket özeti).
4) Bölümler ve Politikalar (Detay)
4.1 Hesap
Görünen ad, kullanıcı adı (kurallı), bio, web sitesi (opsiyonel).
E-posta/telefon değişimi (yukarıdaki akışlar).
Hesap durumu: etkin, dondurulmuş, beklemede.
Veri alanları (Firestore): fullName, username/usernameLower, bio, website, email/phone, emailVerified/phoneVerified, createdAt, updatedAt.
Rapor/Azure SQL: Users, Usernames, Consents, LoginEvents.
4.2 Gizlilik
Profil görünürlüğü: Herkese Açık / Özel (takip isteği onayı).
Okundu bilgisi: Açık/Kapalı (DM’de).
Son görülme/çevrimiçi: Açık/Kapalı.
Etiketlenme/mention izinleri: Herkes/Takip/Tam Kapalı.
Yorum filtreleri: küfür/nefret otomatik gizle; manuel kara liste.
Engelle/Sessize al listeleri yönetimi.
KVKK izleri: Onaylar ve versiyonları saklanır.
4.3 Güvenlik
Parola, MFA/Passkey, cihaz/oturumlar.
Giriş uyarıları: yeni cihaz/ülke bildirimi.
Uygulama kilidi (PIN/Biometrik) – mobil opsiyon.
Oturum otomatik zaman aşımı (admin için kısıtlı).
4.4 Bildirimler
Kanallar: Push, e-posta, SMS (SMS varsayılan kapalı).
Kategoriler: Beğeni, yorum, mention, DM, takip, öneri/sponsor, sistem duyuruları.
Sessiz saatler: BYHOUR/BYDAY; tatil modu.
Öncelik: “Sadece önemli” filtresi (DM + güvenlik).
4.5 İçerik Tercihleri
Hassas içerik filtresi (varsayılan açık).
Dil filtreleri (küfür / toksisite eşiği).
Sponsor/öneri kişiselleştirme: kapat/daralt (tam kapama değil; şeffaf etiketleme).
4.6 Veri & Depolama
Otomatik medya indirme: Wi-Fi/Cellular/Never.
Önbellek temizleme; tahmini boyut göstergesi.
Veri tasarrufu: video otomatik oynatma kapalı, görsel düşük çözünürlük.
4.7 Dil & Bölge
Uygulama dili (varsayılan cihaz dili; TR mevcut).
Saat dilimi, tarih/para birimi yerelleştirmesi.
İçerik keşfi için bölgesel ipuçları (opsiyonel).
4.8 Ödemeler & CG
Satın alma geçmişi (IAP), fatura/fiş görüntüleme (platforma bağlı).
İade/itiraz yönlendirmeleri (Apple/Google süreçleri).
Abonelikler (varsa) yönetimi.
Not: Fiat ödeme yoksa metinler buna uygun olur; tüm CG hareketleri cüzdan ekranından incelenir.
4.9 Erişilebilirlik
Metin boyutu, yüksek kontrast, animasyon azalt, hareket azalt.
Video altyazı & kapalı altyazı tercihleri.
Ekran okuyucu etiketleri (A11Y denetim planı).
4.10 Gelişmiş
Tanılama günlükleri paylaş (kullanıcı onayı ile).
Beta özellikler (feature flags) katılımı.
Derin bağlantılar, geliştirici modu (yalnızca debug yapıları için).
4.11 Hakkında & Hukuki
Sürüm, build numarası, değişiklik günlüğü.
Şartlar, KVKK/Aydınlatma, çerez politikası (link).
Açık kaynak lisansları (bileşen listesi).
4.12 Yardım & Destek
SSS, talep/şikayet formu, “rapor gönder” (ekran görüntüsü + tanılama).
Ortalama dönüş süresi/ SLA metni.
5) Hibrit Mimari Eşleşmesi
Auth: Firebase Auth (kimlik, doğrulamış bayraklar).
Profil & ayarlar: Firestore /users/{uid}, /user_settings/{uid} (veya birleşik tek doküman).
Raporlama & denetim: Azure SQL (UserSettings, Consents, SecurityEvents, NotificationPrefs).
Senkron: Outbox/event tabanlı; idempotent istek kimliği; çifte kayıt önlenir.
Claims/Policy: claims_version, policy_version, locale alanları ayarlardan etkilenmez; sürüm değişirse kullanıcıya onay yenileme akışı.
6) Güvenlik, Gizlilik, KVKK
Tüm kritik değişikliklerde yeniden kimlik doğrulama + MFA.
E-posta/telefon değişiminde eski iletişim kanalına bilgilendirme.
PII loglanmaz; IP/cihaz parmak izi hash’lenir.
“Verilerimi indir” ve “Hesabımı sil” akışları KVKK/GDPR ile uyumlu.
Ayar değişiklikleri audit log’a (hangi alan, eski→yeni, zaman, ipHash) düşer.
7) Telemetri & Alarm
Olaylar: settings_open, field_change, reauth_required, email_change_start/success/fail, phone_change_start/success/fail, password_change, mfa_enable/disable, session_revoke, data_export_request, delete_request, notifications_toggle, privacy_toggle.
Alarmlar:
Kısa sürede olağandışı email/phone change fail oranı,
MFA disable artışı (potansiyel saldırı),
Data export/silme isteklerinde ani artış.
8) Performans & UX Hedefleri
Ayarlar ekranı açılışı < 400 ms (cache’li okuma).
Kritik işlemler (parola/MFA/cihaz sonlandırma) ≤ 2 sn p95.
Hata mesajları net ve eylem önerili; bilgi sızdırmaz.
Tüm ayarlar geri alınabilir (eski değere dön) – kritiklerde yeniden doğrulama şart.
9) UAT / Test Senaryoları (Örnek)
Pozitif
SET-001: E-posta değiştir → yeni e-posta doğrulaması tamamlanınca hesap güncellenir; eski e-postaya bilgilendirme gider.
SET-002: Telefon değiştir → OTP doğru; phoneVerified=true; eski telefona bildirim.
SET-003: Parola değiştir → politika geçer; tekrar giriş çalışır.
SET-004: MFA (TOTP) etkinleştir → yedek kodlar üretildi; girişte TOTP zorunlu.
SET-005: Passkey ekle → mobil/masaüstü akışları başarılı.
SET-006: “Tüm cihazlardan çık” → 60 sn içinde tüm oturumlar düşer.
SET-007: Bildirimlerde “sessiz saatler” → aralıkta push gelmez.
SET-008: Hassas içerik filtresi açık → akışta hassas içerikler gizlenir/uyarı perdesi.
SET-009: Veri indirme → 24–72 saat içinde indirme bağlantısı oluştur (uyarı metni).
SET-010: Hesabı dondur → profil/gönderiler gizlenir, tekrar girişte açılır.
Negatif / Güvenlik
NEG-101: Disposable domain ile e-posta değişimi → reddedilir.
NEG-102: Parola zayıf/pwned → reddedilir.
NEG-103: OTP 5 kez yanlış → geçici kilit + cooldown.
NEG-104: MFA kaldırma denemesi ama yedek kod yok → engelle/uyar.
NEG-105: Yeni cihazdan kritik değişiklik → ek doğrulama zorunlu.
NEG-106: Veri silme onayı reddedildi → silme süreci iptal; audit kaydı.
Erişilebilirlik/UX
A11Y-201: Tüm kontroller ekran okuyucu ile etiketli; kontrast ≥ WCAG AA.
A11Y-202: Odak sırası mantıklı; hata mesajları duyurulur.
Senkron/Log
SYNC-301: Ayar değişimi Firestore’a yazıldı; Azure SQL’de UserSettings & AuditLog oluştu.
SYNC-302: Email/phone change success/fail event’leri Login/SecurityEvents’e işlendi.
10) Kabul Kriterleri (Örnek)
 E-posta/telefon değişiminde yeniden kimlik doğrulama olmadan ilerlenemez.
 Parola değişimi p95 < 2 sn ve pwned kontrolü içerir.
 MFA etkin hesaplar MFA’sız kritik değişiklik yapamaz.
 Cihaz/oturum listesi güncel; “tüm cihazlardan çık” 60 sn içinde etkilidir.
 Hesap silme 14 gün bekleme penceresi ve geri alma imkânı içerir.
 Ayar değişiklikleri audit log’a eksiksiz düşer (alan, eski→yeni, zaman, ipHash).
 Bildirim “sessiz saatler” kullanıcı saat dilimine göre çalışır.
 Hassas içerik filtresi açıkken uygunsuz içerik görünmez veya perde arkasında.
11) Operasyon & Bakım
Disposable domain listesi ve küfür/toksisite sözlüğü periyodik güncellenir.
MFA/Passkey benimseme oranı izlenir; kampanyalarla artırılır.
Data export/silme isteklerinde otomatik SLA (örn. 7 gün içinde tamamla).
Açık kaynak lisans listesi sürümlerle senkron tutulur.
12) Özellik Bayrakları (Feature Flags)
FEATURE_PASSKEY_LOGIN
FEATURE_TOTP_REQUIRED_FOR_ADMINS
FEATURE_NOTIFICATION_QUIET_HOURS
FEATURE_SENSITIVE_CONTENT_GUARD
FEATURE_DATA_SAVER_MODE
FEATURE_ACCOUNT_FREEZE
FEATURE_BETA_CHANNEL
UYGULAMA RESPONSİVE OLACAK

5 - Uygulama Arama Sayfası :
a) Amaç & Kapsam
Amaç: Kullanıcının kişi/hesap, gönderi ve etiketleri hızlı, doğru ve güvenli biçimde bulmasını; keşif ve trendlerle etkileşimi artırmasını sağlamak.
Kapsam: Sorgu ayrıştırma, otomatik tamamlama, sonuç sıralama (ranking), filtre/sort, güvenlik & anti-abuse, KVKK, telemetri/raporlama, performans hedefleri ve UAT.
b) Bilgi Mimarisi & UI (Sayfa Yapısı)
Arama Çubuğu (üstte sabit):
Placeholder: “Kullanıcı, gönderi veya #etiket ara”
@ ile başlarsa → kullanıcı moduna; # ile başlarsa → etiket moduna otomatik geç.
Sağda “filtreler” butonu, solda geri/iptal.
Hızlı Öneriler (typing sırasında):
Son aramalar (lokal), trendler, önerilen etiketler/kullanıcılar.
Sekmeler: Top (karma), Kullanıcılar, Gönderiler, Etiketler. (Varsayılan: Top)
Filtre çekmecesi:
Gönderi tipi (Foto/Video/Metin/Mix), Tarih (Son 24s/7g/30g/Tümü), Bölge (yakınımda/şehir), Dil, Güven filtresi (hassas içerik kapalı/açık uyarılı), Sıralama: İlgi (relevance) / En Yeni.
Sonuç Listesi: Kart tabanlı; kullanıcı kartında avatar/ad/kullanıcı adı/takip butonu; gönderi kartında görsel/video + temel metrik; etiket kartında toplam gönderi sayısı + son paylaşım zamanı.
Boş durum: “Henüz arama yapmadın. Trendlere göz at” + kategori önerileri.
Feature flags: FEATURE_SEARCH_TOP_TAB, FEATURE_SEARCH_LOCATION_FILTER, FEATURE_SENSITIVE_SEARCH_GUARD
c) Arama Türleri
Kullanıcı arama: @kullanıcıadı, ad-soyad, takma ad; TR-aware normalize edilmiş prefix arama (örn. “ş”→“s”, “ı”→“i”).
Gönderi arama: Metin, başlık, mention’lar; medya türü filtreli.
Etiket arama: #etiket tam/prefix, popülerlik ve son aktiviteye göre.
(İlerisi) Sesli arama ve OCR/ görselden arama bayrakla açılabilir.
d) Sorgu Ayrıştırma (Parsing & Normalization)
Önek kuralları: @ → kullanıcı; # → etiket; aksi halde karma.
Normalize: Unicode NFKD → diakritik temizleme → lowercase TR mantığı (ı/İ vb.), noktalama/emoji/URL kırpma; çoklu boşluk temizliği.
Tokenizasyon: 2+ karakterden kısa tokenlar skor dışı (flood önleme).
Eş anlam/sapkın yazım: Basit TR varyasyonları (c/ç, s/ş, g/ğ, o/ö, u/ü, i/ı/i) için “Bunu mu demek istedin?” önerisi.
Güvenli uzunluk: 64 karakter üstü sorgu → kes ve uyar.
e) İndeksleme & Veri Kaynakları (Hibrit)
UsersIndex (Azure SQL): usernameLower (benzersiz), displayNameLower, searchKeywords, aktiflik/güven skoru; prefix indeks.
PostsIndex (Azure SQL): textLower, hashtags, mentions, mediaType, createdAt, güven/sinyal metrikleri.
HashtagsIndex (Azure SQL): tagLower, postCount, lastUsedAt.
Realtime okuma: Firestore; candidate set & sıralama için Azure SQL sorguları.
Senkron: Outbox/event ile idempotent; Firestore’daki kullanıcı/gönderi güncellemeleri indekse düşer (gecikme hedefi < 5 sn).
f) Sıralama (Ranking) – V1 Heüristik
Top sekmesi için karma havuz: Kullanıcı + Gönderi + Etiket.
Kullanıcı skoru: yakınlık (takip/etkileşim) + ad eşleşme + popülerlik + güven skoru – spam riski.
Gönderi skoru: metin eşleşme + tazelik + etkileşim (like/yorum/kaydet oranları) + görsel/video kalite sinyali + şikayet/rapor eksi puanı.
Etiket skoru: postCount (log-scaled) + lastUsedAt tazeliği + kullanıcı ilgi korelasyonu.
Çeşitlilik: Aynı hesap/etiket peş peşe 2’den fazla gelmez.
Sıralama modu: İlgi (varsayılan) / En Yeni (tarih baskın).
Sponsor slotu (opsiyonel): Her 8–12 sonuçta 1 tanıtım; etiketli ve frekans sınırına tabi.
g) Otomatik Tamamlama & Öneriler
Latency hedefi: p95 < 150 ms (ilk 8 öneri).
Kaynaklar: UsersIndex/HashtagsIndex prefix; Son aramalar (lokal) ve Trendler.
Trendler: Ülke/şehir bazlı; spam/kötüye kullanım filtresiyle.
Öneri tıklama: Sorguya aynen uygulanır; telemetri event’i oluşur.
h) Filtreler & Sıralama (İş Kuralları)
Tarih: Son 24s / 7g / 30g / Tümü (etiket ve gönderide).
Medya: Foto/Video/Metin/Mix (gönderi).
Konum: “Yakınımda” (kullanıcı izin verirse), şehir seçimi; radius: 5–50 km.
Dil: TR/EN/Diğer (metin tespiti).
Güven filtresi: Hassas içerik varsayılan gizli; açılırsa “uyarı perdesi” ile.
i) Güvenlik, Anti-Abuse & Rate-Limit
Rate-limit: IP + device + user hash → arama sorgusu 10/10 sn, otomatik backoff.
CORS allowlist: Yalnız izinli origin’ler (web).
Kısa spam sorgular: Tek-harf spam’ı bastırmak için 2 karakter altı öneri moduna düşür; tam arama çalıştırma.
Disposable/kara liste: Kullanıcı aramalarında görünürlüğü düşür (kötüye kullanım işaretli hesaplar).
Moderasyon entegrasyonu: Banlı/şüpheli içerik sonuç havuzundan çıkar; şikayetli hashtag’ler uyarılı/sansürlü.
j) KVKK, Gizlilik & Şeffaflık
Arama geçmişi: Varsayılan cihaza lokal; kullanıcı isterse bulutta senkron (kapalı gelir).
Telemetri: IP/cihaz parmak izi hash; PII loglanmaz.
Silme: “Geçmişi temizle”; bulut senkron açıksa server tarafı da temizlenir.
Sponsor etiketi: “Sponsorlu / CG ile öne çıkarıldı”.
k) Performans Hedefleri
Öneriler p95: < 150 ms
İlk sonuç p95: < 500 ms (önbellek yokken), < 250 ms (tekrarlı sorgu)
Sonsuz kaydırma: Her sayfa (20 sonuç) < 600 ms p95
Sorgudan görsele: İlk satır kartlarının skeleton’ı < 100 ms, görsel “eager LQIP”.
l) Telemetri, Log & Alarm
Event’ler: search_open, typeahead_view, typeahead_click, search_submit, tab_switch, filter_apply, result_impression, result_click, sponsor_impression/click, no_results, error_rate_limit.
Metrikler: Sorgu→tıklama oranı, “no results” oranı, p50/p95 gecikmeler, sekme dağılımı, filtre kullanımı, trend tıklama oranı.
Alarmlar: p95 > hedef; no_results ani artış; sponsor CTR anomali; rate-limit tetiklemelerinde pik.
m) Edge-Cases
Emoji/URL dolu sorgu: Temizle, içerik aramasına düşür.
Çok dilli isimler: Normalize + display orijinal; skor normalize key üzerinden.
@ ve # bir arada: Öncelik sorgu başına en yakın önek; Top tab’ında ikisini de göster.
Uzun sorgu (>64): Kes + kullanıcıyı nazikçe uyar.
Offline: Son aramalar + cache’li trendler; sonuç yoksa “çevrimdışı” uyarısı.
1n4) Feature Flags (Rollout)
FEATURE_SEARCH_TOP_TAB
FEATURE_SEARCH_TRENDING
FEATURE_SEARCH_SPELL_SUGGEST
FEATURE_SEARCH_LOCATION_FILTER
FEATURE_SPONSORED_RESULTS
FEATURE_SENSITIVE_SEARCH_GUARD
Kademeli açılış: %5 → %25 → %50 → %100; eşik aşımında otomatik geri alma.
o) UAT / Test Senaryoları (Örnek)
Pozitif
SEA-001: “umit” yaz → @umityeke ilk 3 öneride görünür; tıklayınca profil açılır.
SEA-002: “#meme” araması → etiket kartı + son 24s gönderileri, En Yeni sıralaması çalışır.
SEA-003: “çılgın” yazınca “cilgin” varyasyonu ile sonuç gelir; “Bunu mu demek istedin?” görünür.
SEA-004: Filtre: Video + Son 7 gün + Yakınımda (10 km) → yalnızca uygun gönderiler listelenir.
SEA-005: Top sekmesinde kullanıcı+gönderi+etiket karma; çeşitlilik kuralı peş peşe aynı hesabı engeller.
SEA-006: Öneriler p95 < 150 ms; ilk sonuç p95 < 500 ms.
Negatif / Güvenlik
NEG-101: 1 harf spam (a, s, d…) peş peşe → typeahead, tam arama yok; rate-limit tetiklenmez.
NEG-102: 20 sorgu/10 sn → 429 eşdeğeri; nazik uyarı.
NEG-103: Banlı/şikayetli içerik → sonuç havuzuna alınmaz; kullanıcıya genel uyarı.
NEG-104: Hassas filtre açıkken uygunsuz sonuçlar gizli; açılırsa uyarı perdesi.
Senkron/İndeks
SYNC-201: Yeni kullanıcı oluşturulunca 5 sn içinde UsersIndex’te bulunur.
SYNC-202: Gönderi silinince indeks’ten de düşer; aramada görünmez.
SYNC-203: Kullanıcı adını güncelle → eski anahtar 410, yenisi 200 (redirect/alias opsiyonel).
UX/A11Y
A11Y-301: Klavye ile sekme/filtre gezilebilir; odak sırası doğru.
A11Y-302: Ekran okuyucu etiketleri; hata/boş durum mesajları duyurulur.
p) Kabul Kriterleri (Örnek)
@ ve # önekleri modu otomatik değiştirir; Top sekmesi karma gösterir.
TR-aware normalize (ç/ş/ğ/ı/İ/ö/ü) ile arama doğru eşleşir.
Öneriler p95 < 150 ms; ilk sonuç p95 < 500 ms.
Rate-limit 10/10 sn; aşımda kullanıcı dostu uyarı.
Hassas içerik filtresi varsayılan açık ve uyarı perdesi ile çalışır.
Sponsor sonuçları etiketli ve frekans sınırına uyar.
Arama geçmişi lokal; kullanıcı isterse bulut senkron, “temizle” her iki tarafı da siler.
İndeks senkron gecikmesi < 5 sn (hedef).
r) Operasyon & Bakım
Sözlükler: Banlı kelime, hassas içerik, disposable domain listeleri düzenli güncellenir.
İndeks bakımı: Parçalanma/istatistikler izlenir; gecelik optimize/rebuild penceresi.
Trend jenerasyonu: Günlük/şehir bazlı, bot/çift taraflı manipülasyona karşı z-score/fraud kontrolleri.
Gizlilik denetimi: Telemetri alanları anonim; PII yok; retention politikası uygulanır.
UYGULAMA RESPONSİVE OLACAK

6 - Gönderi oluşturma :
CRINGEBANK – YAYIN SÖZLEŞMESİ
Sürüm: v1.0
Yürürlük Tarihi: 08.10.2025
Ürün Sahibi: CringeBank, Moonpik Yazılım’ın bir ürün/markasıdır ("CringeBank", "Biz").
Taraf: Uygulamayı kullanan gerçek kişi ("Kullanıcı", "Sen").
a) AMAÇ VE KAPSAM
Bu sözleşme, CringeBank üzerinde içerik paylaşımı ("Gönderi") yapan tüm kullanıcıların uyması gereken kuralları, teknik şartları, lisans ve sorumlulukları düzenler. Bu kapsamda, ana sayfadaki “+” butonuna basıldığında açılan tek sayfalık içerik seçim ekranından seçilen gönderi türüne göre composer’ın moda dönüşmesi de işbu sözleşmenin parçasıdır.
Not: CringeBank’te şu an sosyal paylaşım akışı aktiftir. Pazar yeri ve yarışma modülleri (varsa) ayrı sözleşme/politikalara tabidir.
b) TANIMLAR
Spill (Metin): Metin ağırlıklı paylaşım (kısa/uzun yazı, itiraf, yorum).
Clap (Kısa Dikey Video): 5–30 sn önerilen; dikey (9:16) kısa klip.
Frame (Fotoğraf): Tekil fotoğraf.
CringeCast (Video): 5–60 sn önerilen; video paylaşımı (dikey/yatay).
Mash (Karışık/Carousel): Çoklu içerik (foto+video), tek gönderide en fazla 10 medya.
CG (CringeGold): Uygulama içi dijital değer/birim (fiat para değildir); öne çıkarma gibi özelliklerde kullanılabilir.
Composer: Gönderi oluşturma/düzenleme ekranı.
Hassas İçerik: Yetişkinlere uygun veya tetikleyici olabilecek içerik (örn. şiddet, kan, tıbbi prosedür, küfür vb.).
Uygunsuz İçerik: Çocuk istismarı, nefret, yasa dışı faaliyet övgüsü, cinsel şiddet, çıplaklık, telif ihlali vb.
c) KABUL VE YAŞ SINIRI
“Yayınla”ya tıklaman, bu sözleşmenin tamamını okuyup kabul ettiğin anlamına gelir.
Uygulamayı kullanmak için en az 13 yaşında olmalısın. 18 yaş altı kullanıcılar için hassas içerik yayınlama/görüntüleme yasaktır.
Kayıt aşamasındaki Şartlar ve KVKK/Aydınlatma Metni onaylarına ilave olarak, yayın akışı bu sözleşmeye tabidir.
d) ARAYÜZ & AKIŞ – “+” BUTONU TEK SAYFA SEÇİM
Ana sayfadaki “+” butonuna basınca, tek sayfa üzerinde Spill, Clap, Frame, CringeCast, Mash seçenekleri görünür.
Kullanıcı bir tür seçtiğinde composer anında o moda dönüşür (ör. Clap seçilirse dikey video kılavuzları, süre sayaçları; Frame seçilirse kırpma/filtre).
Bu tek sayfa; tür kısa tanımı, temel kısıtlar (süre/boyut), örnek görsel ve geri/iptal ile taslak kaydet imkanları içerir.
Tür değiştirildiğinde, mevcut girdiler taslak olarak korunur ve kullanıcı uyarılır.
e) TEKNİK ŞARTLAR VE SINIRLAR
Genel
Maks. #Hashtag: 30 / Gönderi,
@Mention: Engellediğin/engelleyen hesapları mention edemezsin,
Konum: Varsayılan kapalı; açık rızanla ve mahremiyet için yaklaşık konum (100–500 m yuvarlama),
Yorumlar: Varsayılan açık + küfür/toksisite filtresi.
Medya
Fotoğraf: JPG/PNG/HEIC (HEIC → JPG’e çevrilir), maks. 10 MB / öğe, uzun kenar hedef 1080p (320p/720p türevleri). EXIF konum/metaveri silinir.
Video: MP4/MOV (H.264/AAC). Toplam süre: ≤ 60 sn; Boyut: ≤ 100 MB; Çözünürlük: ≤ 1080p; FPS: ≤ 60.
Clap: 5–30 sn önerilir, dikey 9:16.
CringeCast: 5–60 sn, dikey/yatay destek.
Mash: Maks. 10 medya (foto+video karışık).
Transcoding, thumbnail, LQIP ve çoklu kalite katmanı üretimi için içeriği teknik olarak dönüştürmemize onay verirsin.
Sınırlar & Rate Limit
Paylaşım hızı: 10/sa – 40/gün (aşımda geçici sınırlama),
Yinelenen/spam içerikler otomatik kısıtlanır (shadow limit).
f) İÇERİK SAHİPLİĞİ, LİSANS VE MÜZİK/ÜÇÜNCÜ TARAF HAKLARI
Gönderilerinin telif hakkı sende kalır.
Paylaşarak, CringeBank’e dünya genelinde, münhasır olmayan, ücretsiz, devredilebilir ve alt lisanslanabilir bir lisans verirsin: içeriğini barındırmak, saklamak, işlemek (transcode/thumbnail/OCR vb.), çoğaltmak, kamuya sunmak, yayınlamak, dağıtmak, uygulama içi tanıtım ve yeniden paylaşım (örn. keşfet) amaçlarıyla kullanmak.
Müzik, görsel, video ve diğer unsurlar dahil olmak üzere üçüncü taraf haklarını ihlal etmeyeceğini beyan edersin. Gerekli izinleri almak senin sorumluluğundur.
Telif bildirimi geldiğinde, içerik geçici olarak durdurulabilir/kaldırılabilir; itiraz süreci sağlanır.
İçeriğini kaldırman durumunda, makul teknik süreler ve yasal saklama yükümlülükleri hariç olmak üzere, lisansımız sona erer.
g) HASSAS/UYGUNSUZ İÇERİK POLİTİKASI
Kesinlikle yasak: Çocuk istismarı, nefret söylemi, terör/şiddet övgüsü, cinsel şiddet/çıplaklık, yasa dışı faaliyet tanıtımı, kişisel verilerin izinsiz ifşası (doxing), tehdit/bezdirme, intihara/zarara teşvik, hukuka aykırı içerikler.
Kısıtlı (uyarı perdesiyle) yayınlanabilir: Kan/grafik olmayan şiddet, tıbbi prosedür, duyarlılık gerektiren içerik.
18 yaş altı kullanıcılar hassas içerik yayınlayamaz/göremez.
Spam, sahte etkileşim, çoklu hesap manipülasyonu ve yanıltıcı etiketleme yasaktır.
İhlal halinde içerik gizlenir/kaldırılır, hesap geçici/kalıcı kısıtlanır.
h) MODERASYON, ŞİKAYET VE İTİRAZ
İçerikler otomatik ve/veya insan moderasyonuna tabidir.
“Şikayet et” ile bildirilen gönderiler inceleme kuyruğuna düşer.
Yaptırımlar: Uyarı → İçerik görünürlüğünü düşürme → İçerik kaldırma → Geçici askı → Kalıcı kapatma.
İtiraz hakkın vardır; uygulama içi destek üzerinden kanıt sunabilirsin. Tekrarlı/çok ağır ihlallerde itiraz kabul edilmeyebilir.
i) GİZLİLİK, KVKK VE GÜVENLİK
Kayıt sürecinde onayladığın KVKK/Aydınlatma Metni işbu yayın akışındaki verilerinin işlenmesini de kapsar.
EXIF konum ve hassas meta silinir; IP ve cihaz parmak izi telemetrisi anonimleştirilir/hash’lenir.
Konum eklemeyi seçersen, bu verinin paylaşımına rıza göstermiş olursun (yaklaştırılmış/doğruluğu düşürülmüş).
Güvenlik ihlallerinde oturumların kapatılması, içeriğin görünürlüğünün kısıtlanması gibi koruyucu önlemleri uygulayabiliriz.
j) SPONSORLU/GÖRÜNÜRLÜK ARTIRMA (CG İLE ÖNE ÇIKARMA)
Gönderilerini CG kullanarak belirli hedefleme ölçütleri kapsamında öne çıkarmayı talep edebilirsin (özellik bayraklarına tabidir).
Sponsorlu içerikler etiketlenir (örn. “Sponsorlu / CG ile öne çıkarıldı”).
Hedefleme/frekans ve kalite filtresi kurallarına uymayan sponsor talepleri reddedilebilir.
CG para birimi değildir; iade, vergi ve platform politikaları ayrı belgelere tabidir.
k) SORUMLULUK REDDİ VE PLATFORM YETKİLERİ
İçeriklerin doğruluğu ve hukuka uygunluğu tamamen sana aittir.
Biz, uygulamanın kesintisiz/hatadan ari çalışacağını garanti etmeyiz; makul ölçüde çaba gösteririz.
İhlal, güvenlik riski veya yasal yükümlülük durumlarında içerikleri düzenleme, geciktirme, kaldırma; hesapları kısıtlama yetkisini saklı tutarız.
l) SÖZLEŞME DEĞİŞİKLİKLERİ
Bu sözleşmeyi zaman zaman güncelleyebiliriz. Değişiklikler uygulama içi bildirim ve/veya yayın tarihiyle yürürlüğe girer.
Esaslı değişikliklerde, içerik paylaşmaya devam etmen yeni koşulları kabul ettiğin anlamına gelir.
m) YÜRÜRLÜK VE FESİH
Sözleşme, yayınla butonunu kullanmanla yürürlüğe girer ve hesabın/ içeriğin uygulamada kaldığı sürece geçerlidir.
Hesabını dondurabilir/silebilir; içeriklerini kaldırabilirsin. Yasal saklama yükümlülükleri saklıdır.
n) İLETİŞİM
Destek ve ihlal bildirimleri için: Uygulama içi Yardım & Destek.
Resmi yazışmalar ve yasal tebligat kanalları, uygulama içinde belirtilen adresler üzerinden yapılır.
o) EK – TÜR BAZLI HIZLI ÖZET
Spill (Metin): 0–2.000 karakter; link tespiti; hashtag/mention destekli.
Clap (Kısa Dikey Video): 5–30 sn önerilen; 60 sn üst sınır; 9:16; telif/müzik izni şart.
Frame (Fotoğraf): ≤10 MB; 1080p uzun kenar hedef; EXIF strip; filtre/kırpma.
CringeCast (Video): 5–60 sn; yatay/dikey; kapak görseli; çoklu kalite.
Mash (Karışık): ≤10 medya; foto+video; sırala/kapak seç; toplam video süresi ≤60 sn.
KULLANICI ONAYI
[ ] “Yayınla” butonuna basarak Yayın Sözleşmesini, Topluluk Kurallarını ve KVKK/Aydınlatma metnini okuduğumu ve kabul ettiğimi beyan ederim.

7 - Yarışmalar Sayfası : Yarışmalar — Ürün Tasarımı (Detay)
a) Amaç ve İlkeler
Topluluğu eğlence, beceri ve tahmin üzerine bir araya getiren “oyun alanı”.
Tüm katılım ücretsiz; kazananlara CringeGold (CG) ödülü.
Yalnız süper admin ve kategori adminleri yarışma oluşturabilir.
Girişler (upload, cevap, tahmin) topluluk kuralları ve moderasyona tabidir.
CringeStore kuralıyla çakışmaz: yarışma katılımları “post kılıfı” olabilir ama Store ürünü değildir.
b) Bilgi Mimarisi
Sekmeler
Keşfet (tüm kategorilerden öne çıkanlar)
Aktif (devam eden yarışmalar)
Yakında (kayıt/başlangıç bekleyenler)
Geçmiş (sonuçlanmış; lider tahtası ve kazananlar)
Kategori Hiyerarşisi (8 + 1)
Spor Tahminleri (alt: Futbol, Basketbol, Voleybol, Tenis, E-Spor, Motor Sporları, MMA & Boks) — tür: prediction
Eğlence & Popüler Kültür (alt: Film Tahmini, Dizi Finali, Ünlü Kombinleri, Influencer Trendleri, Haftanın Mizahı, Magazin Olayları) — tür: vote/prediction
Müzik & Trend (alt: Haftanın Hiti, En İyi Cover, Sanatçı Tahmini, Müzik Stili Oylaması, DJ Battle, TikTok Sound Trend) — tür: vote/prediction
Bilgi & Quiz (ekleme) (alt: Genel Kültür, Spor Bilgisi, Film-Dizi, Müzik, Oyun Bilgisi) — tür: quiz
Görsel & Tasarım (alt: En Komik Görsel, Caption, En Cringe An, AI Art, Logo/Poster, Selfie Battle) — tür: upload/vote
Oyun & Sanal Turnuvalar (alt: EA FC, Valorant, CS2, PUBG/CODM, Wild Rift, Satranç) — tür: prediction/tournament
Yaratıcılık & Üretim (alt: Forma Tasarla, AI Prompt, Slogan/Marka Adı, Kısa Video, En İyi Tasarım, Yazı/Hikâye) — tür: upload
Cringe & Challenge Serileri (alt: Günün Challenge’ı, En Komik Anlar, Sosyal Cesaret, Utandırmadan Paylaş, Haftanın Cringe Videosu, Taklit Et) — tür: upload
Bonus: Özel/Markalı yarışmalar (ileride; sponsorlu, panel onaylı)
c) Yarışma Tipleri ve Kuralları
Prediction (tahmin)
Kullanıcı skor/sonuç/olay tahmini yapar; gerekli olduğunda “kilitlenme zamanı” sonrası değiştirilemez.
Puanlama: doğru sonuç; “tam isabet” ayrı puan; tie-break için ekstra soru (örn. dakika, toplam şut).
Ödül: hedefe göre sabit CG ya da havuz CG (katılan sayısına/puan dağılımına göre).
Vote (oylama)
Katılımcılar içerik gönderir veya kürasyonlu adaylar arasından topluluk oy verir.
Anti-manipülasyon: tek hesap tek oy; yeni hesap ağırlığı düşük; şüpheli trafik filtreleri.
Ödül: en yüksek puan/oy; eşitlikte jürilik ya da ek tur.
Quiz
Süre sınırlı çoktan seçmeli sorular; sıra karıştırma; anti-kopya önlemleri.
Skor: doğru sayısı + süre; lider tahtası.
Ödül: ilk X kişi ya da puan barajını aşanlara CG.
Upload (gönderi yarışı)
Foto/video/görsel + başlık; “post kılıfı” olarak Home’da da görünebilir.
Kazanım: beğeni + özgünlük + jüri ağırlığı kombinasyonu (ağırlık panelden).
Ödül: CG + rozet (“Yarışma Şampiyonu”).
Tournament (turnuva)
Bracket/lig fikstürü, maç sonuç girişi; istenirse hakem onayı.
Skor ve eşleşmeler canlı; finalde kupa ekranı.
Ödül: CG + kupa rozeti.
d) Yaşam Döngüsü ve Zamanlama
Durumlar: Taslak → Yayında (Kayıt Açık) → Katılım Kapalı → Oylama/Tahmin Kilitli → Sonuçlanıyor → Sonuçlandı → Arşiv.
Ana pencereler: kayıt süresi, teslim süresi (upload), oylama/tahmin kilidi, sonuç duyurusu.
Kapanıştan sonra sonuçlar ve ödüller otomatik dağıtılır; itiraz penceresi opsiyonel (örn. 24–48 saat).
e) Ödül ve Puanlama
Ödül biçimleri: sabit CG, dereceye göre CG, başarı rozeti (profilde görünür).
Dağıtım: sonuç “onaylandı” duruma geçtiğinde otomatik; hile/itiraz varsa askıda.
Büyük ödüllerde KYC≥1 şartı konabilir (panel ayarı).
f) Anti-Hile ve Güvenlik
Çoklu hesap ve bot tespiti: cihaz izi, hız/tekrar denemeler, IP kümeleri, olağan dışı oy paternleri.
Prediction/quiz’de “kilit” sonrası değişiklik yok; sunucu saatine göre.
Upload’larda telif ve uygunsuz içerik filtreleri; şikâyet/rapor akışı hızlı.
Oylamada ağırlıklandırma: yeni hesap düşük ağırlık, doğrulanmış hesap (mor tik) tam ağırlık; şüpheli oylar sayılmaz.
Turnuvalarda sonucu tek taraflı yazma engeli; karşı taraf/hakem onayı.
g) Kullanıcı Deneyimi (Katılımcı)
Listeleme
Grid/kart: kapak görseli, başlık, kategori/alt kategori, tip (prediction/vote/quiz/upload), kalan süre, ödül etiketi.
Filtreler: kategori/alt kategori, tip, yeni/son şans, ödül büyüklüğü.
Yarışma Detayı
Açıklama, kurallar, zaman çizelgesi, ödül, örnekler.
Katıl butonu; tipine göre: tahmin formu, oy arayüzü, quiz başlat, görsel/video yükle.
Lider tahtası ve geçici sıralama (kurala bağlı).
SSS ve Uyarılar (telif, gizlilik, uygunluk).
Bildirimler
Kayıt onayı, “kapanışa X saat kaldı”, “oylama başladı”, “sonuç açıklandı”.
Kazanım bildirimi + CG ödülünü görüntüleme.
h) Moderasyon ve Şikâyet
Yarışma kuralları ihlalinde giriş diskalifiye edilir; gerekçeli bildirim.
Topluluk şikâyeti: tek tık rapor; Moderasyon panelinde hiyerarşik öncelik.
Telif itiraz penceresi; jüri/administratif revizyon akışı.
i) Admin & Süper Admin (Yarışma Oluşturma/İşletme)
Kim oluşturur?
Yalnız süper admin ve ilgili kategori adminleri.
Oluşturma Formu (içerik)
Başlık, açıklama, görsel/kapak.
Kategori & alt kategori, yarışma tipi.
Zamanlar: kayıt, teslim, oylama/tahmin kilidi, sonuç açıklama.
Ödül konfigürasyonu: CG tutarı, derece sayısı, rozetler.
Kurallar: uygun formatlar, telif, yaş uyarıları, diskalifiye nedenleri.
Görünürlük: herkese açık / davetli / markalı özel.
Moderasyon modu: otomatik + son kontrol / tam manuel.
İşletme Araçları
Katılımları onayla/ret; spam/uygunsuz işaretleme.
Oylama/prediction istatistikleri, şüpheli aktivite raporu.
Sonuç kilidi, kazanan onayı, ödül dağıtma tetikleyicisi.
İtiraz/şikâyet çözümü; gerekirse sonuç revizyonu (audit kaydıyla).
Jüri paneli (upload kategorilerinde puanlama + notlar).
j) Arayüz Öğeleri (UI)
Üst şerit: sekmeler (Keşfet/Aktif/Yakında/Geçmiş), kategori seçici, arama.
Kart: tip rozeti (Prediction/Vote/Quiz/Upload/Tournament), ödül etiketi, sayaç.
Detay sayfası: bilgi sekmeleri (Kurallar, Ödül, Takvim, Katılımlar, Lider Tahtası).
Katılım formu: tip bazlı; gönder butonu sonrası özet ve düzenleme penceresi (kilitlenene kadar).
Paylaş: yarışmayı uygulama içi DM veya dış paylaşım ile yayıp katılımı artırma.
k) Takvim ve Sayaçlar
Her yarışmanın geri sayım sayaçları (kayıt kapanışı, oylama bitişi, sonuç açıklaması).
Yaklaşan yarışmalar için hatırlatıcı ekleme (uygulama içi bildirim).
l) Ödül & Rozetler
“Yarışma Şampiyonu”, “Top 3”, “Haftanın Hiti”, “Cringe Ustası” gibi kalıcı profil rozetleri.
Rozetler profil kartında ve yarışma geçmişinde görünür.
m) Yasal ve Uygunluk
Telif ve kişilik hakları beyanı; üçüncü taraf içerikte izin zorunluluğu.
Yaş kısıtlı içerik için uyarı ve filtre.
Hile, taciz, nefret söylemi, yasa dışı içerik “sıfır tolerans”.
n) Analitik ve Ölçüm (isim düzeyi)
yarışma_görüntüleme, katılım_başlat, katılım_tamam, oy_kullanıldı, tahmin_kilitlendi, quiz_başladı/bitti, itiraz_açıldı, kazanan_duyuruldu, ödül_dağıtıldı.
Davranış: paylaşım_tıkı, bildirim_tıkı, rapor_gönderildi, diskalifiye_oranı.
Sağlık: katılım oranı, dönüşüm (görüntüleme→katılım), hile şüphesi oranı.
o) Kabul Kriterleri (kritik)
Sadece süper admin/kategori admini yarışma oluşturabilir; normal kullanıcı göremez.
Tip kuralları doğru işler:
• Prediction: kilit sonrası değiştirilemez; doğruya CG.
• Vote: bir kullanıcıdan tek oy; şüpheli oylar sayılmaz.
• Quiz: süre/puan/tahta doğru; kopya önleme.
• Upload: kurala aykırı içerik engellenir; jüri/oy ağırlıkları uygulanır.
• Tournament: eşleşme ve skor akışı tutarlı; final görünür.
Sayaçlar ve durum geçişleri (taslak→yayında→kapalı→sonuç) zamanında tetiklenir.
Ödüller sonuçla birlikte otomatik dağıtılır; büyük ödülde KYC şartı uygulanır.
İtiraz penceresi içinde sonuç revize edilebilirse, tüm değişiklikler audit’lenir.
p) Önerdiğim küçük eklemeler
“Topluluk Seçimi” ve “Jüri Ödülü”ni aynı yarışmada birlikte verebilme.
“Mini Seri” özelliği: 4–6 haftalık lig usulü puan toplama (özellikle Quiz ve Spor tahminlerinde).
“Karma Ödül”: CG + sınırlı süreli profil efekti/çerçevesi (motivation yüksek).
UYGULAMA RESPONSİVE OLACAK

8 - CringeStore (Canlı Para Pazaryeri) :
a) Temel İlkeler
Tüm ürünler TL, USD veya EUR cinsinden listelenir; fiyat para birimi seçimi satıcı tarafından yapılır, kullanıcı cihaz bölgesine göre gösterilir.
Ödemeler iyzico/PayTR/Stripe benzeri entegre ödeme altyapıları üzerinden alınır; PCI yükümlülüğü sağlayıcıdadır.
Her satıştan otomatik %5 platform komisyonu kesilir ve doğrudan CringeBank kazanç havuzuna aktarılır.
Satıcılar canlı para kazanımlarını almak için IBAN bilgisi tanımlar; payout’lar manuel onay veya otomatik dönemsel (haftalık/aylık) olarak tetiklenir.
CG yalnızca ürün/mağaza öne çıkarma, rozet ve yarışma katılımı için kullanılabilir; ürün bedelleri asla CG ile tahsil edilmez.
Tüm siparişler, ödemeler, iadeler ve komisyon hareketleri Azure SQL üzerinde Transactions, Orders, Payouts tablolarında kayıt altına alınır; Firestore yalnızca ekran verisi ve durum eşlemesi için kullanılır.
Her satış için ilgili para biriminde e-fatura/e-arsiv kesilir; veriler muhasebe entegrasyonuna aktarılır.
b) Roller & Limitler
Standart Satıcı: Onboarding sözleşmelerini onaylar, KYC/TC kimlik numarası opsiyonel ama tavsiye edilir; varsayılan olarak 1 aktif ürün limiti ve otomatik sahtecilik kontrollerine tabi.
Doğrulanmış Satıcı (Mor Tik): KYC tamamlar, artan ürün limiti ve yüksek ciro eşiği alır, sponsor/boost bütçeleri genişler.
Kurumsal/Büyük Ölçekli Satıcı: Vergi numarası zorunlu, otomatik ödeme planı, aylık özet rapor ve AML kontrolleri; payout talepleri toplu yapılabilir.
Tüm satıcılar “Satıcı Kullanım Sözleşmesi” ve “Canlı Para ile Satış Sözleşmesi”ni onaylamak zorundadır; onay damgası Azure SQL’de saklanır.
c) Akışlar (Uçtan Uca)
c.1 Ürün Yayınlama
Satıcı Paneli > Ürünler > Yeni Ürün.
Zorunlu alanlar: Başlık, açıklama, fiyat (numeric), para birimi, stok, durum (Sıfır / İkinci El), kategori, görseller.
Kaydet → limit kontrolleri (aktif ürün kotası, doğrulama durumu) → OrdersCatalog tablosunda idempotent kayıt → otomatik post kılıfı oluşturulur ve akışa düşer.
c.2 Satın Alma (Checkout)
Müşteri ürün sayfasından “Satın Al” butonuna basar.
Sipariş özeti (fiyat, komisyon, satıcı bilgisi) Azure SQL üzerinde CreateOrder taslağı olarak açılır.
Ödeme sağlayıcı iframe/SDK’sı üzerinden kart/kapıda/alternatif yöntem seçilir.
Sağlayıcıdan başarılı dönüş alınca Orders.status “payment_captured” olur; komisyon ve satıcı payı hesaplanır; Firestore sipariş durumu güncellenir.
c.3 Sipariş Tamamlama & İade
Satıcı teslimatı onaylar → müşteri “Teslim aldım” der veya SLA süresi dolar.
İade akışında ödeme sağlayıcısı üzerinden reverse işlemi yapılır; komisyon geri alınır; Azure SQL’de audit tutulur.
c.4 Payout (IBAN)
Satıcı otomatik/manuel payout tercih eder.
Manuel: Satıcı Paneli > Ödeme Ayarları > “Payout talep et”.
Otomatik: Haftalık/aylık cron; uygun siparişler (dispute yok, iade yok) Payouts tablosuna taşınır, muhasebe onayı sonrası transfer edilir.
c.5 Öne Çıkarma (CG)
Satıcı ürününü CG harcayarak öne çıkarabilir; boost bütçesi CG cüzdanından düşer.
Boost analitiği ayrı tutulur; satış fiyatı ve ödeme akışı etkilenmez.
d) Ekranlar & UX
d.1 CringeStore Ana Liste
Filtreler: Kategori, fiyat aralığı (fiat), durum (Sıfır/İkinci El), doğrulanmış satıcı, bölge.
Kart içeriği: Kapak görseli, başlık, fiat fiyat + para birimi kodu, satıcı rozetleri, stok durumu.
CTA’lar: Favori, paylaş, “Sepete ekle” (opsiyon), “Satın al”.
d.2 Ürün Detayı
Fiyat fiat olarak görünür; vergi/komisyon hariç fiyat ve toplam bedel belirtilir.
Ödeme altyapısı logoları, teslim/iadeye dair özet ve CG ile öne çıkarma rozetleri.
Satıcı kartında IBAN görünmez, ancak payout süreçleri hakkında bilgi modülü.
d.3 Satıcı Paneli
Ürün listesi, sipariş yönetimi, IBAN/yasal bilgiler, komisyon ve gelir özetleri.
Durum filtreleri: taslak, yayında, stokta yok, askıda, satıldı.
d.4 Checkout & Ödeme Adımları
Adres ve iletişim doğrulaması (fiziksel teslimat gerekiyorsa); dijital ürünler için teslim yöntemi açıklaması.
Ödeme sağlayıcı bileşeni + 3DS doğrulaması.
Başarılı ödeme ekranı; sipariş durumu Firestore’da anında güncellenir.
d.5 Sponsor Paneli (Boost)
Boost bütçesi CG ile girilir; hedefleme (cinsiyet/yaş/bölge/ilgi) seçilir.
Performans kartı: görüntüleme, tıklama, dönüşüm, CG harcaması.
Boost bitince rapor indirilebilir.
e) Politika & Kurallar
%5 komisyon her satışta otomatik kesilir; değişiklikler sürüm numarasıyla kayıt altına alınır.
TL/USD/EUR fiyatlaması: para birimi sabitlenir, müşteri tarafında güncel kur dönüştürmesi UI seviyesinde bilgilendirme amaçlı yapılır.
İade ve chargeback koşulları ödeme sağlayıcısının SLA’larına göre işlenir; satıcı bilgilendirilir.
İlan süresi CG ile ücretlendirilmez; süre sınırları yönetici panelinden belirlenir.
Fiziksel ürün satışı sadece “Canlı para” kategorisinde yapılabilir; CG ile ödeme kabul edilemez.
Kısıtlı ürünler (yasaklı içerik, lisanssız ürün) listelerde engellenir; ihlal durumunda ürün askıya alınır ve satıcıya bildirilir.
Satıcı sözleşmeleri, vergi beyanı ve KVKK yükümlülükleri tamamlanmadan ödeme talebi işlenmez.
Payout öncesi borç/ceza (iade/chargeback) bakiyesi sıfırlanmış olmalıdır.
f) Etkileşim & Paylaşım
Yorum, beğeni, DM ve dış paylaşım akışları ürün postu seviyesinde aynı kalır; ancak siparişe dair kişisel bilgiler paylaşılmaz.
Sipariş sonrası “satıcıya mesaj” thread’i açılır; teslimata dair iletişim kayıt altına alınır.
Satıcı panelinde satış raporları CSV/PDF indirilebilir.
g) Moderasyon & Güvenlik
AML/KYC kontrolleri: Sürekli yüksek hacimli satıcılar için ek belgeler istenir.
Dolandırıcılık sinyalleri: Aynı kart ile farklı hesaplardan alışveriş, anormal iade oranı, sahte ürün raporu.
İçerik moderasyonu: Görsel/açıklama filtreleri, kullanıcı şikayetleri, otomatik askıya alma bayrakları.
Ödeme başarısızlıkları ve 3DS hataları telemetri ile izlenir; yüksek hata oranı alarm tetikler.
h) Yönetim (Admin/Süper Admin)
Komisyon oranı, payout iş akışları ve iade SLA’ları yönetim panelinden konfigüre edilir.
Raporlar: GMV, net gelir, komisyon gelirleri, iade oranı, payout gecikmeleri, boost CG harcamaları.
Risk ekibi için inceleme kuyruğu: yüksek iade, AML uyarıları, şikayet yoğunluğu.
Vergi raporları: Para birimi bazında konsolide CSV/Excel çıktıları.
i) Kabul Kriterleri (Kritik)
Ürün fiyatı fiat para biriminde kaydedilir ve tüm müşteri yüzeylerinde aynı şekilde gösterilir.
Satın alma akışı ödeme sağlayıcısı üzerinden tamamlandığında Orders.status anında güncellenir; Azure SQL ve Firestore senkron kalır.
Komisyon kesintisi ve satıcı net geliri payout ekranında şeffaf şekilde gösterilir.
CG ile öne çıkarma butonu satış fiyatını etkilemez; yalnızca görünürlüğü artırır.
Payout tetiklenmeden önce siparişin iade/dispute durumu kontrol edilir; riskli siparişler beklemeye alınır.
Tüm satışlar için e-fatura kaydı oluşturulur; başarısız belgeler için hata kuyruğu görünür.

9 - CringeStore Ürün Kartları (Canlı Para) : 
a) Amaç & Kapsam
Amaç: CringeStore ürün kartlarının canlı para ile satın alma modeline uygun şekilde fiyat, satıcı ve güvenlik bilgilerini şeffaf biçimde sunmasını; beğeni, yorum, paylaşım ve checkout adımlarını performanslı yönetmesini sağlamak.
Kapsam: Kart şablonları, veri alanları, etkileşim akışları (beğeni/yorum/DM/share), satın alma CTA’ları (ödeme sağlayıcısı yönlendirmesi), moderasyon & anti-abuse, telemetri, performans, A11Y ve UAT.
Not: Dijital kozmetik/rozet/boost öne çıkarma işlemleri için CG kullanılabilir; ürün satış bedeli yalnızca canlı para ile tahsil edilir.
b) Kart Tipleri & Yerleşim
Grid Kart (Listing Tile): Kapak görseli, ürün adı, kısa badge, fiat fiyat + para birimi, satıcı rozetleri, stok durumu.
Liste Kartı (Compact): Arama sonuçlarında küçük görsel + metin + fiyat + “Sepete ekle/Satın al” CTA.
Detay Kartı (Product Header): Galeri, ürün adı, satıcı kartı, fiyat kırılımı, vergi/komisyon notu, satın alma CTA, favori/beğeni/ paylaşım butonları.
CTA seti: “Satın Al”, “Sepete Ekle” (opsiyonel bayrak), “Beğen”, “Paylaş”, “Yorumlar”; boost etiketi CG kullanımını gösterir.
c) Veri Alanları (Şema – kavramsal)
Temel: productId, title, subtitle, description, media[] (kapak + galeri), badges[], tags[].
Fiyatlama: price.amount (decimal), price.currency (TL/USD/EUR), listPrice, discountPercentage, taxIncluded flag.
Sipariş Bilgisi: fulfillmentType (dijital/fiziksel), deliverySLA, refundPolicyId.
Satıcı/marka: sellerId, sellerName, sellerVerificationStatus, ratingAverage (ileride), totalSales.
Sinyaller: likeCount, commentCount, purchaseCount, boostStatus, lastUpdatedAt.
Uyumluluk: ageGate, restrictedFlag, storePolicyVersion, legalDisclosures.
Depolama:
- Firestore: /store/products/{productId} (UI için), counters koleksiyonu.
- Azure SQL: StoreProducts, StorePrices, StoreSignals, StoreCompliance.
- Medya: Firebase Storage (varyant + LQIP) або CDN.
d) Etkileşimler (Kullanıcı İzinleri)
d.1 Beğeni (Like)
UI: Kalp ikonu + optimistik sayaç; ürünün popülerlik sinyali.
Kayıt: Firestore counter + Azure SQL StoreSignals (idempotent).
Limit: 30/sn IP/device throttle.
d.2 Yorum (Comment)
Metin + emoji; linkler otomatik gizlenir.
Sıralama: “En ilgili”, “En yeni”.
Filtre: Küfür/nefret/spam; mention desteği.
Limit: 5 yorum/dk kullanıcı başına.
d.3 Uygulama İçi DM Paylaşımı
Kart önizlemesi (görsel, ad, fiat fiyat, satıcı adı) + not alanı.
Telemetri: dm_share_click/send/open.
d.4 Uygulama Dışı Paylaşım
Sistem share sheet; kısa link + OG meta; UTM etiketleme.
Güvenlik: HTTPS zorunlu, tıklama analizi bot koruması.
d.5 Satıcıya Mesaj
Sipariş öncesi/p sonrası mesajlaşma; gizlilik gereği kişisel bilgiler maskelenir.
Mesaj kanalında sipariş referansı tutulur.
e) Satın Alma CTA’ları
“Satın Al” butonu checkout ekranına yönlendirir; ödeme sağlayıcısı bileşeni açılır.
Çoklu ürün desteği varsa “Sepete ekle” ve mini sepet göstergesi.
Fiyatın altında “Tahmini toplam” (vergi/komisyon dahil) bilgisi.
Bakiye yetersizliği konsepti yok; CG yönlendirmesi sadece boost alanında gösterilir.
18+ ürünlerde satın alma öncesi yaş doğrulaması yapılır.
f) Moderasyon & Şeffaflık
Ürün kartında “Sponsorlu” ve “Boost (CG)” etiketleri görünür.
Satıcı doğrulama statusu rozetle gösterilir; raporla butonu bulunur.
Şüpheli içerik (telif, yasaklı ürün) otomatik/manuel moderasyon kuyruğuna düşer.
g) Anti-Abuse & Rate-Limit
Beğeni/yorum flood tespiti; captcha gerekirse tetiklenir.
DM paylaşım spam’inde gönderim limiti, güven puanı düşürme.
Kısa sürede fiyat değiştirme → audit log + yöneticilere uyarı.
Checkout başarısızlık oranı artarsa telemetri alarmı.
h) Performans & A11Y
Kart ilk boyama p95 < 200 ms; fiyat alanı skeleton state ile yüklenir.
Görseller progressive yüklenir; düşük bant genişliğinde düşük çözünürlük.
A11Y: Para birimi screen reader uyumlu, butonlar net label’lı.
i) Telemetri & Log
Event’ler: store_card_impression, store_card_click, add_to_cart, checkout_start, checkout_success/fail, like_toggle, comment_post, dm_share, external_share, boost_badge_view.
Ek alanlar: price_amount, price_currency, seller_segment, payment_provider.
Dashboards: CTR, dönüşüm hunisi (impression→click→checkout→purchase), ortalama sipariş değeri, boost etkisi.
j) Edge-Cases
Kur dalgalanması: Sipariş onayı öncesi fiyat değiştiyse kullanıcıya yeni fiyat gösterimi zorunlu.
Stokta yok: Kart “Tükendi” badge’i alır, satın alma CTA pasif.
Dispute/iade sürecindeki ürün: Kartta “İncelemede” etiketi, CTA’lar sınırlı.
Bölge kısıtı: Kullanıcı lokasyonuna uymayan ürün gizlenir veya bilgilendirme banner’ı.
Teslimât tipi dijitalse ve redemption kodu gecikirse “biz ilgileniyoruz” mesajı.
k) Feature Flags (Rollout)
FEATURE_STORE_CART
FEATURE_STORE_CHECKOUT_PROVIDER_<iyzico/paytr/stripe>
FEATURE_STORE_SELLER_CHAT
FEATURE_STORE_BOOST_BADGE
FEATURE_STORE_PRICE_TRACKING
Rollout: %5 → %25 → %50 → %100; ödeme hataları kritik eşikte bayrak kapanır.
l) UAT / Test Senaryoları
Pozitif
STO-001: Grid kart fiyatı ve para birimini doğru gösterir, tıklama ile detay açılır.
STO-002: “Satın Al” → checkout → ödeme sağlayıcısı simüle başarı → sipariş oluşturulur.
STO-003: Yorum gönder → moderasyon filtresi geçer → anında görünür.
STO-004: DM paylaşımı → alıcıya fiat fiyat içeren kart gelir.
STO-005: Boost etiketi CG harcaması sonrası kartta görünür.
STO-006: Stokta yok ürün CTA’yı pasifleştirir.
Negatif / Güvenlik
NEG-101: Beğeni spam → throttle + hata mesajı.
NEG-102: Yasaklı kelime içeren yorum → reddedilir.
NEG-103: Checkout iptal → sipariş taslağı “cancelled” olur, ücret çekilmez.
NEG-104: Fiyat değişimi checkout sırasında → kullanıcı yeni fiyatı onaylamazsa işlem iptal.
NEG-105: 18+ ürün, yaş doğrulaması başarısız → satın alma bloklanır.
Senkron / İşlemsel
SYNC-201: Beğeni/yorum sayaçları Firestore & Azure SQL eşlenir.
SYNC-202: Başarılı satın alma → Orders/Transactions güncellenir, Firestore sipariş kimliği ilişkilendirilir.
SYNC-203: Boost CG harcaması → CG ledger kayıtlarına düşer, kart etiketi güncellenir.
A11Y / Performans
A11Y-301: Screen reader fiyatı “₺450 Türk Lirası” diye okur.
PERF-401: Kart lazy-load’ı 200 ms altında.
m) Kabul Kriterleri (Örnek)
Kartta fiat fiyat ve para birimi görünür, hata durumunda fallback mesajı.
Satın alma CTA’sı ödeme sağlayıcısı akışını tetikler; iptal/success durumları kullanıcıya iletilir.
Boost etiketi yalnızca CG harcaması mevcutsa çıkar.
Yorum/beğeni/DM paylaşımı event’leri telemetriye tam düşer.
Stok veya bölge kısıtlı ürünlerde CTA’lar doğru şekilde pasifleşir.
Sipariş referansı satıcı mesajlaşmasına otomatik eklenir.
n) Operasyon & Bakım
Fiyat değişiklikleri ve kampanyalar için audit log tutulur; yetkisiz değişimlerde alarm.
Medya içerikleri periyodik olarak optimize edilir, bozuk bağlantılar raporlanır.
Boost raporları satıcıya gönderilir; CG ledger ile uzlaşma yapılır.
UYGULAMA RESPONSİVE OLACAK

10 - CringeGold (Dijital Etkileşim Birimi) :
CRINGEGOLD (CG) – PARA BİRİMİ POLİTİKASI, TASARIM VE EK SÖZLEŞME
Sürüm: v1.1
Yürürlük Tarihi: 12.10.2025
Ürün Sahibi: CringeBank (Moonpik Yazılım)
Bu belge, CringeBank’te kullanılan CringeGold (CG) sanal değerinin kapsamını, teknik/operasyonel tasarımını, mağaza uyumluluğunu ve risk/güvenlik politikalarını açıklar. CG yalnızca uygulama içi dijital etkileşimler (ör. içerik öne çıkarma, rozet, yarışma katılımı) için kullanılabilir; ürün satışları ve kullanıcılar arası mal/hizmet alışverişi canlı para (fiat) ile yürütülür. CG fiat para/kripto değildir, uygulama dışına çıkarılamaz ve nakde çevrilemez.
a) AMAÇ & KAPSAM
Amaç: CG ile öne çıkarma (sponsor), profil/rozetsel kozmetik, yarışma girişleri ve diğer dijital özelliklerin satın alınmasını sağlamak; marketplace işlemlerini fiat sistemden tamamen ayırmak.
Kapsam: CG tanımı, paket/ödenek modeli, kazan-kullan akışları, iade/chargeback, cüzdan/defter tasarımı, anti‑abuse, mağaza uyumluluğu (Apple/Google), hukuki uyarılar ve yol haritası. Fiat cüzdanı (fiatBalance/totalEarnings) bu kapsam dışındadır.
b) TEMEL İLKELER
Sanal değer: CG, yalnızca uygulama içinde anlamlıdır; mülkiyet/ödeme aracı/e-para değildir.
Aktarım: CG hesaplar arasında doğrudan transfer edilemez (V1). İleride hediye özelliği bayrakla açılabilir (anti‑abuse kontrolleriyle).
Para/Takas: CG nakde çevrilemez, reklam dışı üçüncü parti takas/puan siteleri yasaktır.
Bölümlenmiş ekonomi: Marketplace (CringeStore) işlemleri yalnızca fiat ile yapılır; CG bu siparişlerde hiçbir aşamada ödeme aracı, komisyon veya escrow olarak kullanılamaz.
Bölgesellik: Fiyatlandırma platform mağaza kademelerine (StoreKit/Play Billing tiers) uyar; yerel vergi/kurallara göre değişebilir.
Politika üstünlüğü: Apple/Google mağaza kuralları ile çelişen hiçbir uygulama/akış devreye alınmaz.
c) CG BİRİMİ, ÖLÇEK VE PAKETLER
Birim: CG (tam sayı), ondalık yok (mikro ödemeler için fiyatlama paketlerde çözülür).
Önerilen paket kademeleri (örnek): 80 CG • 500 CG • 1.200 CG • 2.600 CG • 5.500 CG.
Paket isimleri: Mini, Standart, Plus, Pro, Mega.
Bölgesel/mağaza fiyat katmanları ile eşlenir; kampanya/bonus CG yalnızca CringeBank içi kampanya olarak verilebilir.
İade/Promosyon etkisi: Bonus CG’ler iade/chargeback durumunda öncelikle bonus bakiyeden düşer.
d) KAZAN – KULLAN AKIŞLARI
d.1 Kazanma Yolları
İn‑App Satın Alma (IAP): Apple/Google mağaza içi satın alma ile CG paketi.
Etkinlik/ödül: Görev/etkinlik/turnuva (ileride) – nakde çevrilemez ve istismar önleme kotalarıyla.
Hediye (opsiyonel): Bayraklı; hesaplar arası hediye CG, kimlik/doğrulama ve anti‑abuse limitleriyle.
d.2 Harcama Yolları (V1)
Gönderi öne çıkarma (Sponsor Slot): Hedeflemeli gösterim, frekans/cap kurallarına tabidir.
Kozmetik/rozetsel öğeler: Mor tik (politika uyarınca), profil temaları, çerçeveler vb.
Etkileşim artırıcı araçlar (etiketli): Öne çıkan hikâye yuvası, profil link slotu vb. (yalnızca dijital özelliklerde).
Yasak: CG, fiziksel mal/hizmet veya uygulama dışı dijital içerikler için kullanılamaz.
e) CÜZDAN & MUHASEBE TASARIMI (HİBRİT)
Cüzdan modeli: Her kullanıcıya tek CG cüzdanı (V1); durum alanları: available, hold, lifetimeEarned, lifetimeSpent.
Defter (double‑entry): WalletEntries tablosu (Azure SQL) / wallet_ledger (Firestore gölgeli).
Entries: CREDIT_IAP, CREDIT_BONUS, DEBIT_SPONSOR, DEBIT_COSMETIC, ADJUSTMENT, REVERSAL.
Her işlem idempotent request_id ile yazılır; çift kayıt engellenir.
Kesintiler: İşlem ücretleri (varsa) ayrı satır olarak şeffaf işlenir.
Escrow: CG, yalnızca dijital özellikler için kısa süreli rezerv (ör. programlı sponsor/yarışma katılımı) tutmak amacıyla hold edilebilir; CringeStore siparişleri fiat tarafında ayrı escrow mekanizmasıyla yönetilir.
Bütünlük: Saat dilimi UTC, tutarlar tam sayı CG, mali kilitleme event‑sourcing ile yapılır.
f) IAP, İADE, CHARGEBACK
IAP doğrulama: Apple/Google makbuz doğrulaması zorunlu; IapReceipts kaydı ve restorable entitlement akışı uygulanır.
İade/Chargeback:
İade edilen paket tutarı kadar CG derhal düşülür (önce bonus, sonra satın alınan).
Bakiyen yeterli değilse negatif CG yerine kısıtlama uygulanır (harcama kilidi/hesap uyarısı).
Tekrarlı iade kötüye kullanımında geçici/permanent kısıt.
Faturalama: Mağaza makbuz/fatura bilgileri platforma aittir; uygulama içinde CG alım geçmişi gösterilir.
g) MAĞAZA UYUMLULUĞU (APPLE / GOOGLE)
Dijital içerikler için IAP zorunludur. Uygulama içi CG satın alımları StoreKit/Play Billing üzerinden yapılır.
Harici ödeme/bağlantı: Bölgesel kurallara bağlıdır; ABD mağazasında harici yönlendirme allowed olabilir, Türkiye ve diğer bölgelerde IAP dışı yönlendirme/purchase kapatılır.
Kripto/NFT: Uygulama içi CG kripto değildir. Kripto cüzdan/alışveriş fonksiyonları yalnızca ayrı sınıf uygulamalar ve bölgesel lisans koşullarını sağlarsa mümkündür.
Geri yükleme (Restore): Kullanıcı cihaz değiştirdiğinde, geçmiş CG IAP yetkileri yeniden sağlanır.
Not: Mağaza politikaları değişebilir; CringeBank, politika güncellemelerine göre akışları ve görünür metinleri dinamik olarak günceller.
h) RİSK, GÜVENLİK VE ANTI‑ABUSE
Limitler: Günlük/aylık CG alım, harcama ve hediye limitleri (dinamik risk puanı ile).
Anomali: Kısa sürede yüksek CG akışı → manuel inceleme; geçici kilit/oylama/sponsor kullanım askısı.
Promosyon istismarı: Kampanya CG çoklu hesap ve cihaz parmak izi eşleştirmesiyle takip edilir; ihlâlde geri alma.
Hesap güvenliği: MFA/Passkey önerilir; şüpheli oturumlar revoke edilir.
Log/Audit: Tüm CG hareketleri değiştirilemez defter event’leri ile izlenir.
i) HUKUKİ UYARILAR VE SORUMLULUK
CG yatırım aracı değildir; faiz/temettü üretmez; kur garantisi yoktur.
CG devredilemez, nakde çevrilemez, uygulama dışı değere/söz verilere bağlanmaz.
Yasal zorunluluklar (dolandırıcılık, kötüye kullanım, mahkeme/emniyet talepleri) halinde ilgili kayıtlar saklanabilir/paylaşılabilir.
j) YOL HARİTASI (FAZLAR)
Faz 1 (V1 – Bu belge): IAP paketleri, sponsor/kozmetik harcamalar, defter & iade işleyişi, mağaza tam uyum.
Faz 2 (Opsiyonel): Hediye CG (P2P) – sıkı limitler, KYC’siz; yalnızca uygulama içinde.
Faz 3 (Opsiyonel/Deneysel): Zincir Dışı Kupon/Jeton Aynası – uygulama dışında tanıtım kuponu, uygulama içi CG’ye çevrim hakkı tek yönlü (dışarı çıkış yok).
Faz 4 (Değerlendirme): Kripto entegrasyonu ayrı uygulama/altyapı ile ve yalnızca bölgesel lisanslar/mağaza kuralları izin verirse.
k) KULLANICI METİNLERİ (UI/UX)
Satın alma onayı: “CG sanal bir değerdir, iade/chargeback halinde CG bakiyen düşürülebilir. Uygulama dışında geçerli değildir.”
Harcama onayı (sponsor): “Sponsor gösterimler hedefleme/frekans kurallarına tabidir. Sonuç garantisi vermez.”
Hediye akışı (opsiyonel): “Hediye CG geri çağrılamaz; kötüye kullanımda hesap kısıtlanabilir.”
l) SSS (KISA)
CG’yi nakde çevirebilir miyim? Hayır. CG uygulama içi sanal değerdir.
CG’yi başka kullanıcıya gönderebilir miyim? V1’de hayır. İleride hediye özelliği olabilir.
İade aldım, CG’m ne olacak? İlgili tutar kadar CG düşer; bonuslar önce düşer.
Ülkelere göre fiyatlar neden değişiyor? Mağaza fiyat katmanları/vergi/kurlar nedeniyle değişebilir.
Kripto ile ilişkisi var mı? Hayır. CG kripto değildir; ayrı/ileride kripto özellikleri gelirse farklı kurallara tabidir.
KULLANICI ONAYI (CG EKİ)
[ ] CG’nin sanal, devredilemez ve nakde çevrilemez olduğunu; yalnızca uygulama içi dijital özelliklerde kullanılacağını, iade/chargeback durumunda CG’nin düşülebileceğini okudum ve kabul ettim.

11 - Profil Düzenleme Sayfası :	profil düzenleme gönderilerin yayınlanması eş zamanlı olarak ana sayfa ve profil tasarımlar kesinlikle aynı olacak. 
a) Amaç & Kapsam
Amaç: Kullanıcının profil bilgilerini (avatar, kapak, görünen ad, kullanıcı adı, bio, konum, linkler vb.) hızlı ve güvenli biçimde güncellemesi; profilin arama/keşifte doğru ve politikaya uygun görünmesini sağlamak.
Kapsam: Bilgi mimarisi, alanlar/kurallar, kullanıcı adı değiştirme politikası, medya işleme (avatar/kapak), güvenlik & moderasyon, hibrit veri modeli, telemetri, performans, edge-cases, feature flags, UAT ve kabul kriterleri.
Not: E-posta/telefon/parola/MFA gibi kritik kimlik işlemleri Ayarlar ekranında kalır; Profil Düzenleme bu alanları içermez.
b) Bilgi Mimarisi & UI (Sayfa Yapısı)
Avatar & Kapak
Avatar: dairesel kırpma önerisi (min 320×320).
Kapak: 3:1 önerilen oran (min 1500×500).
“Yükle / Kaldır / Varsayılan” + canlı önizleme.
Görünen Ad (Full Name)
Kullanıcı Adı (Username) (bayrakla açılır)
Biyografi (Bio)
Konum (Profil metni olarak) (metin alanı; hassas konum yok)
Linkler (Website + ek link slotları, max 3)
Rozetler (salt okuma): Mor/Gri tik görünümü (düzenlenemez).
Gizlilik kısayolları: Profil görünürlüğü/DM izni (Ayarlar’a derin link).
Kaydet / Vazgeç (Kaydet aktifliği alan validasyonlarına bağlı).
c) Alanlar & Kurallar
c.1 Kullanıcı Adı (Username) – FEATURE_USERNAME_CHANGE
Biçim: ^[a-z][a-z0-9_.]{2,19}$, küçük harf; baş/sonda nokta/alt çizgi yok; ardışık .. veya __ yok.
Banlı/Rezerve: admin, support, cringe, cringebank, official, root + küfür listesi.
Benzersizlik: usernameLower üzerinden tekillik.
Değiştirme politikası:
Frekans: Maks. 30 günde 1 (A/B ile 60 gün).
Güvenlik: Yeniden kimlik doğrulama + MFA.
Eski ad: 30 gün yönlendirme (arama & profil linkleri eski addan yeniye 302/alias).
Çakışma: Eski ad 30 gün “rezerve” kalır, başkası alamaz.
İndeks: UsersIndex/Typeahead 5 sn içinde güncellenir.
Denetim: Audit log’a eski→yeni kayıt düşer.
c.2 Görünen Ad
Uzunluk: 2–60 karakter; emoji/URL spam yok; çoklu boşluk normalize.
c.3 Bio
Uzunluk: 0–300 karakter (A/B ile 160/500 test edilebilir).
İçerik: Küfür/nefret/taciz/ticari spam filtresi; telif/kişisel veri ifşası yasak.
Semboller/Hashtag/Mention: Metin olarak göster; tıklanabilir hale getirme bayraklı.
c.4 Konum (Metin)
Örnek: “İstanbul, TR”. Harita/gerçek koordinat yok. Adres/telefon/e-posta yazılmaması öneri metniyle belirtilir.
c.5 Linkler
Alanlar: Website (1), Ek link (en çok 2).
Kurallar: http(s):// zorunlu; şüpheli alan (phishing/malware) blok; yönlendirme zinciri < 3.
Etiket: Link adı/ikon (örn. “Kişisel site”, “X”, “Instagram”).
rel=nofollow/noopener` ilkesi (ürün metni; teknik uygulama).
c.6 Avatar/Kapak – Medya
Format: JPG/PNG/WEBP (HEIC → JPG), max 5 MB; EXIF konum temizlenir.
Kırpma: Avatar dairesel; Kapak 3:1.
Otomatik varyantlar: 96/320/640 px (avatar), 1500/1000/500 px (kapak).
İçerik taraması: Müstehcenlik/nefret/telif; ihlalde reddet.
d) Güvenlik, Moderasyon & Rate-Limit
Bio/Ad filtreleri: Küfür/nefret/taciz, kişisel veri sızıntısı (telefon/mail/TC) tespiti → uyarı/engelleme.
Link taraması: Domain itibar kontrolü; karaliste/zararlı içerik blok.
Avatar/Kapak taraması: Görsel tabanlı güvenlik (müstehcen/şiddet/telif).
Rate-limits:
Avatar/kapak güncelleme: 5/sa
Bio güncelleme: 10/sa
Kullanıcı adı: 30 günde 1 (yukarıdaki politika)
Yaş kuralları: 18- kullanıcılar için hassas içerik içeren avatar/kapak reddedilir.
e) Hibrit Veri Modeli & Senkron
Firestore /users/{uid}: fullName, username, usernameLower, bio, locationText, links[], avatarUrls{96,320,640}, coverUrls{500,1000,1500}, badges{purple,grey}, visibility, updatedAt
Firestore /usernames/{usernameLower}: { uid, reservedUntil }
Azure SQL: Users (profil alanları), Usernames (tekillik), ProfileIndex (arama/öneri), AuditLog.
Outbox/event: ProfileUpdated, UsernameChanged, AvatarUpdated → indeks güncelle, önbellek temizle, bildirimleri tetikle (gerekirse).
İdempotency: request_id ile çift yazımı engelle.
f) Akışlar (State Machine)
f.1 Avatar/Kapak Güncelleme
Medya seç → ön-validasyon → kırpma → yükle.
Storage’a geçici yükleme → moderasyon → varyant üret → URL’ler Firestore’a yaz.
Başarısızlık: eski görsel korunur; tek tıkla yeniden dene.
f.2 Kullanıcı Adı Değiştirme
“Değiştir” → reauth + MFA → yeni ad kontrol (regex/banlı/tekil).
usernames koleksiyonunda rezerv → kullanıcıya yaz → eski ad reservedUntil=+30g.
Outbox: UsernameChanged → arama alias, yönlendirme, DM/mention eşlemesi.
Başarısızlıkta tam geri alma (idempotent).
6.3 Bio/Link/Konum Düzenleme
Kullanıcı düzenler → canlı validasyon → kaydet.
Moderasyon: metin & link taraması → uygunsa yayın.
İhlal/şüphe: kullanıcıya nazik hata & rehber metni.
g) Telemetri, Log & Alarm
Event’ler: profile_open, avatar_change, cover_change, name_change, username_change_start/success/fail, bio_change, link_add/remove, save_profile, validation_error.
Metrikler: p95 kayıt süresi, hata oranı, moderasyon reddi oranı, username change adoption, profil tamamlama skoru.
Alarmlar: Kısa sürede yüksek profil değişikliği (potansiyel saldırı), link şüphe oranında artış, moderasyon reddi patlaması.
h) Performans & UX Hedefleri
Sayfa açılışı (cache varken): < 300 ms
Avatar/kapak upload → görünür: p95 < 2 sn
Kaydet sonrası veri yansıması (UI): < 500 ms
Tüm hata mesajları eylem önerili ve bilgi sızdırmayan tonda.
i) Edge-Cases
Uzun link yönlendirmesi: 3+ hop → reddet/uyar.
Emoji/fancy font username: reddet (yalnızca izinli karakter seti).
Toplu raporlanan avatar/kapak: otomatik gizle & kullanıcıya bildirim.
Eski kullanıcı adında DM/mention: 30 gün boyunca alias → yeni ada çalışır (sonra 410).
Offline düzenleme: Form değerleri lokal taslak; online olunca senkron.
j) Feature Flags (Rollout)
FEATURE_USERNAME_CHANGE
FEATURE_PROFILE_MULTILINK (3 link slotu)
FEATURE_PROFILE_RICH_BIO (bio’da tıklanabilir #/@)
FEATURE_PROFILE_ALIAS_REDIRECTS (eski→yeni ad 30g)
Açılış: %5 → %25 → %50 → %100; anomali eşiğinde otomatik geri alma.
k) UAT / Test Senaryoları (Örnek)
Pozitif
PRO-001: Avatar yükle → kırp → kaydet → 2 sn içinde yeni avatar görünür.
PRO-002: Kapak yükle (1500×500) → kaydet → varyantlar üretilir.
PRO-003: Görünen adı güncelle → arayüzde anında yansır.
PRO-004: Bio 180 karakter + 1 link → kaydet → moderasyonu geçer.
PRO-005: Kullanıcı adını geçerli formata değiştir → reauth+MFA → alias 30 gün çalışır, arama 5 sn’de güncellenir.
PRO-006: Şüpheli link kaldırılınca kayıt başarıya döner.
Negatif / Güvenlik
NEG-101: Banlı kullanıcı adı → reddet + mesaj.
NEG-102: Username değişikliği 30 gün dolmadan → “soğuma süresi” uyarısı.
NEG-103: Bio’da küfür/nefret → kaydetme reddi ve rehber metni.
NEG-104: Phishing domain link → blok + uyarı.
NEG-105: Müstehcen avatar → moderasyon reddi; eski avatar korunur.
NEG-106: Rate-limit aşımı (avatar 5/sa) → geçici blok.
Senkron/İndeks
SYNC-201: Username değiştiğinde UsersIndex & Typeahead 5 sn içinde güncellenir.
SYNC-202: Link/bio değişimi arama/öneri sinyallerinde 1–5 dk içinde etkiler.
SYNC-203: Geri alma senaryosu (işlem ortasında ağ kopması) → idempotent kaydetme tekrarında çift kayıt oluşmaz.
A11Y/UX
A11Y-301: Tüm alanlar ekran okuyucu etiketli; odak sırası doğru.
A11Y-302: Hata mesajları canlı bölge (aria-live) ile duyurulur.
l) Kabul Kriterleri (Örnek)
 Username değişimi rehber format + 30 günde 1 + MFA ile yapılır; eski ad 30 gün alias verir.
 Avatar/kapak dosyaları 5 MB ≤, EXIF konum her zaman temizlenir.
 Bio/Ad/Link alanları küfür/nefret/phishing filtrelerinden geçmeden kaydedilemez.
 Linklerde http(s) zorunlu; şüpheli alanlar blok.
 Profil kaydetme p95 < 500 ms; avatar/kapak görünür p95 < 2 sn.
 Tüm değişiklikler AuditLog’a düşer; Azure SQL ve Firestore tutarlıdır.
UYGULAMA RESPONSİVE OLACAK

12 - Responsive : ayrıca uygulamanın en düşük pixel telefondan en büyük görüntü cihazlarına kadar uygulanması yani responsive olması 
UYGULAMA RESPONSİVE OLACAK

13 - Admin paneli :Admin — Yetki Seti (Ne yapabilir?)
a) Kullanıcı & Yetkilendirme
Kullanıcı profillerini görüntüler; vendor başvurularını ön-kontrol eder ve doğrulama önerisinde bulunur.
KYC incelemesi yapar, eksik belge talep eder; nihai onay süper admin’dedir (isteğe bağlı otomatik eşikler hariç).
Hesapları geçici dondurma/uyarma yetkisine sahiptir; kalıcı yasak süper admin onaylıdır.
b) İçerik Moderasyonu
Günlük rapor/şikayet kuyruğunu temizler; içerikleri kaldırır veya gizler.
Hassas içerik filtrelerinin önerilen eşiklerini uygular; sorunlu kalıpları işaretler.
Tekrarlı ihlallerde yaptırım önerir; ihtilaf dosyalarını süper admin’e eskale eder.	c) Mağaza & Ürün Operasyonu
Ürünleri ve kategorilerini yönetir; uygunsuz içerikleri askıya alır.
Vitrin ve koleksiyon sayfalarını kürasyon ilkelerine göre düzenler.
“CringeBank” içerik planlarını uygular; kampanya/indirim takvimlerini işletir.
d) Sipariş, Escrow, İade/İhtilaf
Satıcı-alıcı iletişiminde arabuluculuk yapar; delil/değerlendirme toplar.
Şartları sağlanan dosyaları “serbest bırakma/iptal önerisi” olarak hazırlar; gerektiğinde süper admin onayına sunar.
Basit ve kurala bağlı iadeleri (otomatik kriterler karşılanıyorsa) kapatır.
e) Finans & Faturalama Operasyonu
Günlük/haftalık fatura listelerini kontrol eder; hatalı kayıtları düzeltme için iş akışı başlatır.
Aylık üyelik (%2) borçlu satıcı listelerini takip eder; bildirim ve hatırlatmaları gönderir.
Payout taleplerinin uygunluk kontrolünü yapar (borç/rozet/enterprise); uygunsuz talepleri reddeder veya süper admin’e iletir.
f) Sponsor & Reklam
Sponsor kampanyalarını inceler; marka güvenliği ve hedefleme politikalarına göre onaylar veya geri çevirir.
Bütçe tüketimini ve kalite sinyallerini izler; şüpheli trafiği işaretler.
g) Yarışmalar & Etkinlikler
Yarışmaları oluşturur, düzenler ve takvimler; katılım kurallarını uygular.
Hile şüphesi, çoklu hesap, bot katılım gibi durumları tespit edip eskale eder.
h) Kategoriler & Taksonomi
Kategori/etiket yapısını güncel tutar; kullanıcı geri bildirimlerine göre düzen önerir.
Arama sonuç kalitesini geliştirici ekiple birlikte iyileştirir (eş anlamlı, durak kelime, trend etiketler).
i) Güvenlik & Uygunluk Operasyonu
Şüpheli etkinlikleri izler; oran limitleri ihlallerinde geçici engeller uygular.
KVKK taleplerinde veri ihracı/anonimleştirme iş akışını başlatır; nihai kapatma süper admin’dedir.
j) Sistem & Konfigürasyon (Operasyonel)
Yayın akışlarını, içerik dağıtım hızlarını ve görünürlük kurallarını günlük operasyon düzeyinde ayarlar.
Zamanlanmış görevlerin sonuçlarını takip eder; başarısız işler için yeniden deneme/inceleme açar.
k) Analitik & Raporlama
Operasyon panellerini (içerik temizliği, onay süreleri, ihtilaf çözüm oranı, sponsor kalite skoru) izler ve haftalık rapor hazırlar.
Ürün/mağaza performans özetlerini çıkarır; vitrin ve kampanya tavsiyeleri üretir.
l) İletişim & Topluluk
Topluluk kurallarının iletişimini yapar; yayın öncesi duyuruları hazırlar.
Önemli değişikliklerde SSS ve rehber içerikleri günceller.
UYGULAMA RESPONSİVE OLACAK

14 - Anlık direct mesajlar : 
a) Amaç & Kapsam
Amaç: Kullanıcılar arasında anlık, güvenli, ölçeklenebilir 1:1 mesajlaşma sağlamak; okundu bilgisi, yazıyor durumu, çevrimiçi durum, medya/ek paylaşımı, DM’den ürün/gönderi kartı paylaşımı ve report/blok akışları.
Kapsam: UI/UX akışları, durum makineleri, sıra/teslim/okundu modellemesi, offline/outbox, bildirimler, medya limitleri, güvenlik/moderasyon, telemetri, performans hedefleri, UAT ve kabul kriterleri.
b) Ana Özellikler (V1)
1:1 sohbetler (tek alıcı).
Gerçek zamanlı teslim (Firestore RT + FCM push).
Durumlar: gönderiliyor → gönderildi → teslim edildi → okundu.
Yazıyor… göstergesi, çevrimiçi/son görülme (ayarlarla yönetilir).
Okundu bilgisi (kapama seçeneği Ayarlar’da).
Medya/ekler: foto/video (küçük), ses notu (bayraklı), konum kartı yok.
Gönderi/Ürün kartı ileri paylaşım (DM içi zengin önizleme).
Mesaj tepkileri (👍❤️😂 vb.), yanıtla (inline reply).
Raporla / Engelle / Sessize al.
Arama: kişi arama + sohbet içi metin arama (local index + Azure SQL).
Gizlilik: Önizleme gizleme, okundu/çevrimiçi kapatma.
Yol haritası: Grup DM (3+), kaybolan mesajlar, düzenle/geri al, E2EE beta (ayrı bayraklarla).
c) Bilgi Mimarisi & UI
c.1 Sohbet Listesi (Inbox)
Kart: avatar, ad/kullanıcı adı, son mesaj özet, zaman, okunmamış sayacı.
Filtre: tüm/mutuals/okunmamış. Arşiv & sabitle (pin) opsiyonel.
c.2 Sohbet Ekranı
Üst: alıcı adı + durum (online/son görülme).
Gövde: baloncuklar (gönderen, zaman, durum ikonları), yanıt zincirleri.
Alt bar: metin alanı, ekle (📎), mikrofon (flag), gönder.
Aksiyon menüsü: raporla, engelle, sessize al, temizle, sohbeti sil (tek taraflı).
Link/ürün/gönderi paylaşımlarında zengin önizleme.
c.3 Kompozit Paylaşım (çapraz akış)
Ana akış/gönderi/CringeStore ürün kartından “DM ile paylaş” → alıcı seç → kısa not ekle → gönder.
d) Mesaj Yaşam Döngüsü & Durum Makinesi
Durumlar:
sending (outbox’tan yola çıktı)
sent (sunucuya yazıldı)
delivered (alıcı cihazına push/RT ulaştı)
read (alıcı UI’da görüntüledi)
Sıra & Sıralama:
Her sohbet (threadId) içinde sunucu sırası: seq (monoton artan).
Mesaj messageId = ULID (zaman-sıralı, client-gen). Sunucu seq atayıp ACK döner.
Idempotency: request_id ile çift gönderim engellenir.
Saat: Sunucu zaman damgası (serverTimestamp) + istemci drift toleransı.
Typing & Presence:
typing:true anlık yayın, TTL 5 sn; spam önleme için 1/sn üstü yayın yok.
Presence kalbi (heartbeat) 15 sn; 30 sn sonra “çevrimdışı”.
e) Offline / Outbox / Yeniden Deneme
Mesaj “Gönder” ile yerel outbox’a düşer → ağ gelince otomatik gönderim.
Başarısızlıkta “Tekrar dene” veya “Taslağa al”.
Medya yüklemeleri kuyruklanır; progress bar; kısmi başarıda mesaj “ek indiriliyor” durumuyla görünür.
f) Medya & Ekler (V1)
Foto: JPG/PNG/WEBP, ≤ 10 MB (DM’de 5 MB öner). EXIF konum strip.
Video: MP4/H.264/AAC ≤ 30 sn, ≤ 50 MB, ≤ 720p. Sunucuda tek kalite + thumb.
Ses notu (flag): AAC/OPUS ≤ 60 sn, ≤ 1 MB.
Önizleme: LQIP/thumbnail; linkte OG çekimi (güvenli fetch, 2 sn timeout).
Virüs/malware taraması (eklerde) – şüpheli dosya bloklanır.
g) Güvenlik, Gizlilik, KVKK
Transit & At-Rest şifreleme (TLS + şifreli depolama).
E2EE: V1’de yok (moderasyon/risk yönetimi için). Yol haritasında E2EE Beta (metaveri taraması + kullanıcı raporuna dayalı denetim).
Okundu/son görülme/önizleme kullanıcı ayarlarıyla yönetilir (varsayılan: açık; önizleme kilit ekranda kapalı).
Blok & rapor: Bloklanan kullanıcı DM atamaz; geçmiş gizlenir (yerel).
KVKK: DM metinleri ve ekleri kullanıcı talepleri doğrultusunda silme/ihraç süreçlerine dahil; yasal saklama istisnaları saklı.
PII koruması: IP/cihaz telemetrisi hash; DM içeriği reklam/öneri modeline girmez.
h) Moderasyon & Anti-Abuse
Otomatik filtre: Küfür/nefret/taciz yüksek skorda uyarı/engelleme (DM’de hafif).
Rate-limit:
Yeni hesap → sadece karşılıklı takip DM (soğuma: 7 gün).
Mesaj gönderim: 20/dk kullanıcı, 100/saat (dinamik risk).
Ek yükleme: 10/saat.
Flood/mention saldırısı: Hız freni + captcha; tekrarında DM kısıtı.
Rapor akışı: Mesaj özelinde rapor → moderasyon kuyruğu; ihlalde kademeli yaptırım.
i) Bildirimler
Push (FCM/APNS): “X’ten 1 yeni mesaj” (önizleme gizli ayarı varsa içerik gösterilmez).
Sessiz saatler: Ayarlar’dan (quiet hours).
Çoklu cihaz senkron: Tüm cihazlara push; ilk açan read yazar, diğerlerinde senkron.
j) Mimari & Veri Modeli
Firestore
/dm_threads/{threadId}: participants[], lastMessage, unread counters, muted, pinned, updatedAt
/dm_threads/{threadId}/messages/{messageId}: from, to, seq, text, type, mediaMeta, status, sentAt, deliveredAt, readAt, replyTo, reactions[]
/presence/{uid}: state(online/off), lastSeen
/typing/{threadId}/{uid}: typing(bool), expiresAt
Azure SQL (rapor/arama/denetim): DmThreads, DmMessagesIndex (text lower, hashtags), AbuseReports, DmSignals.
Storage: /dm_media/{threadId}/{messageId} varyantlar.
Event/Outbox: MessageSent, DeliveredAck, ReadAck, MessageReported.
k) Performans Hedefleri
Mesaj gönder→sent: p95 < 200 ms
delivered (aynı bölgede): p95 < 500 ms
read yansıması: < 300 ms
Inbox ilk boyama: < 300 ms (skeleton + son 20 mesaj cache)
l) A11Y & UX İlkeleri
Baloncuklar ekran okuyucu etiketli; zaman/okundu durumu seslendirilir.
Klavye erişilebilir; “Yazıyor…” canlı bölge (aria-live).
Mesaj seç-kopyala; linkler güvenli açılır (uyarı perdesi).
m) Edge-Cases
Engellenmiş kullanıcıya mesaj: Gönder butonu pasif + bilgilendirme.
Alıcı DM kapalı (yalnız mutuals): Talep kutusu (request) modeli (flag).
Çoklu cihaz çakışması: Aynı request_id → tek mesaj.
Saat farkı / offline flush: Sunucu timestamp otoritesi; sıralama sapmaz.
Medya yükleme yarıda kalır: Mesaj “ek indiriliyor” → kullanıcı “iptal/yeniden dene”.
n) Feature Flags (Rollout)
FEATURE_DM_AUDIO_NOTES (sesli mesaj)
FEATURE_DM_MESSAGE_REACTIONS
FEATURE_DM_INLINE_REPLY
FEATURE_DM_REQUESTS (mutual olmayan DM talepleri)
FEATURE_DM_EDIT_UNSEND (2 dk içinde düzenle/geri al)
FEATURE_DM_DISAPPEARING (24s/7g timer)
FEATURE_DM_E2EE_BETA
Açılış: %5 → %25 → %50 → %100; anomali eşiğinde otomatik geri alma.
o) Telemetri, Log & Alarm
Event’ler: dm_open, dm_send, dm_delivered, dm_read, dm_typing, dm_media_upload, dm_report, dm_block, dm_share_from_post, dm_share_from_store.
Metrikler: Gönder→delivered/okundu süreleri, teslim başarısı, spam/flood uyarıları, rapor oranı, sessiz saat uyumu.
Alarmlar: Teslim başarısı düşüşü, push hataları, flood tespiti, rapor anomali.
p) UAT / Test Senaryoları (Örnek)
Pozitif
DM-001: A, B’ye metin mesajı gönderir → A’da sent (<200 ms), B’de delivered (<500 ms), B açınca A’da read (<300 ms).
DM-002: Yazıyor durumu → A yazarken B’de gösterilir, 5 sn içinde söner.
DM-003: Foto (2 MB) gönder → thumb anında, tam medya yüklenince görünür.
DM-004: Gönderi/Ürün kartı DM ile paylaş → B’de zengin önizleme açılır.
DM-005: Okundu/son görülme kapalı iken → karşı tarafa ‘okundu’ ve ‘online’ gösterilmez.
DM-006: Offline iken mesaj yaz → online olunca otomatik gönderilir.
Negatif / Güvenlik
NEG-101: Yeni hesap → mutual olmayan DM girişimi → “DM talepleri kapalı”/talep kutusu.
NEG-102: 20+ mesaj/ dk flood → hız freni + captcha.
NEG-103: Küfür/taciz yüksek skor → kullanıcı uyarısı; tekrarında DM kısıtı.
NEG-104: Engellediğin kullanıcıdan mesaj → engellenir, push gelmez.
NEG-105: Virüslü/şüpheli ek → yükleme reddi.
Senkron / Dayanıklılık
SYNC-201: Aynı mesaj iki kez tıklanır (çift gönder) → idempotency ile tek kayıt.
SYNC-202: Push başarısız (APNS/FCM) → RT kanalından yine delivered; yoksa tekrar dene + fallback uyarısı.
SYNC-203: Cihazlar arası okundu senkronu < 300 ms.
A11Y/UX
A11Y-301: Ekran okuyucu zaman/okundu bilgilerini doğru okur.
A11Y-302: Linkler güvenli uyarıyla açılır; kopyala/yanıtla menüleri klavye ile erişilebilir.
r) Kabul Kriterleri (Örnek)
 Mesaj durumları sending → sent → delivered → read doğru ve zaman hedeflerine uygun işler.
Yazıyor ve çevrimiçi bilgileri TTL ve ayar kurallarına uyar.
Medya limitleri (foto ≤10 MB, video ≤50 MB/30 sn) ve EXIF strip uygulanır.
DM’den gönderi/ürün kartı paylaşımı zengin önizlemeyle çalışır.
Blok/rapor akışları çalışır; engellenen kullanıcı DM gönderemez.
Flood/rate-limit tetiklerinde kullanıcı dostu uyarılar verilir.
Telemetri event’leri eksiksiz düşer; teslim başarısı ve gecikmeler izlenir.
s) Operasyon & Bakım
Abuse sözlükleri ve sınıflandırıcılar periyodik güncellenir.
Push başarısızlık/çıkış oranları izlenir; token yenileme akışı düzenli test edilir.
Azure SQL index/archival stratejisi (≥ 90 gün eski DM’ler için özetleyici sinyaller).
KVKK talepleri (ihraç/silme) için self-serve akış + destek makroları.
UYGULAMA RESPONSİVE OLACAK

15 - Anlık bildirimler: 
a) Amaç & Kapsam
Amaç: Kullanıcıya gerçek zamanlı, güvenli ve saygılı (rahatsız etmeyen) bildirim deneyimi sağlamak.
Kapsam: Olay → kural motoru → kişiselleştirme/tercih → birleştirme (aggregation) → teslim (APNs/FCM + in-app) → okundu durumları → telemetri.
b) Bildirim Kategorileri (Varsayılanlar)
DM & Etkileşim: Yeni DM, DM istekleri (flag), mention, yorum, beğeni, takip.
Güvenlik: Yeni cihaz girişi, şifre sıfırlama, e-posta/telefon değişimi, MFA uyarıları.
Mağaza (CringeStore/CG): Satın alma başarı/başarısız, entitlement teslim, CG yükleme, iade.
Sistem & Moderasyon: İçerik rapor sonucu, kaldırma/limit, politika güncellemesi, bakım duyurusu.
Öneri/Nudge (opsiyonel): Etkileşim özeti, takip önerisi, “geri dön” hatırlatmaları (sessiz saatlere saygı).
KVKK uyumu: Pazarlama/öneri bildirimleri varsayılan kapalı; açık rıza gerekir.
c) Kanallar
Push: APNs (iOS) / FCM (Android).
In-App: Üst bant “heads-up” + Bildirim Kutusu (merkez).
E-posta/SMS (opsiyonel): Sadece güvenlik veya yasal bildirimler için.
d) Kullanıcı Tercihleri
Kategori bazlı anahtarlar: DM, Etkileşim, Güvenlik, Mağaza, Sistem, Pazarlama.
Önizleme: Kilit ekranında içerik önizlemesini göster/gizle.
Sessiz Saatler: BYDAY/BYHOUR tanımlı aralık; kritik güvenlik bildirimleri hariç ertele.
Sıklık & Özet: “Benzerleri birleştir” (aggregation) açık/kapalı.
Bölge/Dil: locale ve saat dilimine duyarlı metinler (TR varsayılan).
e) Olay → Bildirim Boru Hattı (Pipeline)
Üreten servisler: Post/Comment, DM, Store/CG, Security, Moderation.
Outbox/Event Bus: Her olay request_id ile kuyruklanır (idempotent).
Kural Motoru: Kullanıcı tercihleri, sessiz saat, yaş/filtre, “kendine bildirme” engeli (self-action), rate-limit.
Birleştirme (Aggregation): 60 sn pencere: “Ayşe ve 7 kişi gönderini beğendi” gibi collapse_key ile gruplama.
Şablon & i18n: Placeholder’lı metin + deep-link (örn. cringebank://post/123).
Teslim: Push + in-app; push başarısızsa (token geçersiz) token’i revoke et, in-app yinele.
Okundu/rozet: Açıldığında readAt işlenir; badge sayacı yeniden hesaplanır.
f) UI/UX – Bildirim Kutusu
Sekmeler: Tümü / Mention & DM / Mağaza / Sistem.
Kart: avatar, kısa mesaj, zaman, bağlamsal CTA (Yanıtla / Görüntüle / Ayar).
Eylemler: Kaydır → “Okundu” / “Sessize al”, uzun bas → “Bu türü kapat”.
Derin Bağlantı: DM → ilgili thread; yorum → gönderi detayında yorumlara odak.
g) Teslim Politikaları
Öncelikler: Güvenlik & DM yüksek (hemen), etkileşim orta (aggrege edilebilir), öneri/nudge düşük (sessiz saat sonrası).
TTL: DM 24s, etkileşim 2s–1dk (aggregation penceresi), sistem 7g.
Çoklu cihaz: Tüm cihazlara gönder; ilk açanda read; diğerlerinde senkron.
h) Güvenlik, Gizlilik, Anti-Abuse
İçerik önizleme: Kapalıysa push’ta sadece “Yeni mesajın var” göster.
Self-spam koruması: Kullanıcının kendi eylemi için push yok (satın alma hariç).
Rate-limit: Kullanıcı başına max 30 bildirim/10 dk, kategori tavanları; DM hariç hepsi agregasyona aday.
Kötüye kullanım: Bot benzeri beğeni/mention saldırılarında baskılama + alarm.
KVKK: Pazarlama bildirimi için rıza kaydı ve geri alma (opt-out) kolaylığı; PII içermeyen telemetri.
i) Veri Modeli (Kavramsal)
Firestore
/notifications/{uid}/{id}: type, payload, status(unread|read|dismissed), collapseKey, createdAt, expiresAt
/user_settings/{uid}/notif_prefs: kategori anahtarları, sessiz saatler, preview seçeneği
/device_tokens/{uid}/{token}: platform, locale, lastSeen, revoked
Azure SQL
Notifications (analitik), NotificationEvents, DeliveryFailures
j) Performans Hedefleri
Olay → push gönderimi: DM/Güvenlik p95 < 400 ms.
Etkileşim aggregation flush: p95 < 90 sn.
Bildirim kutusu ilk sayfa: p95 < 250 ms.
Push başarısı: > %98 (token geçersizleri hariç).
k) Telemetri & Alarm
Event’ler: notif_generated, notif_suppressed_pref, push_sent, push_failed{code}, inapp_shown, notif_open, notif_read, settings_toggle, aggregation_flush.
Metrikler: Open rate, CTR, failure rate (APNs/FCM kodları), ort. gecikme, sessiz saat erteleme oranı.
Alarmlar: Push failure > eşik, gecikme artışı, beklenmeyen hacim (spam), token revoke pikleri.
l) Mesaj Şablonları (TR – Örnek)
DM: “{from} sana yeni bir mesaj gönderdi.” → Yanıtla
Yorum: “{from}, gönderine yorum yaptı: ‘{snippet}’ ” → Görüntüle
Beğeni (aggrege): “{from} ve {n} kişi gönderini beğendi.”
Takip: “{from} seni takip etmeye başladı.”
Güvenlik: “Yeni bir cihazdan giriş yapıldı: {platform} / {city}. Bu sen değilsen parolanı değiştir.”
Mağaza: “Satın alma tamamlandı: {product}. Hakların tanımlandı.”
Moderasyon: “Gönderin kurallara aykırı bulundu ve görünürlüğü kısıtlandı.”
Push önizleme kapalıysa içerik snippet’ı gönderilmez.
m) Edge-Cases
Token 410/404 (APNs/FCM): otomatik revoke + tekrar kayıt akışı.
Sessiz saat + kritik güvenlik: Sessiz saat baypas.
Kullanıcı bildirimleri kapattı: In-app kayıt var, push yok.
Kaldırılan içerik: Bildirime tıklandığında güvenli fallback (özet ekran).
Çoklu beğeni patlaması: Tek bildirim + “daha fazlası” sayacı.
n) Feature Flags (Rollout)
FEATURE_NOTIF_PREVIEW (push önizleme)
FEATURE_NOTIF_AGGREGATION (beğeni/yorum birleştirme)
FEATURE_NOTIF_DIGEST (günlük/haftalık özet)
FEATURE_NOTIF_SECURITY_EMAIL_FALLBACK
FEATURE_NOTIF_DM_REQUESTS (DM talep kutusu bildirimleri)
Açılış: %5 → %25 → %50 → %100; anomali durumunda otomatik geri alma.
o) UAT / Test Senaryoları (Örnek)
Pozitif
NTF-001: A, B’ye DM atar → B push’u <400 ms alır; açınca DM thread’e gider.
NTF-002: 1 dk içinde 8 beğeni → tek birleşik bildirim; metin doğru.
NTF-003: Yorum bildirimi → Bildirim kutusunda görünür; tıklayınca gönderi + ilgili yoruma odaklanır.
NTF-004: Sessiz saat açık → etkileşim bildirimi ertelenir; DM/güvenlik hemen gelir.
NTF-005: Mağaza satın alma → “hak tanımlandı” bildirimi + derin link ürün detayına.
Negatif / Güvenlik
NEG-101: Push önizleme kapalı → kilit ekranda içerik görünmez.
NEG-102: Kullanıcı kendi gönderisini beğendi → push yok.
NEG-103: Token geçersiz (410) → revoke edilir; tekrar kayıt istenir.
NEG-104: Yoğun beğeni saldırısı → birleştirme + rate-limit; alarm tetikler.
NEG-105: Pazarlama rızası yok → pazarlama bildirimi gönderilmez.
Senkron/Dayanıklılık
SYNC-201: Bir cihazda “okundu” → diğer cihazlarda rozet/badge <500 ms senkron.
SYNC-202: Bildirim silinince (dismiss) tekrar tetiklenmez (collapse_key).
p) Kabul Kriterleri (Örnek)
 DM & Güvenlik olayları için push p95 <400 ms, open deep-link doğru.
 Aggregation açıkken çoklu beğeniler tek bildirime düşer.
 Sessiz saatler kullanıcının saat dilimine göre çalışır; kritik güvenlik baypas eder.
 Push önizleme ayarı kilit ekranı davranışını değiştirir.
 Token revoke/invalid durumları otomatik yönetilir.
 Bildirim kutusu ilk yükleme p95 <250 ms ve sayfalama akıcıdır.
 Pazarlama/öneri bildirimleri için rıza zorunludur; opt-out anında işler.
r) Operasyon & Bakım
APNs/FCM hata kodlarını izleyip otomatik sınıflandır (geçici/kalıcı).
A/B metin uzunluğu/emoji/önizleme testleri (CTR/open rate etkisi).
Abuse sözlükleri ve rate-limit eşikleri periyodik güncellenir.
KVKK talepleri (erişim/silme) için bildirim geçmişi saklama süreleri (örn. 90 gün) ve temizlik işleri.
UYGULAMA RESPONSİVE OLACAK

16 - Profil : Gizli profil ve herkese açık profil özelliği olacaktır.
a) Amaç & Kapsam
Amaç: Kullanıcı profillerinde Herkese Açık ve Gizli modlarını desteklemek; görünürlük, takip ve içerik erişim kurallarını netleştirmek.
Kapsam: Takip akışı, içerik/etiket/DM davranışları, arama/keşif, dış paylaşımlar, bildirimler, veri modeli, kenar durumlar, kabul kriterleri, UAT.
Öneri: 18 yaş altı hesaplar varsayılan “Gizli” başlasın. Yetişkinlerde varsayılan “Herkese Açık”. (Bayrakla yönetilir.)
b) Tanımlar
Herkese Açık Profil: Herkes profil sayfasını ve paylaşımları görebilir (bloklanmadıysa). Takip butonu anında takip (istek yok).
Gizli Profil: Profil sayfası temel bilgilerle görünür; gönderiler, hikâyeler ve etkileşimler yalnızca onaylı takipçiler tarafından görülebilir. Takip isteğe dönüşür (owner onaylar/reddeder).
c) Kullanıcı Akışları
c.1 Profil Türü Seçimi / Değiştirme
Ayarlar → Gizlilik → Profil Görünürlüğü: “Herkese Açık” ⟷ “Gizli”.
Herkese Açık → Gizli geçişinde:
Var olan takipçiler korunur (onaylı sayılır).
Tüm gelecek takipler istek olarak birikir.
Tüm mevcut gönderiler yalnızca takipçilere görünür.
Keşif/etiket/arama görünürlüğü sınırlandırılır (bkz. §5).
Gizli → Herkese Açık geçişinde:
Tüm mevcut gönderiler herkese açılır (kullanıcıya uyarı: “Tüm geçmiş gönderilerin herkese açık olacak.”).
Bekleyen takip istekleri gerekirse otomatik onaylanabilir ya da bırakılabilir (ürün kararı: bırak).
c.2 Takip / İstek Akışı
Herkese Açık: Takip → anında takip; bildirim “X seni takip etmeye başladı”.
Gizli: Takip → İstek oluşturur:
Sahibine bildirim: “X takip etmek istiyor.” → Kabul / Reddet / İptal.
Kabul edilince: içerik erişimi açılır; ret’te istek kapanır (yeniden istekte cooldown opsiyonu).
Sahip tüm bekleyenleri toplu yönetebilir.
c.3 Etkileşim Davranışları (Gönderi/Hikâye)
Gizli profilin içeriği:
Beğeni/yorum/görme: Sadece onaylı takipçiler.
Yeniden paylaş/DM ile ilet: Yalnızca takipçiler yapabilir; alıcı takipçi değilse “İçerik gizli” uyarısı + “Takip isteği gönder” CTA.
Dışa paylaşım linki: Oturum açmayan veya takipçi olmayan kullanıcıya kilit sayfa (“Gizli profil içeriği”).
Mentions/Etiketler: Gizli profilin gönderisi hashtag akışında takipçi olmayanlara görünmez. Mention’lanan kullanıcı takipçi değilse içeriği açamaz.
c.4 DM & İstek Kutusu
Gizli profil DM’leri:
(Opsiyon) Yalnız karşılıklı takip DM açsın; diğerleri “DM talebi”ne düşsün.
Önizleme push’ları gizlilik tercihlerine uyar.
d) Profil Sayfası Görünürlüğü (Alan Bazında)
Alan	Herkese Açık Görünüm	Gizli Görünüm (takipçi değil)
Avatar, Görünen Ad, Kullanıcı Adı	Görünür	Görünür
Bio, Şehir/ülke (metin)	Görünür	Görünür (isteğe bağlı)
Takipçi/Takip edilen sayıları	Görünür	İsteğe bağlı gizleme bayrağı
Gönderi ızgarası / hikâye önizleme	Görünür	Gizli perdesi + “Takip et”
Rozetler (doğrulama)	Görünür	Görünür
İletişim linkleri	Görünür	Görünür (phishing filtresi)
e) Arama, Keşif, Etiket, Bildirimler
Arama/Typeahead: Gizli profiller listelenir (etiketi “Gizli”), ancak içerik thumbnails gösterilmez.
Keşif/For You: Gizli profillerin içerikleri takipçi olmayanlara sunulmaz.
Hashtag sayfaları: Gizli içerik, sadece takipçilere görünür; takipçi olmayanlara sayım artabilir/görünmez (ürün kararı: görünmez).
Bildirimler:
Gizli profilde takip isteği ve istek sonucu bildirimleri eklenir.
Takipçi olmayanlardan gelen beğeni/yorum tetiklenmez (erişim yok).
f) Güvenlik & Anti-Abuse
Ekran görüntüsü/ileri paylaşım: Gizli içerik dışa açıldığında hedefte kilit sayfa. OG/önizleme görseli çıkarılmaz.
Bot/istek saldırısı: Kısa sürede çoklu takip isteği → hız freni + captcha; spam hesaplar için “toplu ret” aksiyonu.
Engelle/Sessize al: Engellediğin kullanıcı seni takip edemez; isteği otomatik reddedilir.
Şikâyet: Gizli içerik de topluluk kurallarına tabidir; takipçi olsan da ihlal varsa kaldırılır.
Yaş politikası: 18- hesaplar default Gizli; “Herkese Açık”a çevirmek izin verilmez (bayraklı karar).
g) Veri Modeli (Kavramsal)
Firestore – /users/{uid}

{
  "visibility": "public" | "private",
  "followApprovalRequired": true/false,
  "followerCounts": { "followers": n, "following": m },
  "privacyVersion": 1,
  "createdAt": ts, "updatedAt": ts
}

İlişki Grafı
/follows/{uid}/following/{targetUid} (aktif takip)
/followers/{uid}/by/{followerUid}
/follow_requests/{uid}/{requestId}: fromUid, status(pending|accepted|rejected), createdAt
Azure SQL
Users(visibility, followApprovalRequired, ...)
FollowEdges(uid, targetUid, state) // state: following|requested|blocked
PrivacyEvents (geçişler, audit)
İçerik Erişim
/posts ve /stories’de audience: "public"|"followers" bayrağı; sorgu katmanında ACL.
h) UI/UX Kuralları
Profil header: “Gizli Profil” rozeti + açıklama; “Takip et” butonu istek modunda.
Gizli ızgara: Kartlar yerinde blur/lock placeholder; CTA “Takip iste”.
İstek beklerken: Buton “İstek gönderildi” (iptal edilebilir).
Toplu İstek Yönetimi: Çok seçimli liste → Kabul / Reddet.
Geçiş uyarıları: “Gizliye alırsan içeriklerin yalnızca takipçilerin tarafından görülecek” / “Açığa alırsan geçmiş gönderilerin herkese görünür olacak”.
i) Performans & Önbellek
ACL cache (kısa süreli) ile feed/yorum isteklerinde erişim kontrolü hızlandırılır.
Geçişte invalidation: Public→Private değişiminde kullanıcıya ait feed/parçalar hemen temizlenir (push invalidation).
Arama indeks gecikmesi: ≤ 5 sn; görünürlük sinyali güncellenir.
j) Telemetri & Alarm
Event’ler: privacy_open, privacy_toggle_public_to_private, follow_request_send/cancel, follow_request_accept/reject, private_content_gate_hit, private_share_blocked.
Metrikler: Takip isteği kabul oranı, ort. onay süresi, private gate hit oranı, şikâyet oranı, bot-like istek piki.
Alarmlar: İstek/follow anomali, gate-bypass denemeleri, ACL hataları.
k) Edge Cases
Linkli dış paylaşım: Takipçi değilse “İçerik gizli” kilit ekranı + “Takip iste” CTA.
Profil gizli ama tekil gönderiyi public yapmak: V1’de desteklenmez (tutarlılık). V2’de “kitle seçici” bayraklı.
Kişi engelleme sonrası durum: Mevcut takip ilişkisi düşer; bekleyen istekler silinir.
Mentions: Gizli profil seni mention’ladı ama takipçisi değilsin → bildirimi alırsın; içeriğe tıklayınca gated uyarı.
Hızlı ardışık geçişler: 5 dk “soğuma” penceresi; iş yükü ve cache tutarlılığı için.
l) Feature Flags (Rollout)
FEATURE_PRIVATE_PROFILE
FEATURE_FOLLOW_REQUESTS
FEATURE_PRIVATE_SHARE_GUARD (DM/dış paylaşım kapısı)
FEATURE_MINOR_FORCED_PRIVATE (18- zorunlu gizli)
FEATURE_HASHTAG_PRIVATE_MASKING
Açılış: %5 → %25 → %50 → %100; anomali durumunda geri alma.
m) UAT / Test Senaryoları (Örnek)
Pozitif
PRV-001: Gizli profil → A, B’ye takip isteği gönderir → B kabul eder → A içerikleri görür.
PRV-002: Gizli profil gönderisi DM ile takipçi olmayan C’ye yollanır → C kilit ekranı görür.
PRV-003: Herkese Açık→Gizli geçişinde mevcut takipçiler içerikleri görmeye devam eder; yeni takipler istek olur.
PRV-004: Gizli profil hashtag akışında → yalnız takipçilere görünür.
PRV-005: Bildirimler: B’de “takip isteği” görünür; “kabul”de A’ya “isteğin kabul edildi”.
Negatif / Güvenlik
NEG-101: Bot hesap 1 dk’da 50 istek → hız freni + captcha.
NEG-102: Takipçi olmayan kişinin beğeni/yorum denemesi → erişim reddi.
NEG-103: Linkten özel gönderi açma → oturum yok/ takip değil → kilit sayfası.
NEG-104: Public→Private sonrası eski cache’tan görüntü denemesi → ACL gate bloklar.
NEG-105: Engellenmiş kullanıcı takip isteği → otomatik reddedilir.
Senkron/İndeks
SYNC-201: Visibility toggle → içerik sorgularında ACL anında etkili.
SYNC-202: Arama indeksinde profil “Gizli” rozeti 5 sn içinde görünür.
SYNC-203: Bekleyen istek kabul edilince feed/DM izinleri anında açılır.
A11Y/UX
A11Y-301: Kilit/uyarı metinleri ekran okuyucuda anlaşılır.
A11Y-302: “Kabul/Reddet” tuşları klavye ile erişilebilir.
n) Kabul Kriterleri (Örnek)
Gizli profilde gönderiler/hikâyeler yalnız onaylı takipçilere görünür.
Takip butonu gizli profilde istek oluşturur; sahip Kabul/Reddet edebilir.
Gizli içerik Keşif/Hashtag’de takipçi olmayanlara hiç görünmez.
Dış/DM paylaşımında takipçi olmayanlar kilit ekranı görür; OG/thumbnail sızdırılmaz.
Public↔Private geçişlerinde cache/indeks tutarlılığı korunur (invalidations).
18- hesaplar “Herkese Açık”a geçemez (flag aktifken).
Telemetri: privacy_toggle, follow_request_*, private_content_gate_hit event’leri eksiksiz düşer.
o) Operasyon & Bakım
Takip istek flood’larında otomatik rate-limit eşiklerini ayarla.
Gizlilik geçişlerinde audit kayıtlarını izle (kim, ne zaman).
Yardım merkezi makroları: “Gizli profil nasıl çalışır?”, “Neden gönderim görünmüyor?”, “Takip isteği gelmiyor/gidiyor mu?”.
Düzenli güvenlik taramaları: OG/preview sızıntısı, ACL bypass denemeleri.
UYGULAMA RESPONSİVE OLACAK

17 - Süper admin : Süper Admin — Yetki Seti (Ne yapabilir?)
a) Kullanıcı & Roller
Her kullanıcının profilini ve hesap geçmişini kısıtsız görüntüler.
Rol ve etiket atar/kaldırır: admin, moderator, vendor, orgTier (enterprise/standard), marka satıcısı, lisanslı satıcı, KYC seviyeleri.
Hesap dondurma/açma, shadow-ban, riskli hesapları “inceleme moduna” alma.
Kullanıcı adları, sahte hesaplar, taklit markalar için nihai karar verir.
b) İçerik & Moderasyon
Her türlü gönderi/yorum/sponsorlu içeriği anında yayından kaldırır, karantinaya alır, gerekirse geri yükler.
Toplu moderasyon (dalga temizliği), hassas içerik filtre eşiklerini ve kara-liste sözlüklerini belirler.
Şikayet/rapor kuyruğunda nihai hakemdir; itiraz mekanizmasını yönetir.
c) Mağaza & Ürün Yönetimi
Tüm ürünleri ve vitrinleri görüntüler; uygunsuz ürünleri askıya alır veya siler.
“CringeBank” (kurumsal mağaza) içeriklerini yayınlar/düzenler; resmi kampanya ve paketleri tanımlar.
Ürün görünürlüğünü “vitrin pinleme” ve kategori vitrinleriyle yönetir.
d) Sipariş, Escrow, İade/İhtilaf
Açık siparişleri zorunlu tamamlar veya iptal eder; gerekçeli karar verir.
Escrow serbest bırakma/geri alma işlemlerinde son sözü söyler; kötüye kullanımda kilit uygular.
İhtilaf (dispute) süreçlerinin akışını ve süre SLA’larını belirler.
e) Finans & Faturalama
Sistem komisyon ve ücret politikalarını yönetir: satış komisyonu (%5), aylık üyelik (%2, yalnız enterprise + rozetliler), ilan ücreti (1. ay ücretsiz; sonrası 100 CG/ay).
Payout politikasını yönetir: nakit/TL sadece enterprise + (marka satıcısı ∨ lisanslı satıcı); borç/üyelik ödenmemişse payout kilidi.
Fatura şablonları, vergi oranları, kurallar ve CG↔TL kur senaryolarını belirler; tarihçeli değişim politikası uygular.
Finansa dair dış raporlama ve denetim taleplerini onaylar.
f) Sponsor & Reklam
Hedefleme politikalarını (cinsiyet/yaş/bölge/ilgi alanı) ve sınırlarını belirler.
Sponsor kampanyalarını onaylar/askıya alır; bütçe, cpm aralıkları ve marka güvenliği kurallarını yönetir.
Hileli gösterim/klik şüphesinde yaptırım uygular.
g) Yarışmalar & Etkinlikler
Yarışma açma/kapama, kurallar ve ödül politikalarını belirler; kazanan onayını verir.
Gerekirse yarışmaları geçici olarak tamamen pasifleştirir veya yeniden aktive eder.
h) Kategoriler & Taksonomi
Ana/alt kategoriler, etiket yapıları ve arama filtrelerini tanımlar.
Kategori adminlerini atar/geri alır; içerik standartlarını yayımlar.
i) Güvenlik & Uyumluluk
Panel ve kritik işlemler için MFA/IP kısıtları, oturum süreleri, erişim izinleri gibi güvenlik politikalarını belirler.
Veri saklama, anonimleştirme, KVKK/GDPR istek akışlarını yönetir.
Yukarıdan-aşağı olay müdahalesi (break-glass) gerektiren durumlarda süreci açar ve kapatır.
j) Sistem & Konfigürasyon
Özellik bayrakları (feature flags), deneyler, sürüm geçişleri ve bakım modlarını açıp kapatır.
Oran limitleri, kota, hız sınırları ve içerik işleme eşiklerini belirler.
Arka plan işler (settlement, üyelik tahakkuku, fatura ihracı, feed re-index) için manuel tetikleme yetkisi vardır.
k) Analitik & Raporlama
Tüm metrik panellerine erişir: büyüme, etkileşim, satış, ihtilaf oranı, gelir ve risk göstergeleri.
Denetim günlüklerini (audit) uçtan uca görür; dışa aktarım taleplerini onaylar.
l) İş Sürekliliği & Acil Durum
Kriz anlarında oran/fonksiyon değişikliklerini hızlıca uygular (ör. sponsorları durdurma, payout dondurma).
Saldırı/istismar şüphesi olduğunda geniş ölçekli koruma modlarını aktive eder.Süper admin başak bir süper admin atayabilir.2 süper adminden sonra atanan süper admin en az 2 süper adminin onaylaması sonucu süper admin olur. süper admin ve admin olan kullanıcıların sayfalarındaki hero kartlarında süper admin ise süper admin rozeti normal admin ise normal 	admin rozeti olur. Bu rozetleri normal kullanıcılar asla göremez.yarışmaları sadece süper admin ve o kategorinin admini oluşturabilir. 
UYGULAMA RESPONSİVE OLACAK

18 - Rozetler : 
a) Amaç & Kapsam
Amaç: Kullanıcı güvenini artırmak, topluluk katkısını görünür kılmak, kötüye kullanımı engellemek ve eğlenceli (kozmetik) kişiselleştirme sağlamak.
Kapsam: Rozet tipleri, veriliş/geri alma kuralları, görünürlük/öncelik, mağaza (CG) ilişkisi, veri modeli, telemetri, anti-abuse ve UAT.
b) Rozet Taksonomisi (V1)
b.1 Doğrulama Rozetleri (kimlik/güven)
Mor Tik (Verified+)
Kriter: Kimlik/doğrulama (KYC-lite veya kurumsal doğrulama), MFA + Passkey zorunlu, hesap yaşı ≥ 30g, ihlal geçmişi düşük.
Satın alınamaz. Kimlik ad/marka ile kullanıcı adı uyumlu olmalı.
Revizyon: 12 ayda bir yeniden doğrulama.
Gri Tik (Verified)
Kriter: E-posta + telefon doğrulanmış, MFA açık, ihlal geçmişi temiz, ad-soyad/marka tutarlılığı temel kontrolden geçmiş.
Satın alınamaz. Gri → Mor’a yükseltme için ek kanıt gerekir.
Personel/MIS (Staff/Moderator)
Yalnızca atama ile. Ayrı biçim; kullanıcı adında “official/real” gibi yanıltıcı ifadeler yasak.
b.2 Başarı/Topluluk Rozetleri (otomatiktir)
Erken Benimseyen, 100 Gönderi, 1K/10K Takipçi, Top #meme üreticisi, Bug Hunter, Topluluk Sağlığı (düşük rapor oranı).
Eşikler bölgesel/segment bazlı ayarlanabilir, geri alınabilir (metrik aşağı iner ise pasiflenir).
b.3 Etkinlik/Kampanya Rozetleri
Sınırlı süre (başlangıç/bitiş), süre dolunca griye düşer ya da arşivlenir. Pay-to-verify ile karışmaz.
b.4 Kozmetik Rozetler (CringeStore)
CG ile alınabilir, doğrulama ile karışmayan farklı şekil/renk.
Görünürlüğü kullanıcı kapatıp açabilir (profil ayarları).
İade/chargeback durumunda rozet geri alınır (entitlement iptali).
İlke: Pay-to-verify yok. Satın alınabilir rozetler kozmetiktir; doğrulama algısı yaratamaz.
c) Görünürlük & Öncelik Kuralları
Profil başlıkta: En fazla 4 rozet: (1) Mor Tik > (2) Personel/Mod > (3) Gri Tik > (4) Başarı > (5) Etkinlik > (6) Kozmetik sırası.
Gönderi kartı / yorum satırı: Yalnız Doğrulama & Personel ikonları kullanıcı adının yanında; diğerleri “rozet çekmecesi”nde (tooltip/bottom sheet).
Arama/Keşif: Doğrulama rozetleri listede görünür; kozmetik görünmez.
DM başlığı: Yalnız doğrulama rozetleri.
Etkileşim: Rozete dokun → alt sayfa: isim, açıklama, veriliş kriteri, veriliş tarihi, veren (issuer), geçerlilik/son kullanma, “Bu rozetle ilgili politika” linki, raporla.
d) Veriliş, Yenileme, Geri Alma (State Machine)
Grant → Active → (Expire|Revoke|Suspend) → Archive
Doğrulama (Mor/Gri):
Başvuru → belge/kanıt → manuel inceleme → grant.
Risk sinyali (ad değişimi, MFA kapatma, çoklu ihlal) → Suspend; 14 gün içinde çözülmezse Revoke.
Kullanıcı adı değişiminde yeniden kontrol (isim uyumu).
Başarı Rozetleri: Otomatik grant/auto-revoke (eşik altına düşerse “pasif” görünür).
Etkinlik: Otomatik grant; expiresAt ile düşer.
Kozmetik: IAP/CG entitlement → grant; iade/chargeback → revoke.
Anti-abuse: Rozetler sunucu kaynaklı; istemci tarafında kullanıcı ekleyemez. İkon seti isimleri whitelist’ten gelir.
e) Güvenlik, Anti-Abuse, Uyum
Pay-to-verify yok: Doğrulama rozetleri asla satışa çıkmaz; kozmetiklerle net görsel ayrım (şekil/rengi farklı).
İsim/İmaj kötüye kullanımı: “official/real/admin” vb. yasak; tespit edilirse rozetler askıya alınır.
MFA & Passkey koşulu: Mor Tik için zorunlu; Gri Tik için MFA zorunlu. Kapatılırsa Suspend.
Reklam/iş birlikleri: Sponsor rozetleri açık biçimde “sponsor” olarak etiketlenir; doğrulama ile karışmaz.
KVKK: Rozet gerekçesinde PII gösterilmez; yalnız rozet türü/kriter özeti.
Re-verifikasyon: 12 ayda bir veya risk anında (ad/marka değişimi, şüpheli oturumlar).
f) Tasarım & A11Y
Boyutlar: 16/20/24px; minimum dokunma alanı 32×32dp.
Kontrast: WCAG AA; karanlık/açık temada net görünür.
Animasyon: Yalnız ilk grant veya hover’da ≤400 ms, döngüsüz.
SR/Screen Reader: “Rozet: Mor Tik – Doğrulanmış hesap”.
Yerleşim: Kullanıcı adından sonra 4px boşluk; çoklu rozetler arası 2–4px.
g) Veri Modeli (Kavramsal)
Firestore

/badges_catalog/{badgeId}:
  type: "verify|staff|achievement|event|cosmetic"
  key, name, description, iconUrls{16,20,24}, priority, rules{...}

 /users/{uid}/badges/{userBadgeId}:
  badgeId, type, variant, issuer, issuedAt, expiresAt, status: "active|suspended|revoked|archived",
  evidenceRef?, reason?, visible:true/false

Azure SQL
BadgesCatalog(id, type, key, priority, i18nKey, iconRef, rulesJson)
UserBadges(uid, badgeId, status, issuedAt, expiresAt, issuer, reason)
BadgeEvents(uid, badgeId, eventType, ts, metaJson)
İndeks/Senkron: Outbox event’leri (BadgeGranted, BadgeRevoked) ile arama/keşif sinyali güncellenir.
h) Telemetri & Bildirimler
Event’ler: badge_grant, badge_revoke, badge_view_sheet, badge_toggle_visibility, verify_apply_start/submit/approved/rejected.
Bildirim: “Tebrikler! {Rozet Adı} rozetini kazandın.” → profil derin link.
Metrikler: Grant→profil görüntüleme etkisi, güven/takip dönüşümü, itiraz oranı, iade kaynaklı revoke oranı.
i) Kenar Durumları
Kullanıcı adı değişti: Mor/Gri yeniden doğrulama; geçici Suspend.
MFA kapatıldı: Mor → Suspend, Gri → Warning (X gün içinde aç).
Özel (Gizli) profil: Rozetler görünür; içerik yine gizlilikle kısıtlı.
Çoklu cihaz: Rozet grant/revoke <1 sn içinde senkron (realtime + cache invalidate).
Çocuk hesap (18-): Kozmetik rozetler sınırlanabilir; doğrulama için ebeveyn izni (politika bayrağı).
j) Feature Flags (Rollout)
FEATURE_BADGE_PURPLE_TICK
FEATURE_BADGE_GREY_TICK
FEATURE_BADGE_COSMETIC_STORE
FEATURE_BADGE_ACHIEVEMENTS
FEATURE_BADGE_SHELF_UI (rozet çekmecesi)
Açılış: %5 → %25 → %50 → %100; anomali (suistimal, sahte başvurular) durumunda geri alma.
k) UAT / Test Senaryoları (Örnek)
Pozitif
BDG-001: Gri Tik kriterlerini sağlayan kullanıcı → başvuru → onay → profil/gönderide gri tik görünür.
BDG-002: Mor Tik + MFA/Passkey açık → başvuru onay → arama/DM başlığında mor tik görünür.
BDG-003: 1K takipçi eşiği → “1K” başarı rozeti otomatik verilir; 900’e düşünce pasif, 1K’yı geçince yine aktif.
BDG-004: Kozmetik rozet CG ile satın al → entitlement → rozet aktif; görünürlüğü kapat/aç.
Negatif / Güvenlik
NEG-101: “official/real/admin” benzeri yanıltıcı kullanıcı adı → uyarı + doğrulama askı.
NEG-102: MFA kapat → Mor Tik Suspend; açınca Restore.
NEG-103: IAP iadesi → kozmetik rozet Revoke.
NEG-104: Kullanıcı, benzer ikonla isim/emojiden sahte rozet taklidi yapmaya çalışır → UI rozet alanına kullanıcı içeriği sokulmaz; raporlanır.
Senkron/Performans
SYNC-201: Grant sonrası rozetler profil/gönderi/arama’da <1 sn görünür.
SYNC-202: Revoke sonrası tüm yüzeylerde anında kalkar.
PERF-301: Rozet ikonları sprite/CDN ile p95 < 50 ms yüklenir.
A11Y/UX
A11Y-401: SR’da “Rozet: Mor Tik – Doğrulanmış hesap” okunur.
A11Y-402: Alt sayfada rozet açıklaması ve kriterleri net, linkler odaklanabilir.
l) Kabul Kriterleri (Örnek)
Doğrulama rozetleri satın alınamaz, yalnız başvuru/inceleme ile verilir.
Mor Tik: MFA + Passkey zorunlu; kapatılırsa Suspend.
Rozet öncelik sırası: Mor > Staff/Mod > Gri > Başarı > Etkinlik > Kozmetik; profil başlıkta max 4 rozet.
Gönderi/yorum satırında yalnız doğrulama/staff rozeti görünür.
Kozmetik rozetler doğrulama ile görsel olarak karışmaz.
Grant/Revoke olayları tüm yüzeylerde <1 sn yansır; telemetri düşer.
İtiraz/rapor akışı mevcut; ihlalde rozet askı/revoke edilir.
m) Operasyon & Bakım
Doğrulama kuyruğu SLA: 3 iş günü (hedef).
Risk sinyalleri: isim/rozet uyuşmazlığı, MFA kapanması, iade dalgaları.
Yardım makroları: “Mor Tik başvurusu nasıl?”, “Rozetim niye gitti?”, “Kozmetik rozetim kayboldu”.
İkon seti ve metinler i18n; kampanya rozetleri için takvimli otomasyon.
UYGULAMA RESPONSİVE OLACAK

19 - Uygulama içi sponsorlu ürün ve kişi reklamları : 
a) Amaç & Kapsam
Amaç: CringeStore’daki ürünleri ve profilleri/gönderileri (kişi/creator) adil, güvenli, etiketli ve performanslı şekilde öne çıkarmak.
Kapsam: Reklam türleri, yerleşimler, hedefleme, bütçe & tempo, frekans sınırları, karışım/ranking kuralları, moderasyon & marka güvenliği, ölçüm, telemetri, kabul kriterleri ve UAT.
b) Reklam Türleri (V1)
Ürün Reklamı (Store Promote)
Hedef: Satın alma / ürün sayfası görüntüleme.
Kaynak: CringeStore ürün kartı → “Öne çıkar (CG)”.
Kişi/Profil Reklamı (Follow Promote)
Hedef: Takipçi kazanımı / profil görüntüleme.
Kaynak: Profil → “Öne çıkar (CG)”.
Gönderi Boost (Post Promote)
Hedef: Etkileşim (beğeni/yorum/kaydet/paylaş).
Kaynak: Gönderi menüsü → “Öne çıkar (CG)”.
Minör hesaplar (18-) ve Gizli profiller, takipçi olmayanlara reklam veremez (gizlilik/yaş güvenliği).
c) Yerleşimler (Placements)
Feed içi kart (native): Her 8–12 organik kartta 1 sponsor slot (A/B).
Arama/Keşif sonuçları: İlk 10 sonuçta en fazla 1 sponsor.
Profil öneri modülü (Follow Promote): takip önerileri arasında sponsorlu blok.
Store grid: Kategori başına üst sıralarda etiketli sponsor döşeme.
Etiket: Her yerde net görünür: “Sponsorlu / CG ile öne çıkarıldı” + “Neden görüyorum?” menüsü.
d) Hedefleme (Privacy-first)
Demografi: Yaş bandı (18- uygun değil), cinsiyet (opsiyonel), cihaz/OS.
Coğrafi: Ülke/şehir (ipuçlarıyla; hassas konum yok).
İlgi/niyet: Kategori/etiket etkileşimleri, izlenen içerik tipleri.
Dışlama: Engellenen kullanıcılar, önceki kötü deneyimler, hassas kategoriler.
Frekans & cap: Kişi başına X/gün, Y/hafta (özelleştirilebilir).
Şeffaflık: “Neden görüyorum?” → hedefleme sinyalleri özet + kapat/azalt seçenekleri.
Kişisel veri reklam modeline sokulmaz; yalnız uygulama içi davranış sinyalleri ve izinli tercihleri kullan.
e) Bütçe, Teklif (Bid) ve Tempo
Para birimi: CG (tam sayı).
Teklif modeli: Basit açık artırma + kalite skoru:
AdRank = Bid_CG × QualityScore
QualityScore: tahmini CTR, rapor/şikayet oranı, yaratıcı kalite, hedef uyumu.
Tempo (Pacing): Düzgün harcama (even pacing) + talebe göre hızlandırma.
Limitler: Günlük CG üst sınırı, toplam kampanya bütçesi, CPM taban (minimum kalite).
f) Karışım / Sıralama (Serving)
Karışım oranı (feed): %85 organik / %15 sponsor üst sınır (kullanıcı bazlı dinamik azaltma).
Çeşitlilik: Aynı reklamveren ardışık görünmez; tekrarı min. 10 kart arayla.
Kalite-eşiği: Şikayet/rapor oranı yüksek yaratıcılar otomatik bastırılır.
Gizlilik saygısı: Gizli profil/gönderi, takipçi olmayanlara asla düşmez.
g) Yaratıcı (Creative) & Politikalar
Ürün: Kapak/galeri, net başlık, kısa fayda, fiyat (CG).
Kişi/Profil: Avatar + kısa “neden takip etmeli” metni; aldatıcı vaat yok.
Görsel/video sınırları: Topluluk kurallarına uyum, müstehcen/tetikleyici içerik yok; telif kontrolü.
Metin: 90 karakter başlık, 140 alt metin öneri; küfür/nefret/spam filtresi.
Reddedilen kategoriler: Kumar, yetişkin içerik, tıbbi iddia, yanıltıcı gelir vaatleri, kişisel veri arama vb.
h) Kullanıcı Deneyimi (UX)
Kart üstünde etiket, menüde “Neden görüyorum?” ve “Benzerlerini azalt / bu reklamı gizle / şikayet et”.
Tık → ilgili hedef (ürün/profil/gönderi) derin link.
Dışa paylaşımda OG önizleme, fakat gizli içerik kilit ekranına yönlenir.
Çocuk/18-: reklam gösterimi kapatılır; profil boost izin verilmez.
i) Ölçümleme & Atıf
Temel metrikler: İzl.&Görünürlük (impression/viewable), tıklama, CTR, CG_spent, CPM/ CPC/ CPA (hedefe bağlı).
Hedef olayları:
Ürün: purchase_success (entitlement teslim)
Profil: follow_success
Gönderi: engagement_success (like/yorum/kaydet)
Atıf penceresi: Tıklama 7 gün, gösterim 24 saat.
Raporlama: Kampanya/yaratıcı/yerleşim kırılımları; gerçek zamanlı panele özet.
j) Fraud, Güvenlik & Marka Güvenliği
Bot/tekrar tıklama: IP/device/UA parmak izi + hız freni; anomali modelleri.
Click-guard: Şüpheli tıklamalar ücretlendirme dışı.
Brand Safety: Hassas içerik yanında sponsor gösterilmez (negatif bağlam filtreleri).
Kara liste: Reklamveren/alan/kategori bazlı.
Şikayet hattı: “Bu reklamı bildir” → mod kuyruğu; ihlalde suspend.
k) KVKK / Rıza / Mağaza Uyumu
Rıza merkezi: Pazarlama/kişiselleştirme ayarları; “kişiselleştirilmiş sponsorlar” kapatılabilir → genel (kontekstsiz) sponsorlar.
PII yok: Reklam hedeflemesi için hassas veri işlenmez.
Mağaza uyumu: Satın alma CG/IAP kurallarına uygun; reklamda harici ödeme linki yok.
l) Veri Modeli (Kavramsal)
Firestore

/ads/{adId}: type(product|profile|post), ownerUid, status(draft|active|paused|rejected|ended),
creatives{...}, targeting{...}, budgetCG, spentCG, pacing, caps{freqPerUser, daily}, qaScore, review{state,reason}
/ad_events/{adId}/{eventId}: impression|click|hide|report|conversion, ts, meta
/user_prefs/{uid}/ads: personalized(true|false), hiddenAdvertisers[], reduceSimilar

Azure SQL
Ads, AdCreatives, AdSpend, AdEvents, AdQuality, AdReviewQueue.
m) Telemetri, Log & Alarm
Event’ler: ad_impression, ad_viewable, ad_click, ad_hide, ad_report, ad_conversion_{follow|purchase|engage}, ad_budget_pace, ad_quality_drop.
Alarmlar: CTR anomali, şikayet oranı eşiği, viewability düşüşü, pacing sapması, fraud skoru.
n) Performans Hedefleri
Karar süresi (serve): p95 < 50 ms (ön seçilmiş aday havuzundan).
İlk boya: Sponsor kart skeleton < 100 ms, yükleme bloklamaz.
Karma rulo: Scroll’da jank yok; önbellek + lazy load.
o) Self-Serve Akış (Reklamveren)
Hedef seç (Satın alma / Takip / Etkileşim)
Yerleşimler (varsayılan öneriler)
Hedefleme (ülke/şehir, ilgi, yaş 18+)
Bütçe & süre (günlük/toplam CG)
Yaratıcı (görsel/video/metin) + anlık politika kontrolü
Önizleme & etiket kontrolü
Ödeme (CG bakiyesi; yetersizse “CG yükle”)
Yayın → otomatik/manuel inceleme sonucu
Takip & raporlama (panel)
p) Feature Flags (Rollout)
FEATURE_SPONSORED_SLOTS (genel)
FEATURE_ADS_PROFILE_PROMOTE
FEATURE_ADS_POST_BOOST
FEATURE_ADS_TARGETING_ADVANCED (ilgi/bölge ince ayar)
FEATURE_ADS_FREQ_CAPS_PER_USER
FEATURE_ADS_BRAND_SAFETY (negatif bağlam maskesi)
FEATURE_ADS_REPORTING_DASH
Açılış: %5 → %25 → %50 → %100; kalite/şikayet eşiğinde geri alma.
r) UAT / Test Senaryoları (Örnek)
Pozitif
ADS-001: Feed’de 10 organik kartta 1 sponsor görünür; etiket doğru.
ADS-002: Ürün reklamı tık → ürün detay; purchase_success atıf olur.
ADS-003: Profil reklamı tık → follow_success kaydolur.
ADS-004: “Neden görüyorum?” tık → hedefleme özeti + azalt/gizle çalışır.
ADS-005: Bütçe CG bitti → kampanya durur, makul gecikmeyle rapora yansır.
ADS-006: Kişiselleştirme kapalı → yalnız genel sponsorlar gösterilir.
Negatif / Güvenlik
NEG-101: 18- hesap profil reklamı açmaya çalışır → blok + bilgilendirme.
NEG-102: Gizli profil boost → takipçi olmayanlara düşmez.
NEG-103: Şikayet oranı %X’i geçer → kalite eşiği → kampanya otomatik bastırılır.
NEG-104: Aynı reklamveren ardışık görünsün denemesi → karışım kuralı engeller.
NEG-105: Phishing içerikli yaratıcı → moderasyon reddi.
Senkron/Ölçüm
SYNC-201: Tıklama → hedef olay (follow/purchase/engage) 7g pencerede atfedilir.
SYNC-202: CG harcama defteri idempotent; çift yazım olmaz.
SYNC-203: Gizlilik/kişiselleştirme ayarları değişince sunum anında uyarlanır.
A11Y/UX
A11Y-301: “Sponsorlu” etiketi SR’da okunur; menü seçenekleri odaklanabilir.
A11Y-302: Yaratıcı metinleri kontrast ve uzunluk kurallarına uyar.
s) Kabul Kriterleri (Örnek)
Tüm sponsor kartları açık biçimde etiketli: “Sponsorlu / CG ile öne çıkarıldı”.
Karışım oranı üst sınırı: feed’de ≤ %15 sponsor.
Frekans cap ve çeşitlilik kuralları ihlal edilmez.
Minör/gizli profiller, takipçi olmayanlara reklam veremez.
Hedef olay atfı (follow/purchase/engage) ve raporlama doğru işler.
Şikayet/fraud eşiğinde kampanya otomatik bastırılır/suspend.
KVKK/rıza: Kişiselleştirilmiş reklam tercihi opt-in’e saygı duyar.
CG harcaması ve kampanya durumu gerçek zamanlı yansır.
t) Operasyon & Bakım
Kreatif inceleme SLA: < 24 saat (otomasyon + manuel).
Sözlük & sınıflandırıcılar: Toksisite/telif/brand-safety listeleri düzenli güncellenir.
Kalite panosu: CTR/şikayet/fraud ısı haritası; otomatik bastırma kuralları.
Destek makroları: “Neden reddedildim?”, “Bütçem neden erken bitti?”, “Hedefleme neden dar?”
u) Yol Haritası (V2+)
Hedef optimizasyonu (tROAS/tCPA benzeri) – CG bazlı.
Çok değişkenli kreatif testleri (A/B/C).
Sıcak kitleler (retargeting) – yalnız uygulama içi ve rızaya dayalı.
Kamuya açık şeffaflık raporu – sponsor kategorileri ve hacimlerinin özeti.
UYGULAMA RESPONSİVE OLACAK

20 - Muhasebe ve Faturalandırma : 
a) Amaç & Kapsam
Amaç: Dijital gelirlerin uçtan uca yönetimi: sipariş→ödeme→fatura→muhasebe kaydı→uzlaştırma→raporlama.
Kapsam: Gelir akışları, genel muhasebe (GL) eşlemeleri, sanal para (CG) defteri, vergi/faturalandırma, iade/chargeback, uzlaştırma, kapanış, raporlama, telemetri ve UAT.
Not: Hukuki/vergisel detaylar ülkeye göre değişir; mimari bölgesel kurallara göre esnek bırakılmıştır (TR/EU/US profilleri).
b) Gelir Akışları (V1)
CG Paket Satışı (IAP)
Müşteri Apple/Google IAP ile CG paketi alır → CG bakiyesi artar.
Muhasebe: Nakit/Alacak → Ertelenmiş Gelir (CG yükümlülüğü). Gelir, CG harcandıkça tanınır (breakage politikası ayrıca).
Canlı Para Satışı (CringeStore Marketplace)
Alıcı fiat para (TL/USD/EUR) ile ödeme yapar; ödeme sağlayıcısı tahsilatı gerçekleştirir.
Muhasebe: Brüt sipariş → Alıcıdan Tahsilat (Ödeme Sağlayıcı Alacağı); Platform Komisyonu %5 Gelir olarak, Satıcı payı Payout Yükümlülüğü olarak kaydedilir. Vergiler bölgesel kurala göre hesaplanır.
Sponsor/Öne Çıkarma (CG ile)
Görünürlük hizmeti; gösterim/klik/hedef olaya göre kademeli gelir tanıma (pacing oranı).
İadeler/Chargeback
IAP iadesi: Önce bonus CG düşer, sonra satın alınan CG; yetmiyorsa harcama kilit ve/veya geçmiş gelirden ters kayıt.
Marketplace iadesi: Ödeme sağlayıcısı üzerinden ters işlem; komisyon geri alınır, satıcı payı yeniden tahakkuk edilir.
c) Muhasebe İlkeleri (yüksek seviye)
Defter yapısı:
CG Cüzdan Defteri (kullanıcı bazlı) → işlem bütünlüğü, idempotent.
Finansal Defter (GL) → gelir/ertelenmiş gelir/komisyon/vergiler.
Gelir tanıma: CG satış anında değil, harcamada (entitlement tesliminde) tanınır.
Breakage (kullanılmayan CG): Politika ile (ör. etkinlik yoksa X ay sonra oransal tanıma).
Komisyonlar: Mağaza komisyonları (Apple/Google) bölgesel/programma göre değişken; netleştirme veya gider olarak sınıflandırılabilir.
Zaman damgası: Tüm finansal kayıtlar UTC; kapanışta yerel rapor dönüşümü yapılır.
d) Hesap Planı (Örnek GL Eşleşmeleri)
100—Kasa/Banka—IAP Tahsilat Geçici
102—IAP Alacakları (Platform bazlı)
104—Ödeme Sağlayıcı Alacakları (Marketplace fiat)
120—Müşteriler (gerekirse)
320—Ertelenmiş Gelir—CG Yükümlülüğü
321—Payout Yükümlülüğü—Satıcı Fiati
600—Dijital Ürün Gelirleri
602—Reklam/Öne Çıkarma Gelirleri
603—CringeStore Komisyon Gelirleri (Fiat)
610—İndirim & Promosyon (Kontra gelir)
620—Mağaza Komisyon/Giderleri
391—Hesaplanan KDV / yerel dijital hizmet vergileri (bölgesel kurala bağlı)
689—Şüpheli/Fraud Düzeltmeleri (geçici)
Gerçek hesap numaraları kendi tekdüzen planına göre uyarlanır.
e) Faturalandırma (B2C/B2B)
B2C (V1):
IAP makbuzu kullanıcıya platform tarafından sağlanır.
Uygulama içi CG satın alma geçmişi ve entitlement faturası/e-arşiv (bölgeye göre) gösterilir.
B2B (opsiyonel):
Kurumlara toplu lisans/özel görünürlük satışı varsa e-fatura/e-arşiv gerekir.
TR Özel Notları (yapı):
e-Arşiv/e-Fatura entegrasyonu (entegratör API) → B2C’de e-Arşiv, B2B’de e-Fatura profili.
KDV oranı ürün türüne göre (dijital hizmet); bölgesele göre parametrik.
Fatura içeriği: Ünvan/ad, vergi numarası (B2B), tarih, ürün/hizmet adı, birim (CG paketi/dijital hizmet), KDV/vergiler, toplam.
Bölgesel vergi/kayıt yükümlülükleri (ör. OSS/MOSS, dijital hizmet vergisi) için yerel danışmanla uyum kuralı belirlenir; sistem parametreleri ülke/bölge bazında.
f) Akışlar (State Machine)
f.1 CG Satın Alma (IAP)
Kullanıcı CG paketi seçer → IAP başlar.
Mağaza makbuzu doğrulanır (sunucu) → WalletEntries.CREDIT_IAP.
GL:
Dr Banka/IAP Alacağı, Cr Ertelenmiş Gelir—CG.
Komisyon: Dr Mağaza Komisyon Gideri, Cr Banka/IAP Alacağı (veya netleştirme).
Kullanıcı bakiyesi artar; fatura/makbuz bilgisi kaydedilir.
f.2 Marketplace Satışı (Canlı Para)
Sipariş oluşturulur → ödeme sağlayıcısı tahsilatı alır.
Orders.Trx → status=payment_captured; komisyon ve satıcı payı hesaplanır.
GL: Dr Ödeme Sağlayıcı Alacağı, Cr CringeStore Komisyon Gelirleri (komisyon tutarı), Cr Payout Yükümlülüğü (satıcı net tutarı).
Vergiler: Cr Hesaplanan KDV (komisyon tarafı) + satıcı tarafı bilgilendirme.
Payout gerçekleştiğinde: Dr Payout Yükümlülüğü, Cr Banka (transfer).
f.3 CG Harcama (Dijital Özellik/Sponsor)
Kullanıcı CG harcar → dijital entitlement teslim edilir (sponsor, rozet vb.).
WalletEntries.DEBIT_{SPONSOR|COSMETIC}.
GL: Dr Ertelenmiş Gelir—CG, Cr Gelir{Dijital|Reklam}. Vergi varsa (bölgeye göre) Cr Hesaplanan KDV.
f.4 İade/Chargeback
IAP iadesi/chargeback: CG düşümü (önce bonus, sonra satın alınan) → yetersizse kullanım kilidi ve ters kayıt. GL: Dr Gelir (Ters)/Dr Ertelenmiş Gelir—CG, Cr Banka/IAP Alacağı.
Marketplace iadesi: Ödeme sağlayıcısı ters işlem → GL: Dr CringeStore Komisyon Gelirleri (ters), Dr Payout Yükümlülüğü (satıcı payı çözülür), Cr Ödeme Sağlayıcı Alacağı (veya Banka). Satıcıya yapılmış payout varsa ters kayıt (Dr Banka, Cr Payout Yükümlülüğü).
f.5 Promosyon/Bonus CG
Grant: Dr Pazarlama Gideri (veya Kontra gelir), Cr Ertelenmiş Gelir—CG (bonus yükümlülük).
Harcama anında normal gelir tanıma.
g) Uzlaştırma & Kapanış
Mağaza Uzlaştırma: Günlük/haftalık raporlardan IAP transaction id eşlemesi; farklar uzlaştırma tablosuna.
Marketplace Uzlaştırma: Ödeme sağlayıcı raporları (iyzico/PayTR/Stripe) Orders & Transactions ile eşlenir; komisyon, satıcı payı ve transfer ücretleri mutabakatı yapılır.
CG Defter ↔ GL: WalletEntries toplamı, GL’deki Ertelenmiş Gelir—CG bakiyesiyle eşit olmalı.
Kapanış (Aylık):
Açık makbuz/iade listesi, komisyon raporu, vergisel özet.
Breakage hesaplaması (politika → oransal tanıma).
Kilitleme: Dönem GL kilidi, geçmişe yazım yok.
h) Veri Modeli (çekirdek tablolar)
Firestore
/wallet_ledger/{uid}/{entryId}: type, amountCG, requestId, createdAt
/iap_receipts/{storeTxnId}: platform, payloadHash, status, user, mappedEntries[]
/invoices/{invoiceId}: buyer, lines[], tax, totals, pdfUrl, region, status
 /orders/{orderId}: summary, priceFiat, currency, sellerId, status, paymentProvider, createdAt
Azure SQL
WalletEntries (id, uid, type, amount, ts, request_id)
IapReceipts (store_txn_id, platform, status, amount_local, currency, user_id, linked_entry_id)
GL_Entries (id, account, debit, credit, ts, doc_ref)
Invoices (id, buyer_type, tax_profile, total, tax_total, currency, pdf_ref, region, status)
 Orders (id, buyer_id, seller_id, amount_gross, commission_amount, currency, status, payment_provider, captured_at)
 Transactions (id, order_id, provider_reference, status, fee, net_amount, currency, settled_at)
 Payouts (id, seller_id, amount, currency, status, iban, scheduled_at, paid_at)
Reconciliation (source, period, delta, notes)
i) Güvenlik, Uyum, Anti-Abuse
Makbuz doğrulama zorunlu (server-side).
Idempotency: request_id ile çift yazım yok.
Fraud: Kısa sürede anormal IAP/iade → inceleme ve geçici kullanım kilidi.
KVKK: Faturada gösterilen zorunlu bilgiler haricinde PII tutma; finansal veriler ayrı KMS ile şifreli.
Erişim: Finans dokümanları yalnız yetkili roller (role-based ACL).
j) Raporlama Panosu (Finans)
Özet KPI: Brüt CG satışı, Marketplace GMV (fiat), komisyon gelirleri, net gelir, iade/chargeback oranı (IAP + Marketplace), CPM/CPC/CPA (reklam), ARPPU, breakage, KDV/vergiler, payout bekleyen tutar.
Detay: Bölge/kanal/ürün bazlı gelir, ödeme sağlayıcı performansı, komisyon etkisi, satıcı ciro dağılımı, kampanya verimliliği.
Dönemsel: Günlük/haftalık/aylık kapanış raporları (CSV/XLSX).
k) Performans & Dayanıklılık
Makbuz doğrulama p95 < 800 ms (cache’li).
GL yazımı asenkron ama en geç 60 sn içinde tamamlanır; başarısızlıkta kuyruk retry ve alarm.
Defter tutarlılığı için artımlı kontroller (saatlik).
l) Telemetri & Alarm
Event’ler: iap_validate_start/success/fail, wallet_credit/debit, order_created, payment_captured, payout_initiated/completed, invoice_emit, gl_post, reconcile_ok/fail, refund_processed.
Alarmlar: Uzlaştırma farkı, GL gecikmesi, iade oranı piki (IAP + Marketplace), makbuz doğrulama hataları, ödeme sağlayıcısı başarısızlık oranı, geciken payout kuyruğu, telemetri şema uyuşmazlığı.
Telemetri event adları ana şema (events_finance.yaml) ile YAML tabanlı CI doğrulamasından geçer; başarısız doğrulama deploy’u durdurur.
m) Edge-Cases
Fiyat değişimi (mağaza tier): Sipariş onay ekranı güncel fiyatı gösterir; farklıysa kullanıcıdan tekrar onay alınır.
Para birimi farkı: IAP yerel para, iç sistem CG; raporda her iki görünüm.
Çoklu cihaz aynı anda IAP: storeTxnId tekilleştirme; tekrar doğrulama no-op.
Marketplace payout gecikmesi: Ödeme sağlayıcısı başarısızlığı → Payout yeniden deneme kuyruğu, satıcıya durum bildirimi.
Kısmi hizmet teslimi (sponsor): Harcama oranına göre günlük gelir tahakkuku.
n) UAT / Test Senaryoları (Örnek)
Pozitif
ACC-001: CG paketi IAP → makbuz doğrulandı → Wallet CREDIT_IAP + GL’de Ertelenmiş Gelir artar.
ACC-002: Marketplace siparişi (fiat) → payment_captured → komisyon gelir kaydı + satıcı payout yükümlülüğü oluşur.
ACC-003: Payout talebi → onay → banka API’si “paid” → GL’de Payout Yükümlülüğü kapanır.
ACC-004: Sponsor kampanyası CG ile harcanır → Wallet DEBIT_SPONSOR → Ertelenmiş Gelir düşer.
ACC-005: Fatura (e-Arşiv/e-Fatura) kesilir → PDF erişilebilir; veriler GL doc_ref ile bağlı.
Negatif / Güvenlik
NEG-101: Aynı storeTxnId ikinci kez geldi → idempotent, ikinci çağrı no-op.
NEG-102: Makbuz sahte/expired → doğrulama fail, CG yüklenmez, kullanıcı dostu uyarı.
NEG-103: Marketplace iadesi → provider reverse → komisyon ve payout ters kayıtları otomatik çalışır.
NEG-104: Payout başarısız → işlem “failed” → otomatik yeniden dene + satıcıya uyarı.
NEG-105: Uzlaştırma farkı > eşik → alarm + inceleme.
NEG-106: İade tutarı kısmi → ödeme sağlayıcısı reverse_partial → GL’de komisyon ve payout kısmi ters kayıt, satıcı bakiyesi güncellenir.
NEG-107: Payout SLA ihlali → gecikme alarmı tetiklenir, dashboard kırmızıya düşer; finans ekibi RCA tamamlayıp kayıt altına alır.
Senkron/Performans
SYNC-201: IAP onay → 60 sn içinde GL kayıtları tamamlandı.
PERF-301: Finans raporu (günlük) < 5 sn içinde yüklenir (önceden toplanmış metrikler).
o) Kabul Kriterleri (Örnek)
IAP makbuzu server-side doğrulanmadan CG kullanılamaz.
CG satışında Ertelenmiş Gelir; harcamada Gelir tanınır.
İadelerde ilgili CG ve gelir anında ters kayıt ile düzeltilir.
Marketplace siparişlerinde ödeme sağlayıcısı onayı olmadan status “completed” olmaz; komisyon ve payout kayıtları eş zamanlı oluşur.
GL ↔ Wallet ve IAP/Marketplace uzlaştırması sıfır fark ile kapanır.
Faturalar (TR’de e-Arşiv/e-Fatura) entegratör üzerinden kesilebilir ve indirilebilir.
Tüm finans olayları request_id ile idempotent ve audit-trail’li.
Chargeback veya kısmi iade durumlarında komisyon ve payout kayıtları otomatik ters kayıtla güncellenir; satıcı ve finans ekipleri anında bilgilendirilir.
Payout kuyruğu seçilen moda göre SLA (haftalık ≤ 2 iş günü, aylık ≤ 5 iş günü) içinde kapanır; gecikmeler alarm üretir ve escalation akışı tetikler.
Finans telemetri event adları ana şema ile birebir eşleşir; CI doğrulaması geçmeden prod deploy yapılamaz.
Audit log ve request_id izleri en az 7 yıl saklanır; erişimler role-based olarak raporlanır.
p) Operasyon & Bakım
Aylık kapanış kontrol listesi: uzlaştırma, breakage, vergi raporları, audit log incelemesi.
Entegratör SLA’leri (e-fatura, e-arşiv) ve mağaza raporları rutin kontrol.
Finansal erişim rolleri, iki kişilik onay (four-eyes) ve MFA zorunlu.
Dış muhasebe sistemlerine (Logo/Paraşüt/QuickBooks/Xero) CSV/JSON ihracı.
Payout SLA takip tablosu: Haftalık mod için 2 iş günü, aylık mod için 5 iş günü KPI; sapma alarmı ve RCA zorunlu.
Telemetri şeması değiştikçe finance-team review checklist’i çalıştırılır; events_finance.yaml versiyon bump edilmeden yayın yapılmaz.
q) Operasyon dashboard’ları: Payout SLA termometresi, kuyrukta bekleyen siparişler, chargeback/iade trendleri, telemetri şema sağlık durumu; haftalık finans toplantısında gözden geçirilir.
r.1 Veri kaynakları
- Azure SQL /Payouts: scheduled_at, paid_at, status, seller_id, amount.
- Azure SQL /Orders & /Transactions: payment_captured_at, refund_at, dispute_status, provider_failure_code.
- Telemetri: payout_initiated/completed, payout_sla_breach, refund_processed, dispute_opened. Tüm event’ler BigQuery/Snowflake’e stream edilir.
- Finance config: payout_mode (haftalık/aylık), SLA iş günü parametreleri, escalation contacts.
r.2 Metrikler
- SLA termometresi: (paid_at − scheduled_at) iş günü hesaplaması; %95 ≤ hedef.
- Kuyrukta bekleyen siparişler: scheduled_at ≤ now ve status in (“pending”, “in_review”).
- Chargeback/iade trendi: dispute_opened, refund_processed event oranları (son 7/28 gün).
- Telemetri şema sağlık puanı: events_finance.yaml ile uyumlu event sayısı / toplam event.
- Alarm denetimi: payout_sla_breach ve telemetri şema uyuşmazlığı event’lerinin ortalama çözüm süresi.
r.3 Veri işleme / CI entegrasyonu
- BigQuery/Snowflake materialized view: payout_sla_fact (kaynak Azure SQL ETL + telemetri stream). Kolonlar: payout_id, seller_id, scheduled_at, paid_at, sla_business_days, status, breach_flag, breach_reason.
- ETL pipeline: Airflow/Prefect işi her 15 dakikada Azure SQL’den CDC ile Payouts/Orders/Transactions çekip warehouse’a yazar; idempotent run_id ile kayıt tutar.
- Telemetri stream: events_finance topic → Pub/Sub → Dataflow → BigQuery; schema registry doğrulaması başarısızsa event rejected queue’ya düşer.
- CI job: events_finance.yaml değişince `dart run tool/validate_events.dart` + schema registry testi. Başarısız olursa merge engellenir.
- Dashboard publish: Looker/Metabase üzerinde payout_sla_dashboard; günlük snapshot PDF olarak finans ekip e-postasına gönderilir.
r.4 QA & operasyonel gözden geçirme
- Validasyon: ETL run_id ve telemetri event count metrikleri her sabah kontrol edilir; sapma varsa rollback + RCA açılır.
- Gölge dashboard: Yeni metrikler önce shadow modda çalıştırılır, baseline ile farkı < %5 olunca canlı panoya taşınır.
- Alarm testleri: SLA breach simülasyonu ve schema mismatch senaryoları ayda bir tetiklenir; alarm kanallarının (Slack/E-posta) çalıştığı doğrulanır.
- Finans haftalık toplantı ajandası: Payout SLA 4 haftalık trend, iade/chargeback oran değişimi, telemetri hata logları, open RCA listesi.
- Finans haftalık toplantı ajandası: Payout SLA 4 haftalık trend, iade/chargeback oran değişimi, telemetri hata logları, open RCA listesi.
r.5 Incident response
- SLA kritik ihlali (>%10 sipariş, >48 saat gecikme) → Incident Seviyesi P1; finans, operasyon ve mühendislik ortak çağrı açar.
- Zoom/Slack war room içinde anlık dashboard paylaşımı; gerekli ise payout kuyruğu manuel işlenir.
- Incident süresince değişiklik donması (change freeze) uygulanır; çözüm sonrası postmortem dokümanı 5 iş günü içinde tamamlanır.
- Postmortem aksiyonları Jira’da takip edilir; tamamlanana kadar dashboard’da “open actions” bölümü kırmızı kalır.
r.6 Güvenlik & uyum kontrolleri
- Veri koruma: Azure SQL ve warehouse verileri TDE + kolon bazlı şifreleme; transit veriler TLS 1.3.
- Sır yönetimi: Ödeme sağlayıcı API anahtarları ve banka entegrasyon kimlikleri HashiCorp Vault/Secret Manager’da; erişim sadece finans hizmet hesaplarına tanımlı.
- Yetki denetimi: RBAC politikaları üç ayda bir gözden geçirilir; finans & operasyon kullanıcıları için MFA + donanım anahtarı zorunlu.
- Kayıt saklama: Finansal loglar (GL, payout, audit) en az 7 yıl, telemetri ham verileri 2 yıl tutulur; yasal taleplere uygun silme politikası belgelenir.
- Uyum kontrolleri: MASAK/AML eşik raporlama, vergi dairesi EDI entegrasyonu, yıl sonu bağımsız denetim ve SOC 2 Tip II kanıtları için kontrol listeleri hazırlanır.
- Test & gözetim: Yıllık penetrasyon testi ve çeyreklik sızma simülasyonu (red team) sonuçları finans komitesine raporlanır; kritik bulgular 30 gün içinde kapatılır.
- Change management: Finans kodu ve altyapısı için zorunlu peer-review, imzalı deploy checklist’i ve otomatik compliance gate (lint/test/security scan) olmadan prod kapalısı.
r.7 Denetim checklist & otomasyon
- Quarterly kontrol listesi: AML raporlama, vergi uyumu, log retention, backup başarı oranı, access review, incident postmortem takip, telemetri şema doğrulama sonuçları.
- Evidence toplama: CI/CD pipeline her deploy’da kontrol çıktısını S3/Blob + immutable storage’a gönderir; denetim döneminde read-only paylaşılır.
- Otomatik rapor: `scripts/generate_finance_compliance_report.dart` günlük olarak SLA, güvenlik ve uyum metriklerini PDF/JSON çıktısı halinde üretir; finance-compliance@ mailing listesine iletilir.
- Alerting entegrasyonu: Compliance gate veya backup başarısız olursa PagerDuty “FIN-COMPLIANCE” servisi tetiklenir.
- DoD maddesi: Finansla ilgili her ürün sürümünde bu checklist’in tamamlandığı Product Review board’da doğrulanmadan release yapılmaz.
r.7.1 Rapor scripti teknik detayları
- Girdi kaynakları: BigQuery payout_sla_fact, Azure SQL GL/Payout tabloları, Vault API audit logları, backup başarı metrikleri (Prometheus), schema validation CI sonuçları.
- Argümanlar: `--date=YYYY-MM-DD` (varsayılan bugün), `--format=pdf|json|both`, `--output-dir=<path>`, `--send-email=true|false`.
- Çıktılar: `finance_compliance_<date>.json`, `finance_compliance_<date>.pdf`; metadata’da rapor versiyonu, hash ve oluşturma zamanı saklanır.
- İşleyiş: Script, servis hesapları ile read-only bağlantı açar; tüm sorgular parametrik ve idempotent. Hatalarda non-zero exit ve PagerDuty tetiklenir.
- Güvenlik: Secrets `.env` yerine CI’de provided; yerelde çalıştırmak için `scripts/set_flutter_env_user.ps1` ile gerekli env değişkenleri yüklenir.
- Test: `dart test test/scripts/generate_finance_compliance_report_test.dart` kritiktir; pipeline’da fail olursa rapor gönderilmez.
r.7.2 Dağıtım & sürümleme
- Zamanlama: GitHub Actions/Flutter CI üzerinden her gün 06:30 UTC’de cron job; başarısız çalıştırmalar 30 dk sonra tek sefer retry.
- Versiyonlama: Script içinde `report_spec_version` alanı tutulur; yeni metrik eklenince semver artar ve dokümana işlenir.
- Depolama: Üretilen raporlar Azure Blob (WORM policy) veya S3 Glacier’e 10 yıl saklanır; 2 yıl sonra düşük maliyetli sınıfa aktarılır.
- E-posta dağıtımı: SendGrid API üzerinden; DKIM/SPF kayıtları doğrulanmış, TLS enforced. Alıcı listesi Vault’ta saklanır, script runtime’da çeker.
- Audit trail: Rapora erişen her kullanıcı (SharePoint/Drive linki) IAM log’dan izlenir; aylık inceleme raporuna eklenir.
- Geri alma: Gönderilen raporda kritik hata tespit edilirse `scripts/revoke_finance_report.ps1` ile dağıtım listesine iptal bildirimi gönderilir ve hatalı rapor Flagged klasörüne taşınır.
r) Yol Haritası (V2+)
Abonelikler (yenileme, kısmi iade, pro-rata).
Çok ülkeli OSS/MOSS/yerel KDV motoru (kur/değişken oran parametreleri).
Otomatik banka entegrasyonu (hesap ekstresi import + otomatik uzlaştırma).
Veri ambarı (Snowflake/BigQuery) ile finans BI katmanı.
UYGULAMA RESPONSİVE OLACAK

21 - Finans : 
a) Hedefler & İlkeler
Tek doğrusal kaynak: Finansa ilişkin tüm kayıtlar azure; kullanıcıya gösterim/özet alanları Firestore’da senkron kopya olarak tutulur.
Çift ledger yaklaşımı: CG hareketleri (dijital etkileşim) ve fiat hareketleri (Marketplace) ayrı defterlerde izlenir, GL seviyesinde birleşir.
Marketplace tümden fiat: Ürün satışları ve komisyonlar canlı para ile yönetilir; CG yalnızca boost, rozet, yarışma gibi dijital özellikler içindir.
Escrow prensibi: Marketplace ödemelerinde ödeme sağlayıcısı veya iç fiat escrow kullanılır; CG tarafında yalnız dijital hizmet rezerve akışları hold edilir.
Politika varsayılanları: %5 komisyon, isteğe bağlı BÖS üyelik %2, boost harcamaları CG, payout dönemleri haftalık/aylık.
Yetkilendirme ve izlenebilirlik: Tüm finans hareketleri audit log’lu, manuel müdahaleler dört göz prensibi ile yürütülür.
b) Temel Akışlar (uçtan uca)
b.1 Sipariş & Ödeme (Marketplace Fiat)
Ürün fiyatı TL/USD/EUR olarak belirlenir → müşteri checkout’ta ödeme sağlayıcısı ile öder.
Ödeme sağlayıcısından “payment_captured” dönüşü alınca Orders + Transactions güncellenir, komisyon ve satıcı neti hesaplanır.
Sipariş durumları: draft → awaiting_payment → payment_captured → fulfilling → completed / disputed / refunded.
b.2 İade & İhtilaf
Teslimattan önce iptal: Ödeme sağlayıcısı üzerinden void/cancel, komisyon sıfırlanır, satıcı yükümlülüğü çözülür.
Teslimattan sonra iade: Dispute kaydı açılır; kanıt incelemesi sonrası ödeme sağlayıcısı reverse işlemi tetikler, komisyon ve payout kayıtları ters çevrilir.
İade faturaları ve kredi notları otomatik üretilir.
b.3 Payout
Satıcı IBAN doğrular; otomatik (haftalık/aylık) veya manuel talep modundan biri seçilir.
Uygun siparişler (dispute yok, bekleme süresi doldu) payout kuyruğuna girer; finans onayı sonrası banka transferi yapılır.
Transfer tamamlanınca Payouts.status “paid” olur, satıcıya bildirim gider.
b.4 CG Boost & Dijital Harcamalar
Satıcı veya kullanıcı CG ile sponsor/rozet/yarışma gibi dijital hizmet satın alır.
CG hold → tüketim → telemetri; fiat tarafı etkilenmez.
b.5 Vergi & Faturalama
Marketplace siparişleri için e-fatura/e-arşiv kesilir; komisyon tutarı CringeBank adına, ürün bedeli satıcı adına raporlanır.
CG bazlı dijital hizmetler için dijital hizmet faturası oluşturulur.
c) Hesaplar & Ledger (zihin haritası)
c.1 Fiat hesapları
CustomerDeposits (ödeme sağlayıcı tahsilatı)
MarketplaceCommissionRevenue
SellerPayoutLiability
PaymentProviderFees
Tax/VAT Payable (komisyon bazlı)
c.2 CG hesapları
UserWallet (available/hold CG)
DeferredRevenueCG (harcanmamış CG yükümlülüğü)
PromotionHold (boost rezerve)
CGRevenue (dijital hizmet)
c.3 İşlem tipleri (örnek)
ORDER_CREATE, PAYMENT_CAPTURE, PAYMENT_FAIL, ORDER_CANCEL, ORDER_REFUND
COMMISSION_BOOK, COMMISSION_REVERSE
PAYOUT_REQUEST, PAYOUT_APPROVE, PAYOUT_SENT, PAYOUT_FAIL
CG_CREDIT_IAP, CG_DEBIT_SPONSOR, CG_PROMO_GRANT
Her işlem çift taraflı ledger kaydı üretir; ters işlemler separate reversal olarak yazılır.
d) Politika Detayları
%5 komisyon tüm Marketplace satışlarında uygulanır; kategori bazlı istisnalar politika tablosuyla yönetilir.
BÖS üyelik %2 yalnız yüksek hacimli satıcılara uygulanır; live para üzerinden faturalandırılır.
CG boost harcamaları iade edilmez; istismar durumunda manuel reversal.
Minimum payout eşiği (örn. 2.000 TL) ve bekleme süresi (örn. 3 iş günü) konfigüre edilebilir.
Kur politikası: Faturalama sipariş anındaki kurla, payout ise politika seçimine göre (serbest bırakma veya ödeme günü) hesaplanır.
Satıcı sözleşmesi ve AML kontrolleri tamamlanmadan payout yapılamaz.
Listeleme ücreti bu revizyonda kaldırılmıştır; yeniden devreye alınırsa fiat üzerinden faturalandırılır.
Üyelik borcu ödenmezse payout kilidi devam eder; faiz uygulanmaz.
Dispute SLA: satıcı 48 saat, alıcı 72 saat içinde yanıt vermezse otomatik karar politikası devreye girer.
e) Veri Modeli (azure – kavramsal)
Users (kimlik, satıcı statüsü, BÖS bayrakları)
Orders (order_id, buyer_id, seller_id, amount_gross, commission_amount, currency, status, captured_at, completed_at)
Transactions (transaction_id, order_id, provider, provider_reference, fee, net_amount, status, settled_at)
Payouts (payout_id, seller_id, amount, currency, iban, schedule_type, status, requested_at, approved_at, paid_at)
Disputes (dispute_id, order_id, reason, status, opened_at, resolved_at)
Invoices (invoice_id, type{marketplace|digital}, party, totals, tax_breakdown, pdf_url, status)
LedgerEntries (entry_id, ledger_type{fiat|cg}, account, debit, credit, currency, reference_id, created_at)
WalletEntries (cg ledger, request_id, amount, type)
MembershipStatements (seller_id, period, gmv, percent, invoice_id, status)
AuditLogs (actor, action, entity, before/after, timestamp)
Rates (currency_pair, snapshot_at, rate)
PaymentProviderReports (report_period, provider, totals, variance)
g) İş Kuralları (özet maddeler)
Sipariş statüsü “payment_captured” olmadan satıcıya görünmez; stok düşümü onay sonrası yapılır.
Komisyon ve satıcı neti her siparişte GL’de ayrı satır olarak kaydedilir.
Payout kuyruğuna girmeden önce AML kontrolleri (limit, KYC, dispute) çalışır.
CG-to-fiat dönüşümü yasaktır; CG bakiyesi fiat cüzdana transfer edilemez.
İade durumunda komisyon otomatik terslenir; zaten ödenmiş payout varsa geri çağrı süreci başlar.
Boost CG harcaması telemetriye gerçek zamanlı düşer; harcanmayan hold 24 saat içinde iade edilir.
h) Otomasyon & Zamanlanmış İşler
paymentReconciliationJob: Ödeme sağlayıcı raporlarını Orders/Transactions ile eşler.
payoutScheduler: Otomatik payout periyotlarını hazırlar, AML kontrollerini çalıştırır.
payoutSettlementJob: Banka API’sine dosya gönderir; sonuçları işler.
membershipBillingJob: BÖS %2 faturasını üretir ve takip eder.
cgBreakageJob: Kullanılmayan CG’yi politika gereği gelir olarak tanımlar.
invoiceExporter: e-fatura/e-arşiv entegratörü ile senkron çalışır.
i) Risk, AML & Uyum
Yüksek riskli ödemeler (aynı kart, farklı kullanıcı, hız) otomatik gözden geçirme kuyruğuna düşer.
Satıcı IBAN ve vergi numarası kara liste/PEP/AML taramasından geçer.
İade oranı eşiklerini aşan satıcılar için manuel inceleme ve gerekirse komisyon/payout artışı uygulanır.
KVKK/GDPR gereği finansal veriler şifreli, erişim log’lu; retention politikaları uygulanır.
j) Raporlama & Göstergeler
Özet: Marketplace GMV, komisyon geliri, CG geliri, iade oranı, payout SLA uyumu, ödeme sağlayıcı başarısı.
Detay: Satıcı segmentine göre gelir, ödeme yöntemi kırılımı, kur etkisi, boost CG harcaması.
Alarmlar: Uzlaşma farkı, payout gecikmesi, AML risk puanı artışı, iade spike.
k) Erişim Kontrolü & Denetim
Süper Admin: Komisyon oranları, payout politikası, manuel düzeltmeler.
Finans Admin: Fatura gönderimi, payout onayı, uzlaştırma yönetimi.
Operasyon: Dispute değerlendirme, satıcı iletişimi; finansal kayıt üzerinde yazma yetkisi yok.
Audit: Tüm finansal aksiyonlar gerekçeli; silinemez, yalnız ters kayıtla düzeltilebilir.
l) Kabul Kriterleri (kritik)
Payment provider onayı olmadan sipariş tamamlanmaz.
Payout işlemleri audit log’lu ve çift onaylıdır; hata durumunda otomatik geri alma.
Komisyon gelirleri ve satıcı payları GL’de aynı anda oluşur; fark kalmaz.
CG harcaması ve fiat siparişi birbirine karışmaz; raporlarda ayrı kalemler olarak görünür.
Tüm finansal akışlar idempotent request_id ile çalışır; tekrar çağrılar güvenlidir.
BÖS olmayan satıcılar için payout seçeneği görünmez.
Üyelik %2 oluşturulup ödenmedikçe payout kilitlenir.
İade/iptal senaryolarında ters kayıt ve kredi notu üretilir.
Kur politikası (A/B) tek yerde tanımlı; tüm fatura/payout aynı stratejiyi izler.
Manuel işlemler iki kişi onayı ve audit ile sınırlıdır.
l) Yol Haritası (ilk 3 sprint)
S1: Ledger & Escrow, Orders, Invoices (snapshot kur), %5 komisyon
S2: Listing 100 CG/ay, Sponsor bütçe, BÖS başvuru & onay, Üyelik %2
S3: Payout pipeline (batch + mutabakat), rapor panelleri, iade/adjustment akışları
UYGULAMA RESPONSİVE OLACAK

22 - Etiketleme :
a) Amaç & Kapsam
Amaç: İçeriklerin bulunabilirliğini ve etkileşimini artırmak; kullanıcıların kişileri ve konuları doğru biçimde etiketleyebilmesini sağlamak; kötüye kullanımı önlemek.
Kapsam: Hashtag, @Mention, Medya üstü kişi etiketi (foto/video içinde yer işaretleme) akışları; kurallar, gizlilik/ACL, moderasyon, indeksleme, telemetri, performans hedefleri, kenar durumlar, UAT ve kabul kriterleri.
b) Tanımlar
Hashtag (#tag): Konu/tema etiketi. Arama/Keşif/Trend’lerde temel sinyal.
@Mention: Bir kullanıcıdan bahsetme. Bildirim ve ilişki sinyali üretir.
Medya Üstü Kişi Etiketi (User Tag on Media): Foto/video üzerinde belirli noktaya kullanıcı etiketlemek (baloncuk).
(Bayraklı) Ürün Etiketi: CringeStore ürününü medya üstünde işaretleme (V2; şimdilik kapalı).
Konum Etiketi: Gönderiye lokasyon ekleme (ayrı dokümanda var; burada yalnızca etkileşim etkileri anılır).
c) UI/UX – Kullanıcı Akışları
c.1 Composer (Gönderi Oluşturma/Düzenleme)
Hashtag: Caption’a # ile yazmaya başla → typeahead (TR-aware). Çok kullanılan ve son kullanılanlar önerilir.
@Mention: @ ile başla → takip ettiklerin + önerilenler; engellediğin/engelleyen görünmez.
Medya Üstü Etiket: Görsel/video önizlemede “Kişi etiketle” → dokunulan noktaya arama alanı açılır → kullanıcı seç → baloncuk oluşur. Sürükle/konumlandır, sil/yeniden adlandır (yalnız kaldır).
Sayaçlar: #tag ve @mention canlı sayacı; limit yaklaşınca uyarı.
Düzenleme: Yayından sonra 15 dk içinde caption/etiket güncellenebilir (medya etiketi de dahil); indeks & bildirimler farklılık setine göre güncellenir.
c.2 Gönderi Detay
Hashtag ve mention’lar tıklanabilir yonga (chip). Medya üzerindeki kişi baloncukları hover/tap ile görünür; liste paneli (“Bu gönderide etiketlenenler”).
“Etiketi kaldır” (sadece etiketlenmiş kişi ve gönderi sahibi yetkili).
c.3 Yorumlar/DM
Yorumda # ve @ desteklenir (link spam filtreli).
DM’de mention bildirim üretmez; yalnızca metin içi link (ürün/gönderi kartı hariç).
d) Kurallar & Limitler
d.1 Hashtag
Format: # + [a-z0-9çğıöşü_]+ (küçük harf normalize); 1–32 karakter.
Sayı: Gönderi başına ≤ 30 benzersiz hashtag.
Yasaklı/duyarlı etiketler: Banlı liste (nefret, şiddet, doxing vb.) ve hassas işaretli etiketler; trend/keşiften otomatik dışlama.
Alakasızlık/keyword stuffing: Görünürlük cezası (ranking skoru düşer), tekrarında gölgeleme.
d.2 @Mention
Format: @ + ^[a-z][a-z0-9_.]{2,19}$ (kullanıcı adı kuralına bağlı).
Sayı: Caption+yorum toplam ≤ 20 mention / gönderi.
Engel kuralları: Seni engelleyen/engellediğin kullanıcı mention olamaz; denemede nazik hata.
Gizli profil etkisi: Gizli hesabı mention’lamak serbesttir; içeriğe erişim takipçi olmayanlarda kapalı kalır (kilit akışı).
d.3 Medya Üstü Kişi Etiketi
Sayı: Gönderi başına ≤ 20, medya başına ≤ 10.
Onay (review) seçeneği: Kullanıcı ayarlarından “Beni etiketleyenler onayıma gelsin” → Etiket İstek Kutusu (accept/reject); varsayılan açık (özellikle 18- hesaplarda zorunlu).
Sahiplik: Gönderi sahibi ve etiketlenen kişi etiketi kaldırabilir.
Gizlilik: Gizli profil etiketlenirse adı görünür; profiline geçiş gizlilik kapısına takılır.
e) Gizlilik & ACL
Gizli Profil: İçerik yalnız onaylı takipçilere; hashtag sayfasında takipçi olmayanlara görünmez.
Etiket onayı: 18- kullanıcılar için varsayılan onaylı mod zorunlu; yetişkinler kapatabilir.
Dış paylaşım: Hashtag/mention linkleri web’de OG gösterir; gizli içerik kapısı ile korunur (thumbnail sızdırma yok).
Bildirim önizleme: Kapalıysa mention/etiket bildiriminde yalnız genel metin (“X seni etiketledi”).
f) Moderasyon & Anti-Abuse
Otomatik filtre: Küfür/nefret/taciz; hassas hashtag’ler ve yanlış yönlendiren etiketler.
Spam & manipülasyon: Aynı gönderide hızlı etiket değişimi, “trend sızdırma” (çok farklı kategoriler) → görünürlük baskılama + rate-limit.
Telif/İmaj hakkı: Medya üstü etikette izinsiz kişi etiketleri için rapor → moderasyon; ihlalde etiket kaldırma/suspend.
Topluluk sağlığı: Düşük kalite/raporlu etiketler Trend’ten çıkar; yinelenirse etiket geçici karantina.
g) İndeksleme & Arama
HashtagsIndex (azure): tagLower, postCount, lastUsedAt, sensitiveFlag, qualityScore.
MentionsIndex: postId, fromUid, toUid, createdAt, removedAt (raporlama & bildirim).
MediaTagsIndex: postId, mediaId, toUid, autoApproved, removedAt.
SLA: Yayın/editleme sonrası ≤ 5 sn içinde arama/keşif sinyalleri güncellenir.
TR-aware normalize: ç/ç→c, ğ→g, ı/İ→i, ö→o, ü→u, ş→s; kullanıcıya “Bunu mu demek istedin?” önerisi.
h) Bildirimler
@Mention: “{X} senden bahsetti.” (caption/yorum). Çoklu mention’lar aggrege (“X ve 3 kişi…”).
Medya etiketi: “{X} seni bir gönderide etiketledi.” → Kabul/Gör (onay modu açıksa).
Hashtag trend: İçerik önemli bir hashtag’te ivme yakalarsa yumuşak nudge (öneri bildirimleri opt-in).
i) Telemetri, Log & Alarm
Event’ler: tag_add, tag_remove, mention_add, mention_remove, media_tag_add/remove, tag_suggestion_view/click, tag_review_accept/reject, tag_report.
Metrikler: Hashtag başına engagement, trend ivmesi, alakasızlık oranı, mention başına etkileşim, etiket kaldırma/rapor oranı.
Alarmlar: Hassas/banlı tag kullanım pikleri, etiket istismarı (flood), indeks gecikmesi.
j) Performans Hedefleri
Typeahead (hashtag/mention): p95 < 150 ms (ilk 8 öneri).
Yayın/editleme → indeks: p95 ≤ 5 sn.
Medya etiketi listesi açılışı: p95 < 200 ms.
Bildirim gecikmesi: p95 < 400 ms.
k) Edge-Cases
Çok uzun hashtag (>32): Otomatik kes + uyarı.
Sadece rakam/emoji hashtag: Reddet (okunabilirlik).
Aynı etiketi defalarca ekleme: Tekilleştir.
Engellenen kullanıcının etiketi: Gönderi sahibinin isteğiyle kaldırılır; tekrarında otomatik blok.
Caption edit sonrası tag değişimi: Eski tag’lerden unindex, yenilerini index; bildirimler yalnız yeni mention/tag için gönderilir.
Gizli profil + public mention: Mention görünür ama içerik kapısı çalışır; OG sızdırma yok.
l) Feature Flags (Rollout)
FEATURE_TAG_REVIEW_QUEUE (etiket onay kutusu)
FEATURE_TAG_SPELL_SUGGEST (TR-aware öneriler)
FEATURE_SENSITIVE_TAG_GUARD (duyarlı/banlı maskesi)
FEATURE_PRODUCT_TAGS (CringeStore etiketi)
FEATURE_TAG_TREND_NUDGE (trend nudges)
Açılış: %5 → %25 → %50 → %100; anomali eşiklerinde otomatik geri alma.
m) UAT / Test Senaryoları (Örnek)
Pozitif
TAG-001: Caption’a #meme ve @umityeke ekle → yayınla → arama/mention bildirimi ≤ 5 sn.
TAG-002: Medyada iki kişiyi etiketle → listedeki baloncuklar doğru görünür; kişi kendi adını kaldırabilir.
TAG-003: Gizli profil içeriği hashtag sayfasında yalnız takipçilere görünür.
TAG-004: Typeahead TR-aware: “şaka” yazınca “saka” varyasyonu önerilir.
Negatif / Güvenlik
NEG-101: Banlı hashtag denemesi → kaydetme reddi + politika mesajı.
NEG-102: Engellediğin kullanıcıyı mention’lama → hata mesajı.
NEG-103: Etiket onay modu açık hesapta gelen etiket → reddet; gönderide görünmez, bildirim kapanır.
NEG-104: Flood: 1 dk’da 10+ hashtag değişimi → hız freni + uyarı.
Senkron/Performans
SYNC-201: Caption edit ile hashtag değişimi → indeks 5 sn içinde güncellenir.
SYNC-202: Etiket kaldırma → Mentions/MediaTagsIndex’te removedAt yazılır, yeniden bildirim üretilmez.
A11Y/UX
A11Y-301: Medya etiketi baloncukları SR tarafından “{kullanıcı adı} etiketlendi” diye okunur.
A11Y-302: Chip’ler klavye ile odaklanabilir; “etiketi kaldır” menüsü erişilebilir.
n) Kabul Kriterleri (Örnek)
 Hashtag kuralları: format, ≤ 30 adet, banlı/sensitif filtreler aktif.
 Mention kuralları: engel kontrolleri ve ≤ 20 sınırı; bildirimler düzgün agregasyonla gelir.
 Medya üstü kişi etiketi: onay modu çalışır; 18- hesaplarda zorunlu.
 Gizli profil içerikleri hashtag/keşif’te takipçi olmayanlara gösterilmez.
 Typeahead p95 <150 ms, indeks güncelleme ≤5 sn.
 Etiket kaldırma/rapor akışları, audit log ve telemetri ile izlenebilir.
 OG/preview sızıntısı yok; gizlilik kapısı tutarlı.
o) Operasyon & Bakım
Banlı/sensitif sözlükleri düzenli güncelle; yanlış pozitif raporlarını değerlendir.
Trend denetimi: Bot/farm kaynaklı ivmeyi z-score ve kalite skorlarıyla bastır.
İtiraz süreci: Etiket kaldırma/ban talebine 48s SLA.
Sözleşme uyumu: Topluluk Kuralları ve Yayın Sözleşmesi metinleriyle senkron mesajlar.
UYGULAMA RESPONSİVE OLACAK

23 - Konum : 
a) Amaç & Kapsam
Amaç: Kullanıcıların gönderilerine konum etiketi ekleyebilmesi ve “Yakınımda”/“Mekana göre keşfet” deneyimi sunmak; bunu yaparken mahremiyeti korumak, suistimali engellemek.
Kapsam: İzin akışları, konum seçimi, hassasiyet/yuvarlama, yer (place) veritabanı, Arama/Keşif entegrasyonu, ACL/gizlilik, anti-abuse, telemetri ve UAT.
b) Kullanım Senaryoları
Gönderiye Konum Ekle (Composer)
“Konum ekle” → Konum izni sorulur (tek sefer/uygulamayı kullanırken/izin yok).
İzin varsa: Yakındaki yerler listelenir; yoksa yer ara (şehir/mahalle/POI).
Seçilen place gönderiye bağlanır (yalnız placeId + coarse geohash, ham lat/lng değil).
Gösterim: yer adı + şehir; harita pini yok (gizlilik için).
Keşif/Arama – Yakınımda
Filtre: 5–50 km yarıçap; sonuçlar yakınlığa ve kalite sinyallerine göre sıralanır.
Trend Mekanlar: yüksek etkileşimli yerler; hassas yerlerde kapalı.
Yer Sayfası (Place Page)
Başlık: yer adı + şehir; son gönderiler; temel istatistikler.
Özel adres yok, harita pimi yaklaşık alanı temsil eder (coarse).
Profil Konumu (metin)
Profil düzenlemede “İstanbul, TR” gibi metin alanı; gerçek koordinat asla gösterilmez.
DM’de konum paylaşımı
V1 kapalı (güvenlik). Bayrakla açılabilir.
c) Gizlilik & Güvenlik İlkeleri
Varsayılan kapalı: Konum ekleme opt-in.
EXIF strip: Foto/video EXIF konum verisi daima silinir.
Coarse precision: Gönderide en az geohash-7 (~150m) yuvarlama + rastgele jitter (±50–100m).
Ham koordinat yok: Kullanıcı konumunun ham lat/lng’si sunucuda loglanmaz; sadece placeId + coarse geohash saklanır.
Hassas alan maskesi: Ev adresleri, eğitim kurumları, sığınaklar, sağlık/ibadet gibi hassas POI’lar → yalnız ilçe/mahalle düzeyi gösterim veya tamamıyla engel.
18- yaş: Konum ekleme varsayılan kapalı; yalnız şehir düzeyi etiketleme izinli (POI/mahalle yok).
Gizli profil: Konumlu gönderiler de yalnız takipçilere görünür; keşif/hashtag’te takipçi olmayanlara gösterilmez.
Kaldırma kolaylığı: Gönderiden konumu tek dokunuşla kaldır; geçmiş gönderiler için toplu kaldırma.
d) İzin Akışları (OS & Uygulama)
Zamanlama: Kullanıcı “Konum ekle”ye bastığında istenir; uygulama açılışında asla zorlanmaz.
Durumlar: “İzin verildi / Sadece uygulamayı kullanırken / Reddedildi / Bir daha sorma”.
Reddedildi ise: Yakınımda listesi yok; yalnız “yer ara” (metin arama).
İnce ayar: “Konumu yalnız bu gönderi için kullan” seçeneği (one-shot).
e) Yer (Place) Veritabanı & Arama
/places kataloğu: placeId, name, type, city, admin, centroid{lat,lng}, viewport, sensitiveFlag, qualityScore, synonyms[].
Kaynak: Üç yol: (a) 3P sağlayıcıdan seed, (b) user-generated öneri (moderasyonlu), (c) internal seed.
Eşleştirme: Yakınlık + ad benzerliği (TR-aware normalizasyon; ç/ş/ğ/ı/ö/ü).
Çoğalt/çakışma: Aynı yerin çoklu kaydı otomatik birleştirme kuyruğuna düşer.
Sıralama (yakındakiler): Mesafe (log-scaled) × kalite × son aktivite.
f) Sıralama & Keşif Kuralları
Yakınımdaki Gönderiler: Mesafe + içerik kalitesi (engagement) + tazelik + güven (şikayet eksi puanı).
Trend Mekanlar: Gönderi hacmi + benzersizlik + şikayet oranı eşiği altında.
Diversity: Aynı kullanıcıdan ardışık 2’den fazla kart düşürülmez.
g) Anti-Abuse & Risk Kontrolleri
Stalking/iz sürme:
Konum ekleme gerçek zamanlı olmalı zorunlu değil; kullanıcı yayın geciktirme (ör. 1–2 saat) seçebilir.
Aynı kullanıcı kısa sürede aşırı küçük yarıçapta çok gönderi → görünürlük baskılama + uyarı.
Spoofing: Uçuk mesafe sapması (son bilinen ~ cihaz lokali) → “Şüpheli konum” uyarı; yine de izin verilirse etiket, fakat keşifte aşağı skorlama.
Hassas POI listesi: Dinamik güncelleme; tespit edilirse şehir/ilçeye yuvarlanır.
Rate-limit: Konum etiketi değişimi 5/sa; “Yakınımda” sorguları 10/60sn.
h) ACL & Görünürlük
Gönderi audience: public|followers ile aynı kural: konumlu gönderi de bu kapsamda görülür.
Dışa paylaşım: Konumlu gönderinin derin linki OG/önizleme verir; gizli içerikte kilit perdesi, konum adı sızdırılmaz.
Etiket/Keşif: Gizli profillerin konumlu içerikleri takipçi olmayanlara gösterilmez.
i) Veri Modeli (Kavramsal)
Firestore

/places/{placeId}: name, type, city, admin, centroid, viewport, sensitiveFlag, synonyms[], qualityScore, updatedAt

/posts/{postId}: placeId?, geohashCoarse (7–8), audience, …

/settings/{uid}: locationConsent(one_shot|session|off), under18Restrictions(true/false)
azure
Places(placeId, name, type, city, admin, centroid, sensitiveFlag, synonymsJson, qualityScore)
PostPlaceIndex(postId, placeId, geohash7, createdAt)
PlaceSignals(placeId, postsCount, lastActiveAt, complaintRate)
j) Performans Hedefleri
Yakınımdaki yerler öneri p95 < 150 ms (ilk 10 öneri).
Yakınımdaki gönderiler sorgusu p95 < 400 ms (20 sonuç).
Place sayfası ilk boyama p95 < 250 ms.
İndeks güncellemesi (yayın/editleme→arama): ≤ 5 sn.
k) Telemetri, Log & Alarm
Event’ler: location_permission_prompt, location_permission_result, place_search, place_pick, place_unset, nearby_feed_open, nearby_result_click, suspicious_location_flag, sensitive_place_mask_hit.
Metrikler: İzin kabul oranı, place pick oranı, nearby CTR, hassas maske tetik oranı, şikayet oranı.
Alarmlar: Hassas yer maskeleme başarısızlıkları, spoofing anomalileri, indeks gecikmesi.
l) UI/UX Kuralları
Mikro kopya: “Konumu paylaşmak isteğe bağlıdır. Paylaştığında yer adın görünür, tam adresin görünmez.”
Place chip: Gönderi kartında yer adı + şehir. Tıklayınca Place sayfası.
Konum kaldırma: Gönderi menüsünde tek adım; “Konum kaldırıldı” tostu.
Harita: V1’de gösterme (gizlilik); yalnız place adı/şehir. (Harita V2 bayraklı)
m) Edge-Cases
İzin yok + Yakınımda: Boş durum → “İzin ver” CTA + “Yer ara”.
Çok yeni yer: Kullanıcı önerir → moderasyon → kataloğa düşer.
Dupe yer: Birleştirme; eski placeId → yenisine 301/alias.
Sınır bölgeleri: İki ilçe/şehir kesişiminde gösterim şehir öncelikli.
Zaman gecikmeli paylaşım: Kullanıcı “yayını geciktir” seçerse keşif skoru nötr.
Şikayet edilen yer: Yüksek şikayet oranı → geçici mask/kapama.
n) Feature Flags (Rollout)
FEATURE_LOCATION_TAG (gönderide konum)
FEATURE_NEARBY_FEED (yakınımdaki gönderiler)
FEATURE_PLACE_PAGE
FEATURE_LOCATION_SENSITIVE_MASK
FEATURE_LOCATION_DELAYED_POSTING (geciktirerek yayın)
FEATURE_LOCATION_DM_SHARE (DM’de konum kartı – kapalı)
Açılış: %5 → %25 → %50 → %100; anomali/şikayet eşiğinde otomatik geri alma.
o) UAT / Test Senaryoları (Örnek)
Pozitif
LOC-001: İzin açık → “Yakındaki yerler” 10 öneri p95 <150 ms; place seçilip gönderi yayınlanır.
LOC-002: İzin kapalı → “Yer ara” ile “Kadıköy, İstanbul” seçilir; gönderide chip görünür.
LOC-003: Keşif’te 10 km yarıçap → yakın gönderiler gelir; gizli profillerin içerikleri görünmez.
LOC-004: 18- hesap → yalnız şehir düzeyi etiket; POI seçimi engellenir.
LOC-005: Hassas POI seçimi → otomatik ilçe/şehire yuvarlanır, kullanıcı bilgilendirilir.
Negatif / Güvenlik
NEG-101: Aynı kullanıcı 5 dk’da 10 farklı noktada paylaşım → spoofing uyarısı + görünürlük düşürme.
NEG-102: Ev adresi benzeri özel POI → etiket reddi.
NEG-103: Konum kaldırma → Place sayfasında gönderi hemen kaybolur (indeks ≤5 sn).
NEG-104: Dış linkten gizli konumlu gönderi → kilit perdesi; yer adı sızmaz.
Senkron/Performans
SYNC-201: Yayın/editleme sonrası PostPlaceIndex 5 sn içinde güncellenir.
PERF-301: Yakınımda feed p95 <400 ms; boş durum ve skeletonlar doğru.
A11Y/UX
A11Y-301: Place chip SR’da “Konum: {yer adı, şehir}” okunur.
A11Y-302: İzin reddi ekranında odak & açıklayıcı metinler tam.
p) Kabul Kriterleri
Konum etiketi opt-in; EXIF her zaman strip.
Gönderide ham koordinat saklanmaz; yalnız placeId + coarse geohash.
Hassas yerler maskelenir veya engellenir; 18- için POI kapalı.
Gizli profillerin konumlu içerikleri takipçi olmayanlara gösterilmez.
Yakınımda ve place sorguları performans hedeflerine uyar.
Konum kaldırma & toplu kaldırma çalışır; indeks ≤5 sn’de güncellenir.
Telemetri/alarmlar (spoofing, maske, gecikme) eksiksiz düşer.
UYGULAMA RESPONSİVE OLACAK

24 - Yedekleme : 
a) Amaç & Kapsam
Amaç: Veri kaybı ve kesinti risklerine karşı ölçülebilir RPO/RTO hedefleriyle; verilerin, medyanın, ayarların ve günlüklerin 3-2-1-1-0 ilkesine uygun korunması ve tekrarlanabilir geri yükleme.
Kapsam: Veri envanteri, yedekleme topolojisi, şifreleme/anahtar yönetimi, KVKK uyumu, otomasyon & izleme, DR tatbikatı, UAT ve kabul kriterleri.
b) Sistem Envanteri & Kritiklik
Katman	Bileşen	Önemi	Önerilen Hedef
Tier-0	MSSazureQL (defter/indeks/rapor)	Çok yüksek	RPO ≤ 5 dk, RTO ≤ 30 dk
Tier-1	Firestore (app state, profiller, postlar)	Yüksek	RPO ≤ 15 dk, RTO ≤ 60–90 dk
Tier-1	Firebase Auth (kullanıcılar)	Yüksek	Haftalık dışa aktarım + olay bazlı delta
Tier-2	Firebase Storage (medya)	Orta	RPO ≤ 24s, artımlı & sürümleme, lazy-restore
Tier-3	Log/Analytics (BQ/obj. depolama)	Orta	RPO 24–48s, arşiv
Not: “RPO/RTO” hedefleri ürün risk iştahına göre parametrelenebilir; ilk değerler pratik–maliyet dengesi içindir.
c) Strateji: 3-2-1-1-0
3 kopya: Prod + bölge dışı replika + salt-ekleme (immutable) yedek.
2 ortam/medya: Nesne depolama (hot) + soğuk arşiv (coldline/deep archive).
1 offsite: Ayrı hesap/kuruluşta, farklı bölgede.
1 immutable: WORM (Object/Bucket Lock).
0 hata: Otomatik geri yükleme testleri ile doğrulanmış kurtarma.
d) Teknik Uygulama (Katman Bazında)
d.1 Firestore
Süreklilik: (Varsa) PITR etkin (bölge desteğine bağlı; 7–35g pencere).
Programlı dışa aktarım: Günlük tam export + saatlik artımlı koleksiyon-grubu export (Cloud Scheduler/Run).
Saklama: 30g günlük, 8 hafta haftalık, 12 ay aylık (soğuk arşiv).
Bütünlük: Export’larda checksum; export_manifest saklanır.
İzin: Backup bucket’ı ayrı prod-dışı hesapta, yalnız yazma (append-only) rolü ile.
d.2 azure
Yüksek erişilebilirlik: Always On AG (bölge-içi), DR için ikincil bölge.
Yedekler: Günlük FULL (gece), DIFF 6 saatte bir, LOG 5 dk.
Kopyalama: Log shipping + offsite obj. depolama (şifreli).
Tutarlılık: Haftalık DBCC CHECKDB, otomatik uyarı; yedekler için RESTORE VERIFYONLY.
Şifreleme: TDE + KMS-entegre anahtarlar; yedek dosyaları AES-256.
d.3 Firebase Storage (Medya)
Sürümleme: Bucket versioning + Object/Bucket Lock (immutable pencere).
Lifecycle: Sık erişilen → 30 gün sonra nearline → 90 gün sonra cold.
Ne yedeklenir? Orijinaller + manifest (türetilen thumb/kapaklar yeniden üretilebilir).
Envanter: Günlük nesne envanteri + checksum raporu.
d.4 Firebase Auth
Dışa aktarım: Haftalık kullanıcı export (hash’lerle), şifre politikaları, MFA durumları.
Delta: Günlük değişim listeleri (create/disable/delete).
Saklama: 90 gün sıcak, 12 ay arşiv.
d.5 Kod, Yapılandırma, Sırlar
IaC & Kod: Git mirror (ayrı sağlayıcı), release artifact’lar (OCI/ZIP) soğuk arşiv.
Feature Flags / App Config: Günlük snapshot.
Secret Manager & KMS: Anahtar döngüsü 90 günde bir; KEK çok bölge replikalı. Anahtar dışa aktarması yok → yüksek erişilebilir KMS şart.
Envelope şifreleme: Kullanıcı verisi için kullanıcı-başına DEK (crypto-shred; bkz. §7).
d.6 Kuyruk/Outbox & Günlükler
Event bus/outbox: En az 7–14g saklama; DLQ arşivi.
Loglar: Uygulama & güvenlik logları günlük rollover + 30g sıcak, 12 ay arşiv.
e) Geri Yükleme Senaryoları (Runbook Özeti)
S1 — Yanlışlıkla Silme (Firestore tekil/kısmi)
Zaman penceresi belirle → PITR noktası seç.
İzole projeye nokta-zaman restore → fark setini çıkar.
Seçmeli geri yazım (merge) + tutarlılık kontrolleri (referanslar, sayaçlar).
Audit: Kim/Ne zaman/Neden.
S2 — Toplu Silme/Bozulma (Firestore/azure)
En yakın export/LOG zinciri ile geri dön.
Uygulamayı read-only moda al → tek seferlik reconcile job.
Counters/indeks yeniden hesapla; outbox re-drain (idempotent).
S3 — Bölge Kesintisi
Trafiği DR bölgeye (read/write) çevir.
azure AG failover; Firestore çok bölgeli ise doğrudan, tek bölgeliyse export restore.
Storage erişimi çok bölgeli bucket’tan.
Durum: RTO hedefleri; sonrasında kademeli geri dönüş.
S4 — Ransomware / Kötü Niyetli Silme
Prod erişimlerini acilen kes, token’ları revoke et.
Immutable kopyalardan geri yükleme (WORM).
İnceleme → zorunlu anahtar rotasyonu, itibar raporu.
f) İzleme, Alarm, Raporlama
Yedek işleri: Başarısızlık, gecikme, boyut anomalisi.
RPO göstergesi: Son başarılı log yedeği yaşı (azure), son Firestore export anı.
WORM sağlığı: Versioning/Lock devre dışı ise kritik alarm.
CHECKDB & VERIFYONLY sonuçları; DR kopya gecikmesi.
Aylık rapor: Yedek hacmi, restore testleri, RPO/RTO uyumu.
g) KVKK / GDPR & Crypto-Shred Yaklaşımı
Zor kısım: Yedeklerdeki veriler fiziksel olarak silinemezse silme talepleri nasıl karşılanır?
Çözüm: Kullanıcı-başına DEK ile şifreleme. Silme talebinde DEK yok edilir → yedekler kullanılamaz hâle gelir (kripto-silme).
Saklama Süreleri: Operasyonel yedek 30–90g; arşiv 12–24 ay (hukuki yükümlülükler hariç).
Erişim: Finans/yasal saklama dışı PII tutulmaz; erişim RBAC + MFA.
h) Operasyonel Kontroller
Ayrı hesap/kuruluş: Backup hesapları prod’dan ayrı; yalnız yazma yetkisi.
İnsan hatası koruması: Silme öncesi “2 kişi onayı” (four-eyes).
Anahtar döngüsü: 90g; olağan dışı durumda acele rotasyon.
Değişiklik kaydı: Tüm backup/restore işlemleri audit-trail’li.
Runbook: Adım adım talimat + ekran görüntüsü + komut şablonları.
i) Performans Hedefleri
azure: Full yedek < 60 dk; LOG yedek < 60 sn; RPO ≤ 5 dk.
Firestore export: p95 < 20 dk (büyük kolleksiyonlar ayrı paralel export).
Storage envanteri: p95 < 15 dk; seçili geri yükleme < 5 dk (tek nesne).
DR failover: p95 < 30 dk (Tier-0 sistemler kullanılabilir).
j) UAT / Tatbikat Senaryoları
Pozitif
BKP-001: Firestore tekil doküman PITR’den geri getir → referans/tutarlılık kontrolü geçer.
BKP-002: azure FULL + LOG zincirinden 30 dk önceye dönüş → uygulama read-only moddan read-write’a alınır.
BKP-003: Storage’den yanlışlıkla silinen media, versioning ile kurtarılır.
BKP-004: Auth export’tan dev ortama seçmeli import.
Negatif / Dayanıklılık
NEG-101: Backup bucket’ta silme denemesi → WORM engeller, alarm.
NEG-102: CHECKDB hatası → son sağlam yedekten otomatik kurtarma senaryosu.
NEG-103: DR failover sırasında yazma çakışması → idempotent reconciler ile temizlenir.
NEG-104: Crypto-shred sonrası ilgili kullanıcının verileri yedeklerde kurtarılamaz (beklenen).
Senkron/Performans
SYNC-201: Export bitişi → katalog/gösterge paneli güncellenir (< 2 dk).
PERF-301: Geri yükleme testinde RTO hedefi sağlanır.
k) Kabul Kriterleri (Checklist)
3-2-1-1-0 prensibi tüm katmanlarda uygulanır (immutable offsite dahil).
RPO/RTO metrikleri panoda canlı izlenir; eşik aşımlarında alarm.
Firestore için PITR veya eşdeğeri + programlı export aktiftir.
azure: FULL/DIFF/LOG yedek planı, CHECKDB, VERIFYONLY ve offsite kopya aktif.
Storage versioning + lock açık; lifecycle kuralları yürürlükte.
Auth haftalık export ve günlük delta arşivi mevcut.
Crypto-shred ile silme talepleri yedeklerde de uygulanabilir.
Aylık restore tatbikatı raporu ve sapma analizi tutulur.
l) Yol Haritası (V2+)
Tam otomatik DR “bast-buton” koşusu (infrakit + runbook orkestrasyonu).
Uçtan uca veri kataloğu (hangi veri nerede/ne kadar süre).
Zaman-seyahatli analitik snapshot’ları (BI’ye hızlı geri dönüş).
Çok bulutlu offsite (ör. birincil GCP, offsite AWS/Azure) – sadece arşiv.
m) Günlük Operasyon Check-list (Özet)
Dünkü export/backup işleri OK mi? Boyut/anomali?
RPO göstergeleri (azure log yaşı, Firestore export yaşı) eşik altında mı?
WORM/Versioning kapalı değil mi?
Gece CHECKDB ve alerts temiz mi?
Açık restore bulguları (tatbikat sapmaları) kapatıldı mı?
UYGULAMA RESPONSİVE OLACAK

25 - CringeDrawer : 
CringeDrawer Kullanım ve İşleyiş Sözleşmesi
a. Tanımlar
CringeBank: MoonPik Yazılım tarafından geliştirilen hibrit yapıda bir sosyal-finans uygulamasıdır.
CringeDrawer: Kullanıcıların kazandıkları tüm dijital ödülleri, hediye kodlarını, rozetleri ve CringeGold (CG) bakiyelerini görüntüleyebilecekleri, uygulama içi sanal sandık sistemidir.
Kullanıcı: CringeBank platformuna kayıtlı, kimliği doğrulanmış birey.
Yarışma / Kampanya: CringeBank veya iş birliği yapılan markalar tarafından düzenlenen, ödül veya hediye kazandıran etkinliklerdir.
Ödül: Kullanıcının CringeBank üzerindeki faaliyetleri sonucunda kazandığı hediye kodu, CringeGold (CG) veya rozet gibi dijital değerlerdir.
b. Amaç
CringeDrawer sistemi, CringeBank ekosisteminde kullanıcının kazandığı tüm ödülleri güvenli, kalıcı ve organize bir biçimde saklamak; kullanıcıya bu öğeleri görüntüleme, kullanma veya paylaşma imkânı sağlamak amacıyla oluşturulmuştur.
c. Genel İlkeler
Mülkiyet: CringeDrawer’da yer alan tüm dijital içerikler (ödül, rozet, CG vb.) CringeBank altyapısında tutulur; sistem, kullanıcıya bu değerlerin görüntülenmesi ve kullanımı için erişim sağlar.
Gizlilik: Kullanıcıya özel her sandık yalnızca ilgili kullanıcı tarafından görüntülenebilir. Üçüncü şahısların erişimi engellenmiştir.
Senkronizasyon: CringeDrawer, CringeYarışma modülüyle tam entegre çalışır. Kazanılan her ödül, yarışmanın bitimini takiben otomatik olarak kullanıcı sandığına aktarılır.
Güncellik: CringeDrawer verileri gerçek zamanlı olarak senkronize edilir. Kazanım, kullanım veya süresi dolan ödüller anında güncellenir.
d. İşleyiş Esasları
d.1 Ödül Kazanımı
Kullanıcı, CringeBank içerisindeki CringeYarışma veya diğer resmi etkinliklere katılarak ödül kazanabilir.
Kazanılan ödüller sistem tarafından otomatik olarak doğrulanır ve CringeDrawer’a aktarılır.
Her ödül, oluşturulma tarihiyle birlikte “Yeni” statüsünde sandığa eklenir.
d.2 Ödül Türleri
Hediye Çeki / Voucher: Yemeksepeti, Trendyol, Getir, LC Waikiki gibi iş ortakları tarafından sağlanan marka bazlı kupon veya kodlardır.
CringeGold (CG): CringeBank platformunda kullanılabilen dijital para birimidir.
Rozetler: Kullanıcının başarılarını veya statüsünü temsil eden sembolik dijital nişanlardır.
Eşyalar / Envanter: Gelecekteki oyun, tema veya görsel bileşenlerde kullanılabilecek özel dijital öğelerdir.
d.3 Ödül Görüntüleme ve Kullanım
Kullanıcı, uygulama içindeki “CringeDrawer” simgesine dokunarak mevcut ödüllerini görüntüleyebilir.
Her ödül yalnızca sahibi olan kullanıcı tarafından kullanılabilir veya görüntülenebilir.
Hediye kodları varsayılan olarak gizlenir; “Kodu Göster” işlemi yalnızca bir defa yapılabilir ve bu işlem sistem loglarında kayıt altına alınır.
Kullanıcı, süresi dolan veya kullanılan ödüller üzerinde tasarrufta bulunamaz.
d.4 Geçerlilik Süresi
Her ödülün geçerlilik süresi “CringeDrawer” içinde belirtilir.
Süresi dolan ödüller otomatik olarak “Süresi Doldu” statüsüne geçirilir ve kullanılamaz.
CringeBank, süre dolumu sonrası kaybolan ödüller için sorumluluk kabul etmez.
d.5 Güvenlik ve Denetim
CringeDrawer verileri Firestore ve azure üzerinde yedekli olarak tutulur.
Kullanıcı her işlem yaptığında sistemde tarih, IP adresi, cihaz bilgisi ve işlem türü kayıt altına alınır.
Şüpheli veya çoklu cihaz erişimleri otomatik olarak tespit edilip geçici kısıtlamaya tabi tutulabilir.
Tüm işlemler, KVKK ve GDPR kapsamında güvenli veri işleme standartlarına uygun şekilde yürütülür.
e. Kullanım Kısıtlamaları
Kullanıcı, CringeDrawer üzerinden kazandığı kodları ticari amaçla satamaz veya devredemez.
Hediye çekleri yalnızca ilgili markaların belirttiği şartlar dâhilinde kullanılabilir.
CringeBank, iş birliği yapılan markaların sağladığı ödüllerin geçerlilik süresi, stok veya erişilebilirliğinden sorumlu değildir.
Sistem manpülasyonu, sahte hesap kullanımı veya hileli işlem tespit edilmesi hâlinde CringeBank, ilgili kullanıcıyı kalıcı olarak engelleme hakkını saklı tutar.
f. Bildirimler ve Bilgilendirmeler
Kullanıcıya yeni bir ödül eklendiğinde uygulama içi ve/veya e-posta bildirimi gönderilir.
Süresi dolmak üzere olan kuponlar için otomatik hatırlatma mesajları sağlanabilir.
Tüm bildirimler, kullanıcı onayına bağlı olarak açılıp kapatılabilir.
g. Sorumluluk Reddi
CringeDrawer’da görüntülenen içerikler, CringeBank’ın kontrolü dışında olan markalara ait olabilir.
Hediye çeklerinin kullanım koşulları markaların kendi sorumluluğundadır.
Teknik arıza, bakım veya güvenlik güncellemesi nedeniyle geçici erişim kesintileri yaşanabilir.
CringeBank, kullanıcı kaynaklı veri kayıplarından veya yanlış kullanım durumlarından sorumlu tutulamaz.
h. Veri Saklama Politikası
CringeDrawer verileri 3 yıl süreyle saklanır.
Kullanıcının hesabını silmesi durumunda, yasal yükümlülükler haricinde tüm Drawer verileri kalıcı olarak silinir.
Veri paylaşımı, yalnızca yasal mercilerden gelen resmî talepler doğrultusunda yapılabilir.
i. Fikri Mülkiyet
CringeDrawer adı, logosu, görsel tasarımı ve içeriği MoonPik Yazılım’a aittir.
Bu sistemin izinsiz kopyalanması, dağıtılması veya ticari amaçla kullanılması yasaktır.
j. Değişiklik Hakkı
MoonPik Yazılım, CringeDrawer sistemine ilişkin bu sözleşme koşullarında önceden bildirim yapmaksızın değişiklik yapma hakkını saklı tutar. Güncel sürüm, uygulama üzerinden erişilebilir şekilde yayımlanır.
k. Yürürlük
Bu sözleşme, kullanıcının CringeDrawer modülünü ilk kez açtığı veya bir ödül kazandığı andan itibaren yürürlüğe girer.

25 - Anlık Bildirimler : 
0) Hedef
Finans/iş olayları (Escrow/Order/Wallet) → azure “source of truth”
Cihaz tokenları, tercih toggle’ları, gerçek-zamanlı UI → Firestore
Teslimat → FCM
Dayanıklılık → SQL Outbox + idempotency (dedupeKey)
Uyumluluk → KVKK/ETK’ye göre transactional vs marketing ayrımı + sessiz saatler
1) Veri Modeli
1.1 Firestore
users/{uid}
push.allowedTransactional: bool (default true)
push.allowedMarketing: bool (default false)
push.quietHours: {start: "22:00", end: "08:00", tz: "Europe/Istanbul"}
push.topics: string[] (örn. ["escrow","wallet","competitions"])
locale: "tr-TR"
devices/{uid}/{token}
token: string (FCM)
platform: "android"|"ios"|"web"|"windows"
appVersion: string
isValid: bool
lastSeenAt: timestamp
notification_logs/{autoId} (özet log; opsiyonel)
uid, type, topic, dedupeKey, sentAt, success, error
Security rules özet:
Kullanıcı yalnızca kendi devices/{uid} altına yazabilir/güncelleyebilir.
users/{uid}.push.* alanlarını yalnızca kendisi değiştirebilir; adminler okuyabilir.
1.2 azure
NotificationPreferences(Uid, AllowedTransactional, AllowedMarketing, QuietStart, QuietEnd, Timezone, UpdatedAt)
NotificationOutbox(Id, Uid, Channel, Topic, Title, Body, DataJson, Priority, DedupeKey, NotBefore, CreatedAt, SentAt, Status, RetryCount)
Status: pending | sent | skipped | failed | deferred
NotificationFailures(Id, OutboxId, Error, CreatedAt)
İş tabloları: Escrows, Orders, Wallets (zaten mevcut)
Dedupe stratejisi:
Aynı olay için DedupeKey (örn. escrow:{EscrowId}:{NewStatus}) belirle; 10 dk içinde aynı anahtar gelirse gönderme.
2) İstemci (Flutter) İşleyişi
2.1 İlk Kurulum & İzin

Kullanıcıya kısa açıklama → iOS’ta sistem prompt’u → Android 13+ için runtime izin.
FirebaseMessaging.instance.getToken() ile token al.

devices/{uid}/{token} belgesini create/update et:

platform, appVersion, isValid=true, lastSeenAt=now.

Future<void> initPush(String uid) async {
  final perm = await FirebaseMessaging.instance.requestPermission(
    alert: true, badge: true, sound: true,
  );
  if (perm.authorizationStatus == AuthorizationStatus.denied) return;

  final token = await FirebaseMessaging.instance.getToken();
  if (token != null) await saveDeviceToken(uid, token);

  FirebaseMessaging.onTokenRefresh.listen((t) => saveDeviceToken(uid, t));
}
2.2 Giriş/Çıkış
Girişte: token’ı kullanıcı altına yaz, topic’lere subscribe et (competitions vb).
Çıkışta: ilgili devices/{uid}/{token}.isValid=false, topic’lerden unsubscribe.
2.3 Ayarlar Ekranı
Toggle’lar:
“İşlem Bildirimleri” (bilgi amaçlı, kapatılabilir ya da kilitli tasarım—senin politikana göre)
“Kampanya & Promosyonlar”
“Kategori bazlı” (örn. competitions, wallet)
Sessiz saat seçicisi + TZ
Değişiklikte hem Firestore hem SQL NotificationPreferences güncelle (arkaplanda Functions/Backend ile senkron).
2.4 Ön Planda Davranış
Uygulama açıkken FCM data + notification geldiğinde in-app banner/snackbar; tıklamada ilgili route’a git.
3) Olay Üretimi (Domain Events → Outbox)
3.1 Tetikleyiciler
Escrow: PENDING→HELD, HELD→RELEASED, DISPUTED
Orders: PLACED, SHIPPED, DELIVERED, CANCELLED
Wallets: CG_DEBIT, CG_CREDIT, REFUND
Security: OTP, yeni cihaz, şüpheli giriş
Competitions: sonuç, ödül yatırma
3.2 Outbox Yazımı (idempotent)
İşlem tamamlandığında tek noktadan (tercihen Stored Proc veya domain service) Outbox’a “tek satır” ekle:
Channel = transactional | marketing
Topic = escrow | orders | wallet | competitions | security
Title/Body = i18n anahtarları veya plain metin
DataJson = {"route":"/escrow/123","status":"HELD"}
Priority = high | normal
DedupeKey = escrow:123:HELD
NotBefore = NULL (veya marketing ise planlı saat)
Not: Outbox yazımı iş transaction’ının sonunda yapılmalı ki iş başarısızsa bildirim üretilmesin.
4) Teslimat İşleyicisi (Worker/Cloud Function)
4.1 Çekme Kriteri
Status='pending'
(NotBefore IS NULL OR NotBefore <= NOW())
FIFO için CreatedAt sıralaması (veya Id artan)
4.2 Kişisel Tercihler & Sessiz Saat
SQL NotificationPreferences + Firestore users/{uid} çek.
Marketing bildirim → AllowedMarketing==true VE push.allowedMarketing==true olmalı; değilse skipped.
Sessiz saat aralığındaysa:
Transactional: silent / low priority ile gönder (security/OTP high kalır).
Marketing: defer → Status='deferred', NotBefore=quietEnd(next).
4.3 Hedef Belirleme
devices/{uid} altında isValid==true token’ları topla.
Topic mesajları için doğrudan sendToTopic(topic) (opt-in kullanıcılar).
Kullanıcıya özel → sendMulticast(tokens).
4.4 Gönderim + Retry & Temizlik
FCM’e gönder (priority Android/iOS başlıkları ayarlı).
Yanıtlarda:
NotRegistered/InvalidRegistration → ilgili token isValid=false.
5xx/UNAVAILABLE → exponential backoff (örn. 2s→10s→60s→5m; max 5 deneme; RetryCount++).
Başarılı → Status='sent', SentAt=now.
Başarısız (kalıcı) → Status='failed' + NotificationFailures kaydı.
4.5 Dedupe & Oran Sınırlama
Aynı DedupeKey için son 10 dk içinde gönderilmişse atla (skipped: duplicate).
Kullanıcı başına rate-limit: örn. 10 bildirim/15dk (marketing ≤ 3/15dk).
5) Mesaj Şablonları & Lokalizasyon
Mesajlar i18n: title_tr, title_en …
Kullanıcı locale alanına göre seçim; düşmezse tr-TR.
Payload sade: PII yok; route/id/type ver:
data: { "route": "/orders/ABC123", "type": "order_status", "status": "SHIPPED" }
Priority kuralları:
security/OTP → high
`escrow/order kritik** → high
wallet info / marketing → normal (marketing mümkünse silent)
6) Konu (Topic) Yönetimi
Kullanıcı ayarlar ekranından competitions, promotions gibi topic’lere opt-in/opt-out yapar.
Flutter: FirebaseMessaging.instance.subscribeToTopic('competitions')
Toplu kampanya dağıtımı → topic üzerinden yapılır.
7) İzleme & Gözlemlenebilirlik
Metrikler: success rate, failure rate, p95 gönderim süresi, deferred sayısı, duplicate skip sayısı.
Alarm: arka arkaya 5xx artışı, invalid token artışı, Outbox pending kuyruğu büyümesi.
Dashboard: gün/saat/kategori kırılımı.
Denetim: NotificationOutbox + NotificationFailures + (opsiyonel) Firestore notification_logs.
8) Güvenlik & Uyumluluk
KVKK/ETK: transactional vs marketing ayrımı zorunlu; marketing için açık rıza (iki yerde tutuluyor: SQL + Firestore).
Yurt dışı aktarım: FCM/APNs → KVKK m.9 temellerinden biri (açık rıza / sözleşmesel hükümler).
App Check / Auth: cihaz kaydı yazarken Auth şartı; devices/{uid} sadece sahip kullanıcı tarafından yazılabilir.
PII minimal: payload’da kimlik bilgisi yok; sadece yönlendirme id’leri.
9) Operasyon & Rollout
Önkoşullar
VS workload’lar (Windows build için), Firebase CLI güncel, Functions/Worker ortam değişkenleri.
SQL tabloları + index’ler kurulu (status, notBefore, createdAt).
Kademeli Yayın
QA’da token yenileme/invalid temizliği/sessiz saat/locale testleri.
Canlıda %5 kullanıcıyla başla → metrik/alarma bak → %25 → %100.
Topic’ler için küçük batch A/B dene (marketing).
11) Minimum “Yarın Üretime” Kontrol Listesi
 Firestore security rules yazıldı (self-write only).
 Token lifecycle (getToken/onTokenRefresh) çalışıyor.
 SQL tabloları + index’ler kuruldu.
 Worker cron aralığı (örn. 30 sn) ve concurrency limit belirlendi.
 DedupeKey politikası ve pencere (10 dk) ayarlandı.
 Sessiz saat kuralı test edildi (transactional/marketing ayrık).
 Rate-limit devrede (user başı 10/15dk; marketing ≤3/15dk).
 i18n şablonları hazır; locale fallback tr-TR.
 İzleme panosu + alarm eşikleri aktif.
Sonuç
Bu işleyişle:
Parasal/iş kritik akışlar SQL’de güven ve izlenebilirlikle yürür,
Kullanıcı deneyimi Firestore ile yağ gibi akar,
Teslimat FCM + Outbox ile kayıpsız, tekrar etmeyen, sessiz saat uyumlu çalışır.
UYGULAMA RESPONSİVE OLACAK

Aşağıda CringeBank – Yayın Sözleşmesi (v1.1)’in tam ve temiz sürümünü, “hassas içerik kesinlikle yasaktır” ilkesini ve senin belirlediğin sistem akışını tamamen entegre ederek sıfırdan yazdım.
Bu metin hem uygulama içinde “Yayınla” öncesi onay ekranına, hem de “Yardım & Politikalar” sekmesine doğrudan gömülebilir.
Hazırsan işte final versiyonu 👇

🧾 CRINGEBANK – YAYIN SÖZLEŞMESİ

Sürüm: v1.1
Yürürlük Tarihi: 13.10.2025
Ürün Sahibi: CringeBank, Moonpik Yazılım’ın bir ürün/markasıdır ("CringeBank", "Biz").
Taraf: Uygulamayı kullanan gerçek kişi ("Kullanıcı", "Sen").

a) AMAÇ VE KAPSAM

Bu sözleşme, CringeBank üzerinde içerik paylaşımı ("Gönderi") yapan tüm kullanıcıların uyması gereken kuralları, teknik şartları, lisans ve sorumlulukları düzenler.
Ana sayfadaki “+” butonuna basıldığında açılan tek sayfalık içerik seçim ekranı (composer) ve seçilen gönderi türüne göre arayüzün mod değiştirmesi işbu sözleşmenin parçasıdır.

CringeBank; metin, fotoğraf ve kısa video paylaşımı içeren, her yaşa uygun ve tamamen güvenli bir sosyal platformdur.
Uygulama, hiçbir şekilde hassas, rahatsız edici veya yetişkin temalı içeriklere izin vermez.

b) TANIMLAR

Spill (Metin): Yazı, fikir, yorum veya paylaşım.
Clap (Kısa Dikey Video): 5–30 sn önerilen dikey kısa video.
Frame (Fotoğraf): Tek fotoğraf paylaşımı.
CringeCast (Video): 5–60 sn video paylaşımı (dikey/yatay).
Mash (Karışık): Çoklu medya paylaşımı (foto + video, en fazla 10 öğe).
CG (CringeGold): Uygulama içi dijital değer birimi (fiat para değildir).
Composer: Gönderi oluşturma/düzenleme ekranı.
Uygunsuz İçerik: Aşağıda tanımlanan yasaklı içerik türlerinin tamamıdır.

c) KABUL VE YAŞ SINIRI

“Yayınla” butonuna tıklaman, bu sözleşmeyi okuduğunu ve tüm şartlarını kabul ettiğini gösterir.
Uygulamayı kullanmak için en az 13 yaşında olmalısın.
Tüm içerikler her yaşa uygun olmalıdır; 18 yaş altı kullanıcılar da dahil olmak üzere platformda hassas içerik yasaktır.

d) ARAYÜZ & AKIŞ – “+” BUTONU TEK SAYFA SEÇİM

Ana sayfadaki “+” butonuna basınca tek sayfa üzerinde Spill, Clap, Frame, CringeCast, Mash seçenekleri görünür.
Kullanıcı seçtiğinde composer anında ilgili moda geçer:

Clap → Dikey video modunda kayıt & süre göstergesi,

Frame → Fotoğraf kırpma & filtre araçları,

Mash → Çoklu medya seçimi ve sıralama ekranı.
Tür değiştirildiğinde mevcut içerik taslak olarak korunur ve kullanıcı bilgilendirilir.

e) TEKNİK ŞARTLAR VE SINIRLAR
Genel Kurallar

Maksimum #Hashtag: 30

@Mention: Engellediğin veya seni engelleyen kullanıcıya yapılamaz.

Konum: Varsayılan kapalı; yalnızca açık rızanla yaklaşık konum (100–500 m yuvarlama) paylaşılır.

Yorumlar: Varsayılan açık, küfür ve toksisite filtresi otomatik olarak çalışır.

Yayın Limiti: Maksimum 10 gönderi/sa – 40 gönderi/gün.

Medya Formatları

Fotoğraf: JPG/PNG/HEIC (HEIC → JPG’e çevrilir). Maksimum 10 MB, uzun kenar 1080p hedef. EXIF ve meta veriler silinir.

Video: MP4/MOV (H.264/AAC). Maksimum süre 60 sn, çözünürlük ≤ 1080p, FPS ≤ 60.

Mash: Maksimum 10 medya (foto + video). Toplam video süresi ≤ 60 sn.

Yüklenen içerikler kalite, boyut ve güvenlik amacıyla teknik olarak dönüştürülür (transcode, thumbnail, LQIP).

f) İÇERİK POLİTİKASI – HASSAS İÇERİK KESİNLİKLE YASAKTIR

CringeBank, topluluk güvenliği ve marka bütünlüğü gereği hassas içerik, rahatsız edici görseller, şiddet veya cinsel öğe içeren hiçbir paylaşımı kabul etmez.

❌ Yasaklı İçerik Türleri
🔞 Cinsel / Erotik İçerik

Herhangi bir çıplaklık veya erotik ima.

Müstehcen dans, poz, jest, ses, yazı, emoji.

Cinsellik veya flört çağrıştıran görseller, sesler, metinler.

🩸 Şiddet / Kan / Yaralanma

Fiziksel şiddet, kavga, silah, yaralanma, kan, kaza, ameliyat.

Hayvanlara zarar içeren her tür medya.

🧠 Travmatik / Psikolojik İçerik

İntihar, kendine zarar, depresyon, ölüm, kayıp, korku temalı içerikler.

“Dark humor” veya rahatsız edici duygusal paylaşımlar.

💣 Nefret veya Şiddet Övgüsü

Irk, din, cinsiyet, siyasi görüş, yönelim gibi konularda ayrımcılık veya hakaret.

Terör, suç veya şiddet eylemini öven ifadeler.

🍷 Uyuşturucu / Alkol / Silah / Kumar

Her türlü alkol, sigara, uyuşturucu, silah, kumar veya yasa dışı eylem temalı içerik.

🤬 Küfür, Argo, Hakaret

Her tür küfür, argo, beddua, hakaret veya cinsel ima.

Harf gizleme yöntemleri de dahil (“s*ktir”, “f.ck”, “oç” vb.).

🕵️ Gizlilik / Mahremiyet İhlali

Başkalarının izinsiz görüntüsü, adres, telefon, plaka, özel belge veya kayıt paylaşımı.

⚠️ Sınırda / Şüpheli İçerikler

Kan göstermeyen ama şiddet ima eden sahneler.

“Şaka” olarak hakaret veya cinsellik ima eden video/metin.

Bedeni vurgulayan selfie’ler, uygunsuz ses içeren trendler.

✅ UYGUN İÇERİK ÖRNEKLERİ

Sanat, spor, teknoloji, müzik, doğa, eğitim, üretim, motivasyon temalı içerikler.

Eğitici, pozitif, mizahi veya bilgi verici gönderiler.

Girişimcilik, yardımlaşma, topluluk bilinci, başarı hikâyeleri.

Küfür, şiddet veya cinsellik içermeyen eğlenceli videolar.

g) İÇERİK SAHİPLİĞİ VE LİSANS

Gönderilerinin telif hakkı sende kalır.
Paylaşarak CringeBank’e, içeriğini barındırmak, işlemek, yayınlamak ve platform içi tanıtım amacıyla kullanmak üzere dünya genelinde, münhasır olmayan, ücretsiz bir lisans verirsin.
Telif veya ihlal bildirimi durumunda içerik geçici olarak durdurulabilir veya kaldırılabilir.

h) MODERASYON VE DENETİM

Tüm gönderiler otomatik sistemlerce ön moderasyondan geçer.

Yapay zekâ filtreleri; küfür, şiddet, çıplaklık veya toksisite içeren gönderileri engeller.

İhlal halinde içerik yayınlanmaz ve hesap uyarı alır.

Tekrarlayan ihlallerde hesap kalıcı olarak kapatılabilir.

“Şikayet et” butonuyla bildirilen içerikler inceleme kuyruğuna alınır.

i) GİZLİLİK VE GÜVENLİK

Kayıt sürecinde onayladığın KVKK/Aydınlatma Metni, yayınladığın içerikleri de kapsar.
Yüklediğin tüm görsellerin EXIF verileri ve konum bilgileri otomatik olarak silinir.
Kişisel veriler, IP ve cihaz bilgileri anonimleştirilerek işlenir.
Herhangi bir güvenlik ihlali tespit edildiğinde hesabın geçici olarak askıya alınabilir.

j) SORUMLULUK REDDİ

Paylaştığın içeriklerin tüm hukuki ve etik sorumluluğu sana aittir.
CringeBank, içeriğin doğruluğu veya devamlılığı konusunda garanti vermez; gerekli durumlarda gönderileri gizleme veya kaldırma hakkını saklı tutar.

k) SÖZLEŞME GÜNCELLEMELERİ

Bu sözleşme zaman zaman güncellenebilir.
Yeni sürüm yürürlüğe girdiğinde uygulama içinde bilgilendirme yapılır.
Güncellemelerden sonra içerik paylaşmaya devam etmen, yeni koşulları kabul ettiğin anlamına gelir.

l) YÜRÜRLÜK VE FESİH

Sözleşme, “Yayınla” butonuna basmanla yürürlüğe girer ve hesabın açık kaldığı sürece geçerlidir.
Hesabını silerek sözleşmeyi sona erdirebilirsin; ancak yasal saklama yükümlülükleri saklıdır.

m) İLETİŞİM

Destek ve ihlal bildirimleri için: Uygulama içi Yardım & Destek bölümü.
Resmî tebligatlar ve yasal yazışmalar: uygulamada belirtilen iletişim adresleri üzerinden yapılır.

n) KULLANICI ONAYI

☑️ “Yayınla” butonuna basarak CringeBank Yayın Sözleşmesi’ni, Topluluk Kurallarını ve KVKK/Aydınlatma Metnini okuduğumu ve kabul ettiğimi beyan ederim.

🔒 EK TEKNİK NOT (UYGULAMA İÇİ KONTROL)

Yayın öncesi tüm içerikler otomatik filtreleme sürecinden geçer.

Sistem, uygunsuz içerik tespit ederse “Gönderi reddedildi” uyarısı gösterir.

Her ihlal loglanır ve kullanıcı hesabına puan (-1) olarak işlenir.

3 tekrar sonrası hesap 7 gün boyunca paylaşım yapamaz.

UYGULAMA RESPONSİVE OLACAK

Anlık Sponsorlu Yarışmalar — PRD (Özet)

Katılım ücreti: 1 CG (asla iade edilmez).

Bildirim → Soru: Push gelir, kullanıcı tıklar, soru sayfası açılır.

Gönder → Onay: “1 CG kesilecek, devam?” uyarısı. Onayla kes → cevap sunucuya gider.

Kazanan kriteri: İlk doğru cevabı veren winners_count kişi.

Kazanan sayısı: Yarışma oluşturulurken belirlenir (örn. 1, 3, 10).

Süre: Oluştururken seçilir: 1s, 2s, 3s … | 1g, 2g … | 1h, 2h … (saat/gün/hafta).

Otomatik sonuç: Sistem kazananları otomatik belirler.

Ödül bildirimi: Yarışma bittikten sonra 15 dk içinde uygulama içi mesajla hediyeler gönderilir.

Durum Makinesi

DRAFT → LIVE → ENDED → SETTLED

LIVE: Cevaplar alınır, 1 CG kesilir; doğru gelirse sıralama anında rezerve edilir (rank ataması).

ENDED: Süre dolunca yeni cevap alınmaz.

SETTLED: En geç +15 dk içinde kazananlara ödüller dağıtılır ve mesajı düşer.

Veri Modeli (Azure SQL — çekirdek doğruluk)

contests

id (PK), title, sponsor_id

entry_fee_cg = 1

winners_count INT

question_type (MCQ|TEXT)

question_payload JSON (soru, seçenekler vb.)

answer_hash VARBINARY(32) (salted SHA-256)

starts_at DATETIME2, ends_at DATETIME2

status (DRAFT|LIVE|ENDED|SETTLED)

created_at DATETIME2

contest_submissions

id (PK), contest_id (FK), user_id

answer_raw NVARCHAR(...) (opsiyonel, maskeli/sınırlı)

answer_hash VARBINARY(32)

submitted_at DATETIME2 (server UTC)

charged BIT (1 CG kesildi mi), tx_id (FK wallet_tx)

is_correct BIT NULL, rank INT NULL

result (PENDING|WIN|LOSE)

Index/unique: UX(contest_id, user_id) (tek deneme istiyorsan)
(Birden çok deneme istenirse attempt_no alanı ekle ve UX’i ona göre güncelle.)

contest_winners

contest_id, user_id, rank (1..winners_count), awarded_at

PK: (contest_id, rank) (çakışmayı engeller)

users_wallet

user_id (PK), balance_cg BIGINT

wallet_tx

id (PK), user_id, amount_cg (negatif=kesinti, pozitif=ödül)

reason ('JOIN_CONTEST' | 'CONTEST_PRIZE')

contest_id NULL, idempotency_key, created_at

Not: REFUND yok. (Politika gereği iade edilmez.)

İş Kuralları (kritik)

Kesinti: Onay anında -1 CG → wallet_tx(JOIN_CONTEST); başarısız transaction olursa otomatik rollback/iade (yalnızca sistemsel hata).

Doğrulama: TEXT ise normalize+salt+hash karşılaştır; MCQ ise doğru seçenek ID’si hash’i ile karşılaştır.

Sıralama: submitted_at sırasına göre ilk winners_count doğruya atomik rank ata.

Ödül: Yarışma ENDED olduktan sonra ≤15 dk içinde wallet_tx(+prize, CONTEST_PRIZE) ve in-app mesaj.

Eşzamanlılık & İşlem Güvenliği

API, cevabı Service Bus Queue’a yazar: contest-answer-submissions.

Adjudicator Function (Queue Trigger) tekil tüketim yapar → tek SP ile atomik karar:

UPDLOCK, ROWLOCK, SERIALIZABLE izolasyon.

Boş rank var mı? Varsa ata ve WIN; yoksa LOSE.

Idempotency: Idempotency-Key: contestId:userId:attempt hem wallet_tx hem submission için.

API Tasarımı (öneri)

POST /api/contests/{id}/submit

Body: { answerRaw?: string, answerChoiceId?: string }

Header: Idempotency-Key

İş: Onaydan sonra çağrılır; 1 CG keser, submission’ı kuyruğa bırakır → 202 Accepted + submission_id.

GET /api/contests/{id}/status

Döner: { status: 'LIVE'|'ENDED'|'SETTLED', remainingWinners, endsAt }

GET /api/contests/{id}/result?submission_id=...

Döner: { result: 'PENDING'|'WIN'|'LOSE', rank?: number }

Admin

POST /api/contests (create) → winners_count, duration, question, answer_hash, starts_at

POST /api/contests/{id}/publish → status=LIVE

POST /api/contests/{id}/close → status=ENDED (opsiyonel manuel kapanış)

POST /api/contests/{id}/settle → ödül dağıtımı (zamanlayıcı normalde otomatik yapar)

Zamanlayıcılar

Auto-end: ends_at geldiğinde LIVE→ENDED.

Auto-settle: ENDEDdan sonra ≤15 dk içinde SETTLED + ödüller + mesaj.

Bildirim Metinleri (TR)

Başlangıç Push:

Başlık: ⚡ Anlık Yarışma Başladı!

Gövde: Katılım: 1 CG • İlk doğru cevap veren {winnersCount} kişi kazanır. Hemen katıl!

Onay Modal:

Başlık: Katılım Ücreti: 1 CG

Metin: Onaylarsan 1 CG kesilecek ve iade edilmeyecek. Devam edilsin mi?

Kazanma Mesajı (yarışma sonrası ≤15 dk):

🎉 Tebrikler! #${rank}. kazanan oldun. Hediyen hesabına tanımlandı.

Kaybetme Mesajı:

Bu kez kazanamadın 😔 Katılım için 1 CG harcandı. Yeni yarışmalarda şansını dene!

Kısa SQL İskeleti (paste-ready)
-- Winners benzersizliği
ALTER TABLE contest_winners
  ADD CONSTRAINT PK_contest_winner PRIMARY KEY (contest_id, rank);

-- Submission tek deneme (istenirse)
-- CREATE UNIQUE INDEX UX_submission_once ON contest_submissions(contest_id, user_id);

-- Sonuç ENUM kısıtı
ALTER TABLE contest_submissions
  ADD CONSTRAINT CHK_submission_result CHECK (result IN ('PENDING','WIN','LOSE'));


SP (özet akış)

-- sp_process_submission @contest_id, @user_id, @answer_hash, @idempotency_key
-- 1) 1 CG kes (idempotent JOIN_CONTEST)
-- 2) submission kaydı oluştur
-- 3) doğru mu? evet ise rank ata; değilse LOSE
-- 4) COMMIT

Güvenlik / Anti-Abuse

App Check / Device Check, kullanıcı başı rate-limit.

Server time tek otorite (istemci saatine güvenme).

Doğru cevap asla açık metin tutma (salted hash).

DDOS: Queue arkasına alındığı için API hafif.





1) Hedefler (Özet)

Tek altyapı: FCM (Android, iOS, Web). APNs, FCM üzerinden sürülür.

Tam kapsam: Transaksiyonel (OTP, cüzdan, yarışma, sipariş), pazarlama (kampanya), sistem (sürüm, bakım), in-app mesaj + inbox.

Segmentleme: kullanıcı özellikleri, ilgi alanı, lokasyon, dil, cihaz türü, app sürümü.

Doğru tıklama: derin-bağlantı (deeplink), etkileşim butonları, sessiz push → UI güncelleme.

Uyumluluk: iOS 13+ izin akışı, Android 13+ izinleri, sessiz saat, KVKK/GDPR tercihleri.

2) İstemci (Flutter) – Kurulum ve En İyi Pratikler
2.1 Paketler

firebase_core, firebase_messaging, flutter_local_notifications, (opsiyonel) firebase_analytics.

2.2 İzin ve Token Yaşam Döngüsü

Android 13+: runtime POST_NOTIFICATIONS izni göster.

iOS: izin diyaloğunu bağlam içinde tetikle (ilk açılışta değil).

Token kaydı: her yenilendiğinde Firestore’a yaz.

Tercihler: kullanıcının bildirim kategorisi ve “sessiz saat” ayarlarını sakla.

final fcm = FirebaseMessaging.instance;

Future<void> initPush() async {
  // iOS izinleri
  await fcm.requestPermission(alert: true, badge: true, sound: true);

  // Android 13+ (isteğe bağlı: permission_handler ile)
  // await Permission.notification.request();

  // Token
  final token = await fcm.getToken();
  await saveToken(token);

  FirebaseMessaging.instance.onTokenRefresh.listen(saveToken);

  // Foreground mesaj -> local notification
  FirebaseMessaging.onMessage.listen(showLocal);

  // Background/terminated → tıklayıp gelinen deeplink’i yakala
  final initMsg = await fcm.getInitialMessage();
  if (initMsg != null) handleDeeplink(initMsg.data);
}

Future<void> saveToken(String? t) async {
  if (t == null) return;
  // /users/{uid}/fcmTokens/{token}
  await FirebaseFirestore.instance
    .collection('users').doc(uid)
    .collection('fcmTokens').doc(t).set({
      'platform': Platform.isIOS ? 'ios' : Platform.isAndroid ? 'android' : 'web',
      'locale': ui.window.locale.toLanguageTag(),
      'appVersion': appVersion,
      'lastSeenAt': FieldValue.serverTimestamp(),
      'enabled': true, // kullanıcı tercihleri
    }, SetOptions(merge: true));
}

2.3 Yerel Bildirim & Kanallar (Android)

Kanal: app-default (genel), txn (transaksiyonel), marketing (kampanya), alerts (kritik).

Importance: HIGH (txn/alerts), DEFAULT (genel), LOW (arka plan sessiz).

2.4 Deeplink Standartları

Şema: app://route?key=val (örn. app://wallet/tx?id=..., app://contest?id=..., app://promo?id=...)

Her push data içinde deeplink olsun; yoksa güvenli fallback: ana ekran.

2.5 Sessiz Push (UI yenileme)

content-available=1 (iOS) / sadece data mesaj (Android) ile badge, unread, feed refresh.

3) Backend – Mimari

Gönderici servis: Node.js (Firebase Admin SDK), App Service üzerinde.

Kuyruk: Azure Service Bus (campaign/transactional).

Zamanlayıcı: Azure Functions (Timer) – kampanya ve hatırlatıcılar.

Kişiselleştirme: Segment sorguları Firestore/SQL’den (ör. aktif ülke=TR, ilgi=“spor”, min appVersion).

Idempotency: notification_id + dedupKey (collapse_key).

3.1 Veri Modeli (öneri)
/users/{uid}
  prefs.notifications: {
    all: true,
    marketing: true,
    transactional: true,
    quietHours: { start: "22:00", end: "08:00", tz: "Europe/Istanbul" }
  }

/users/{uid}/fcmTokens/{token}
  { platform, locale, appVersion, enabled, lastSeenAt }

/inbox/{uid}/messages/{msgId}
  { title, body, deeplink, type, createdAt, read: false, expiresAt }

/topics/{topicId}
  meta: { name:'istanbul', type:'geo' | 'interest' | 'system' }

3.2 Konu/Segment Stratejisi

Topics (otomatik abone): geo.TR, geo.TR.34.istanbul, interest.sports, app.vX, system.critical.

Direct tokens: transaksiyonel (OTP, cüzdan, sipariş, yarışma sonucu).

User group: backend, token listesi + rate limit ile fan-out.

4) Mesaj Tipleri (Standart)

Transactional (yüksek öncelik): OTP, cüzdan, sipariş, yarışma sonucu.

Operational/Alert: bakım, güvenlik bildirimi.

Marketing/Campaign: kampanya, sponsorluk (kullanıcı onayı şart).

Reminder: sepet hatırlatma, son gün bildirimleri.

Silent: veri yenileme, badge güncelleme, inbox preload.

5) Gönderim API (Node.js – örnekler)
5.1 Tekil Token (Transactional)
import admin from 'firebase-admin';
export async function sendTxn(token: string, title: string, body: string, deeplink: string) {
  await admin.messaging().send({
    token,
    android: {
      priority: 'high',
      notification: { channelId: 'txn', title, body },
      data: { deeplink, type: 'TXN' }
    },
    apns: {
      headers: { 'apns-priority': '10' },
      payload: {
        aps: { alert: { title, body }, sound: 'default' },
        deeplink, type: 'TXN'
      }
    }
  });
}

5.2 Topic (Segment)
export async function sendTopic(topic: string, title: string, body: string, deeplink: string) {
  await admin.messaging().send({
    topic,
    android: {
      priority: 'high',
      notification: { channelId: 'marketing', title, body },
      data: { deeplink, type: 'MKT' }
    },
    apns: {
      headers: { 'apns-priority': '10' },
      payload: { aps: { alert: { title, body }, sound: 'default' }, deeplink, type:'MKT' }
    }
  });
}

5.3 Sessiz (data-only)
await admin.messaging().send({
  token,
  android: { priority: 'high', data: { type: 'SILENT', action: 'REFRESH_FEED' } },
  apns: { headers: { 'apns-push-type': 'background', 'apns-priority': '5' },
          payload: { aps: { 'content-available': 1 }, type:'SILENT', action:'REFRESH_FEED' } }
});


collapse_key / dedup: kampanyalarda aynı collapse_key kullan; son mesaj görünür, eskiler birikir.

6) Bildirim Aksiyonları ve Medya

Android: action buttons (örn. “Katıl”, “Daha sonra”), channel_id, priority, ttl.

iOS: category + UNNotificationAction, Notification Service Extension ile resim/gif.

Deeplink kararı: Butona göre farklı rota (örn. deeplink_action=join).

7) Inbox (In-App) ve Okunma Takibi

Her push, paralelde /inbox/{uid}/messages/{msgId} yazılır.

İstemci açınca read=true set eder; badge sayısı buradan hesaplanır.

Sessiz saat aktifse push yerine sadece inbox’a düş (veya sabah 08:00’e zamanla).

8) A/B Test – Oran Sınırlama – Kurallar

A/B: başlık/CTA/ikon varyantları, %50-50 split; tıklama-açılma ölçümü.

Rate limit: kullanıcı başı marketing ≤ 2/gün, alert ≤ 3/gün, transactional sınırsız.

Sessiz saat: 22:00–08:00 (kullanıcı TZ) → marketing bekler, transactional gider.

Tercihler: kullanıcı ayarlarında marketing kapalıysa asla gönderme.

9) Zamanlama ve Otomasyon

CRON (Azure Functions Timer): kampanya saatleri, “yarın bitiyor” hatırlatması, haftalık özet.

Event-driven: ödeme tamamlandı → sendTxn(...); yarışma sonuçlandı → win/lose push; yeni sürüm → sürüm uyarısı (min appVersion filtre).

10) Güvenlik, KVKK/GDPR

Açık onay: marketing bildirimi izni ayrı toggle.

Pref audit: tercih değişimleri loglanır (kim, ne zaman).

Token temizliği: NotRegistered/InvalidRegistration hatalarında token’ı sil.

DoH/Doze: kritik mesajlarda high priority, kısa TTL (30–120 sn) ver.

11) Test Kontrol Listesi

 Android 13+ izin akışı

 iOS izin akışı + background fetch

 Foreground/Background/Terminated senaryoları

 Deeplink rotaları (başarısızlıkta fallback)

 Kanal/Category/Action butonları

 Sessiz push ile feed/badge güncelleme

 Sessiz saat – marketing bekletme

 Token silme (geçersiz token)

 A/B raporlama (open/click)

 Rate limit ve kullanıcı tercihleri

12) Admin Panel Gereksinimleri

Segment seçici (ülke, ilgi, sürüm, platform).

Mesaj şablonları (TR/EN), placeholder’lar ({name}, {amount}, {contestId}).

Zamanlama (hemen/gün-saat), sessiz saat override (yalnızca alert/txn).

Dry-run (10 kullanıcıya test), canlıya alma, raporlama (deliver/open/click).

13) Hızlı Politika Şablonları (TR)

Transactional (cüzdan/yarışma): “Hesabında işlem var. Detay için tıkla.”

Marketing: “%20 indirim! Bugün 23:00’e kadar. Sessiz saat aktifse sabaha gönderilir.”

Silent: “Arka planda güncelleme. Uygulama açıldığında yeni içerikler hazır.”

🚀 Hızlı Kazanımlar (1–2 Sprint)

Bu sprint seti; kullanıcı etkileşimini, bildirim deneyimini ve operasyonel çevikliği artırmak için hızlı uygulanabilecek beş odaklı modülden oluşur. Her biri tek başına ölçülebilir fayda sağlar ve sistemin genel “growth & retention” metriklerine katkıda bulunur.

1️⃣ Bildirim Tercih Merkezi

Amaç: Kullanıcılara bildirim deneyimini kişiselleştirme imkânı sağlamak.
Detaylar:

Kategoriler: Transactional, Alert, Marketing — kullanıcı hangilerini almak istediğini seçer.

Sessiz saat: Kullanıcı 23:00–07:00 gibi rahatsız edilmemek istediği saatleri belirler.

Frekans limiti: Örneğin günde maksimum 3 marketing bildirimi.
Kazanç: Push izin oranı korunur, kullanıcı rahatsız edilmez, memnuniyet artar.

2️⃣ Inbox + Badge Sistemi

Amaç: Tüm push bildirimlerinin uygulama içinde kalıcı şekilde erişilebilir olmasını sağlamak.
Detaylar:

Her push bildirimi Firestore veya local DB’ye kaydedilir.

Okundu/okunmadı durumu ve toplu silme fonksiyonu eklenir.

Ana ekranda “📬” simgesi yanında dinamik badge sayacı gösterilir.
Kazanç: Kullanıcı kaçırdığı duyuruları görebilir, etkileşim oranı artar.

3️⃣ Remote Config + Duyuru Banner’ı

Amaç: Kod güncellemesine gerek kalmadan uygulama içinden global mesaj veya kampanya paylaşmak.
Detaylar:

Firebase Remote Config üzerinden “banner_text”, “banner_link”, “is_active” gibi parametreler.

Ana ekranda üstte dinamik duyuru şeridi (örneğin: “⚙️ Bakım çalışması 22:00’de başlayacak”).

Kampanya, sürüm uyarısı veya sistem durumu duyuruları için kullanılabilir.
Kazanç: Operasyonel iletişim çevikleşir, acil duyurular anında yayınlanabilir.

4️⃣ Deeplink Otomatik Test Suite

Amaç: Tüm bildirim ve e-posta bağlantılarının doğru yönlendirildiğini otomatik test etmek.
Detaylar:

Mini E2E test suite (Flutter integration_test, Cypress veya Playwright ile).

Her payload rotası (/profile, /order/:id, /contest/:id vb.) otomatik test edilir.

Geçersiz yönlendirmeler CI pipeline’da yakalanır.
Kazanç: Kullanıcı deneyimi güvence altına alınır, hatalı link’ler prod’a çıkmadan tespit edilir.

5️⃣ A/B Şablonları (Başlık – CTA – İkon Varyantları)

Amaç: Bildirim ve banner içeriklerinin performansını optimize etmek.
Detaylar:

Firestore veya Remote Config üzerinden varyantlar tutulur:

Başlık: “Kazanmaya var mısın?” vs. “Yarışma başladı!”

CTA (Call to Action): “Katıl” / “Hemen Aç” / “Detaylar”.

İkon: Emoji veya özel ikon varyasyonları.

Sistem otomatik olarak en yüksek tıklanma oranına sahip varyantı “kazanan” olarak yayına alır.
Kazanç: Pazarlama içerikleri veriye dayalı optimize edilir, CTR artar.

🤖 Kişiselleştirme & AI

Bu set, kullanıcı etkileşimini artırmak, içerik isabetini yükseltmek ve bildirim kalitesini yapay zekâ destekli hale getirmek için hazırlanmıştır. Her modül, kullanıcı davranışlarından öğrenerek sistemin zamanla daha akıllı ve hedefli çalışmasını sağlar.

1️⃣ Akıllı Gönderim Zamanı

Amaç: Bildirimlerin kullanıcıya en uygun anda iletilmesini sağlamak.
Detaylar:

Sistem, her kullanıcının geçmiş açılma/etkileşim saatlerini analiz eder.

ML modeli (ör. Firebase Predictions veya basit on-device time histogram) ile “en olası açılma saati” tahmini yapılır.

Bildirimler bu tahmine göre sıraya alınır (ör. 21:30 civarı aktif olan kullanıcıya 21:25’te push).
Kazanç: Açılma oranı (Open Rate) ve etkileşim (CTR) belirgin şekilde artar.

2️⃣ İçerik Kişiselleştirme

Amaç: Bildirim ve uygulama içi mesajlarda kullanıcıya özel dinamik metin üretmek.
Detaylar:

Placeholder değişkenleri: {ad}, {şehir}, {ilgi} vb.

Örnek: “Selam {ad}, {şehir} için yeni yarışmalar başladı!”

Dil/i18n desteği: Kullanıcının cihaz dili veya tercih ettiği dil otomatik seçilir.

Firestore veya Remote Config’te çoklu dil şablonları tutulur.
Kazanç: Mesajlar daha “insani” ve yakın hissedilir; kullanıcı bağlılığı artar.

3️⃣ Öneri Motoru Trigger’ları

Amaç: Kullanıcı davranışına göre dinamik push veya banner önerileri sunmak.
Detaylar:

Son etkileşim tipine göre segmentleme:

“Yarışma seviyor” → yeni yarışma duyurusu

“Satın alma yaptı” → özel teklif bildirimi

“Uzun süredir inaktif” → dönüş kampanyası

Event-based trigger yapısı: Firestore/Analytics event’leri tetikleyici olarak kullanılır.

Backend tarafında segment güncellemeleri periyodik (ör. Cloud Function cron) ile yapılır.
Kazanç: Doğru içeriğin doğru kullanıcıya gitmesiyle dönüşüm oranı (conversion) artar.

4️⃣ Toksisite / Spam Filtresi

Amaç: Kullanıcı tarafından üretilen içeriklerde (yorum, mesaj vb.) zararlı veya spam içerikleri önlemek.
Detaylar:

Hafif NLP modeli (on-device veya Cloud Function üzerinden) ile metin analizi yapılır.

Anahtar kelime eşleştirme + duygu analizi kombinasyonu.

Toxic score belirli bir eşiği aşarsa içerik gizlenir veya yöneticinin onayına düşer.

Model lightweight (mobil performans dostu) olarak tasarlanır.
Kazanç: Topluluk ortamı temiz, güvenli ve pozitif kalır; kullanıcı güveni artar.

Büyüme & Aktivasyon

Bu modül grubu, kullanıcı kazanımı, geri dönüş (retention) ve kampanya yönetimi süreçlerini güçlendirmeye odaklanır. Amaç; kullanıcı tabanını genişletmek, pasif kullanıcıları yeniden kazanmak ve coğrafi/lokal segmentlere uygun promosyon akışlarını otomatikleştirmektir.

1️⃣ Referans / Arkadaşını Getir Programı

Amaç: Kullanıcıları, arkadaşlarını davet ederek topluluğu organik biçimde büyütmeye teşvik etmek.
Detaylar:

Kişisel davet linki oluşturulur (ör. https://app.com/invite?ref=uid123).

Deferred Deeplink entegrasyonu sayesinde link uygulama yüklü değilse bile kayıt sonrası otomatik olarak ödüllendirir.

Davet eden kullanıcıya CringeGold (CG) veya özel rozet verilir.

Davet edilen kullanıcıya da hoş geldin bonusu tanımlanır.
Kazanç: Viral büyüme etkisi; kullanıcı başına yeni kullanıcı (K-factor) artışı.

2️⃣ Geri Kazanım Akışları

Amaç: Uzun süredir pasif kalan kullanıcıları tekrar aktive etmek.
Detaylar:

7 gün / 30 gün pasif olan kullanıcılar için otomatik “geri kazanım” serileri oluşturulur.

Her seri:

1️⃣ Gün → Inbox mesajı (“Seni özledik! Yeni yarışmalar seni bekliyor 🎯”)

3️⃣ Gün → Push bildirimi (“Yeni bonus seni bekliyor 💎”)

5️⃣ Gün → Teklif bildirimi (“Bugün dön, ekstra 5 CG kazan!”)

Tüm iletişimler in-app inbox + push kombinasyonuyla gönderilir.
Kazanç: Pasif kullanıcı dönüş oranı artar, churn (kaybetme) oranı düşer.

3️⃣ Coğrafi Segmentler

Amaç: Kampanyaları şehir veya ülke bazında hedefleyerek daha anlamlı içerikler sunmak.
Detaylar:

Kullanıcılar konum (şehir/ülke) bilgisinden otomatik olarak topic subscription alır.

Örnek:

“istanbul_campaigns” → sadece İstanbul kullanıcılarına özel etkinlik.

“de_trending” → Almanya’daki kullanıcılar için özel push.

Firebase Cloud Messaging (FCM) topic bazlı dağıtım ile optimize edilir.
Kazanç: Lokasyon bazlı ilgililik (relevance) artar, kampanyaların verimliliği yükselir.

4️⃣ Kampanya Takvimi

Amaç: Tüm pazarlama kampanyalarını görsel takvim üzerinden planlamak ve çakışmaları önlemek.
Detaylar:

Yönetim paneline takvim görünümü eklenir (ör. haftalık / aylık görünüm).

Kampanya tarihleri, hedef segmenti ve ödül türü takvimde gösterilir.

Aynı tarih aralığında benzer segmenti hedefleyen kampanyalarda çakışma uyarısı çıkar.

Takvim, Firestore’daki campaigns koleksiyonundan canlı veri çeker.
Kazanç: Ekip içi koordinasyon güçlenir; kullanıcıya aynı anda fazla bildirim gitmesi önlenir.

Güvenilirlik & Teslimat

Bu modül grubu, bildirim altyapısının sürekliliğini, doğruluğunu ve izlenebilirliğini garanti altına alır. Amaç, her bildirimin güvenli biçimde kullanıcıya ulaşmasını sağlarken; sistemin kendi sağlığını otomatik olarak koruyabilmesidir.

1️⃣ İkincil Sağlayıcı Failover (Opsiyonel)

Amaç: Firebase Cloud Messaging (FCM) servisinde yaşanabilecek kesintilerde bildirimlerin kaybolmasını önlemek.
Detaylar:

Ana servis FCM; alternatif olarak OneSignal veya custom gateway tanımlanır.

Bildirimler kuyrukta tutulur (ör. Firestore Queue veya Pub/Sub).

FCM başarısız olursa sistem 3 kez tekrar dener; gerekirse ikincil sağlayıcıya yönlendirir.

Failover işlemi asenkron ve idempotent olacak şekilde tasarlanır.
Kazanç: Yüksek erişilebilirlik (HA) ve minimum bildirim kaybı sağlanır.

2️⃣ Oran Sınırlama (Rate Limiting)

Amaç: Spam veya yoğun gönderim nedeniyle sistemin ya da kullanıcı deneyiminin zarar görmesini engellemek.
Detaylar:

Kullanıcı başı limit:

Günlük: örn. 20 push

Haftalık: örn. 100 push

Global throttle: Dakikada X’den fazla bildirim çıkışı varsa kuyruklama yapılır.

Redis veya Firestore counter tabanlı limit takibi.
Kazanç: Performans stabil kalır, kullanıcılar spam etkisinden korunur.

3️⃣ Sağlık Panosu (Delivery Health Dashboard)

Amaç: Bildirim gönderim performansını anlık olarak izlemek ve anormalliklerde uyarı üretmek.
Detaylar:

Gönderilen, teslim edilen, okunan ve tıklanan bildirim metrikleri izlenir.

Başarısızlık oranı, gecikme süresi, CTR (click-through-rate) ve hata kodları görselleştirilir.

Uyarı eşikleri (ör. teslim oranı < %80) aşıldığında Slack veya e-posta bildirimi gönderilir.

Veriler BigQuery veya Firestore Analytics tabanlı toplanabilir.
Kazanç: Anlık görünürlük artar, operasyon ekibi hızlı müdahale edebilir.

4️⃣ Token Hijyen Botu

Amaç: Geçersiz veya kullanılmayan cihaz token’larını otomatik temizleyerek sistem verimliliğini artırmak.
Detaylar:

FCM dönüşlerinde gelen hata kodları (NotRegistered, InvalidRegistration) analiz edilir.

Bu token’lar günlük cron job ile temizlenir.

Gerekiyorsa kullanıcıya yeniden kayıt bildirimi (re-subscribe prompt) gönderilir.

Otomatik işlem, manuel log kaydıyla denetlenir.
Kazanç: Veri tabanı şişmesi ve başarısız gönderim oranı azalır; sistem daha hızlı çalışır.

Operasyon & Uyumluluk

Bu modül grubu, bildirim altyapısının yasal uygunluğunu (KVKK/GDPR), iç denetim izlenebilirliğini ve operasyonel kontrol mekanizmalarını güçlendirir.
Amaç: hem kullanıcı verilerinin gizliliğini korumak hem de ekip içi süreçleri denetlenebilir ve geri alınabilir hale getirmektir.

1️⃣ KVKK / GDPR Logları

Amaç: Kullanıcıların açık rıza durumlarını, onay değişikliklerini ve iletişim tercihlerini mevzuata uygun şekilde izlemek.
Detaylar:

Açık rıza kayıtları: consent_logs koleksiyonunda tarih, yöntem (in-app / web / email), IP ve versiyon bilgisiyle saklanır.

Değişiklik geçmişi: Her “rıza geri çekme” işlemi için timestamp + önce/sonra kayıt tutulur.

Kampanya dışı bastırma listesi (Suppression List): Bildirim almak istemeyen kullanıcılar otomatik hariç tutulur.

Veriler 2 yıl süreyle arşivlenir (kanuni süre).
Kazanç: KVKK ve GDPR uyumu sağlanır; olası denetimlerde tam şeffaflık sunulur.

2️⃣ Rol & Yetki Yönetimi

Amaç: Bildirim gönderim sürecinde yetkisiz erişim ve hatalı gönderimleri engellemek.
Detaylar:

Roller:

Marketing: sadece kampanya push’ları oluşturabilir.

System: yalnızca işlem/uyarı (txn/alert) tipi push atabilir.

SuperAdmin: tüm tiplerde gönderim yapabilir, loglara erişebilir.

Onay akışı:

Marketing gönderileri yayına alınmadan önce “System Owner” onayına düşer.

Onay geçmişi, Firestore approval_logs tablosunda saklanır.
Kazanç: Yetkisiz işlem riski azalır, iç operasyon denetimi güçlenir.

3️⃣ Şablon Versiyonlama

Amaç: Tüm bildirim metinlerinin onaylı, izlenebilir ve geri alınabilir bir biçimde yönetilmesi.
Detaylar:

Şablonlar (template_library) versiyonlu olarak tutulur.

Her değişiklikte: kim değiştirdi, ne değişti, önceki versiyon hash bilgisi kaydedilir.

Onaylı versiyon dışındaki şablonlar canlıda kullanılamaz.

Gerektiğinde “rollback” işlemiyle önceki versiyon yeniden aktif edilir.
Kazanç: Metin hataları, yasal uygunsuzluklar ve yanlış gönderim riskleri minimize edilir.

4️⃣ Olay Günlüğü (Audit Trail)

Amaç: Gönderim süreçlerinde kim, neyi, kime, ne zaman gönderdi sorularına yanıt verebilecek tam denetim izi oluşturmak.
Detaylar:

Her gönderim kaydı şu alanlarla tutulur:

sender_id, recipient_id, template_id, timestamp, channel_type (push/inbox), status.

Audit kayıtları immutable (değiştirilemez) formatta (ör. WORM storage veya append-only log).

Denetim paneli üzerinden arama ve filtreleme yapılabilir (tarih, kullanıcı, şablon bazlı).
Kazanç: Tam izlenebilirlik; hem iç güvenlik hem regülasyon denetimleri kolaylaşır.


Uygulama İçi Deneyimi Zenginleştirme

Bu modül grubu, kullanıcıya sadece bildirim göndermekle kalmayıp, uygulama içinde etkileşimi artıracak görsel ve etkileşimli öğelerle deneyimi güçlendirir. Amaç: kullanıcıyı daha fazla “uygulama içinde tutmak”, içeriklere daha hızlı yönlendirmek ve aksiyon oranını (engagement) artırmaktır.

1️⃣ In-App Modal / Banner / Tooltip

Amaç: Push bildirimi beklemeden kullanıcıya doğrudan uygulama içinden mesaj göstermek.
Detaylar:

Trigger: belirli olaylar (ör. oturum açma, görev tamamlama, süre dolumu, yeni sürüm).

Tipler:

Modal: tam ekran, güçlü etki (ör. yeni özellik tanıtımı).

Banner: üst/alt şerit, düşük dikkatli ama sürekli görünür duyurular.

Tooltip: belirli UI öğeleri üzerine kısa açıklama veya yönlendirme.

Firebase Remote Config veya AppCheck tabanlı dinamik tetikleme kullanılabilir.
Kazanç: Push beklenmeden kullanıcı yönlendirmesi yapılır; deneyim akıcı ve anlık hale gelir.

2️⃣ Zengin Medya (Rich Media Notifications)

Amaç: Bildirimlerde görsel öğeler kullanarak daha dikkat çekici ve marka uyumlu mesajlar iletmek.
Detaylar:

Desteklenen içerikler:

Resim / GIF (Android & iOS)

Büyük ikon (Uygulama markasına göre boyutlandırılmış)

iOS Notification Service Extension: görsel içeriği arka planda indirip push içinde gösterir.

Boyut ve optimizasyon kuralları:

Maks. 300 KB

16:9 oranı, PNG/JPEG öncelikli

Yedek fallback ikon.
Kazanç: Açılma oranları (Open Rate) artar, marka algısı güçlenir.

3️⃣ Aksiyon Butonları (Quick Actions)

Amaç: Kullanıcının bildirimden veya modalden çıkmadan tek tıkla işlem yapabilmesini sağlamak.
Detaylar:

Buton türleri: “Hemen Katıl”, “Kaydet”, “Reddet”, “Daha Sonra Hatırlat”.

Push & In-App ortak altyapı: FCM payload içinde action_type ve target_url alanları.

Tek tık iş akışı: kullanıcı butona bastığında API çağrısı tetiklenir, arka planda yanıt alınır.

Analitik: Her butonun tıklanma oranı (CTR) ayrı ölçülür.
Kazanç: Kullanıcı adımı azalır, dönüşüm oranı yükselir; etkileşim süreçleri hızlanır.


Monetizasyon & Sponsor Entegrasyonu

Bu modül grubu, bildirim altyapısını yalnızca etkileşim aracı olmaktan çıkarıp gelir üreten bir kanala dönüştürür.
Amaç: etik sınırlar içinde sponsorluk, promosyon ve ödül tabanlı teşvikleri bildirim sistemine entegre ederek hem kullanıcıya hem markaya fayda sağlamaktır.

1️⃣ Sponsor Slotları

Amaç: Bildirim ve inbox alanlarında sponsorlu içerikleri düzenli, ölçülebilir ve şeffaf şekilde göstermek.
Detaylar:

Slot yapısı:

sponsored_banner_top: inbox üstü alan.

sponsored_push: “Sponsorlu” etiketiyle gelen özel push bildirimi.

Etik sınırlar:

Günlük maksimum 1 sponsorlu içerik.

“Sponsorlu içeriktir” ibaresi zorunlu.

Raporlama: Tıklanma (CTR), gösterim (Impression) ve sponsor başına performans metriği.
Kazanç: Uygulama gelir modeli çeşitlenir; kullanıcıya uygun markalarla görünürlük sağlanır.

2️⃣ Kupon / Promocode Akışı

Amaç: Bildirimden uygulama içi satın alma veya kampanya akışına hızlı geçiş sağlamak.
Detaylar:

Push bildirimi deeplink ile kupon ekranına yönlendirir (/coupons/{id}).

Uygulama açıldığında kupon otomatik olarak kullanıcı hesabına eklenir.

Kupon aktivasyonu Firestore promo_codes koleksiyonunda işlenir.

Kullanım limitleri, tarih aralıkları ve segment bazlı erişim kontrolü bulunur.
Kazanç: Kampanya dönüşümleri hızlanır, kullanıcı alışkanlığı oluşur.

3️⃣ CG Tabanlı Teşvik (CringeGold Entegrasyonu)

Amaç: Bildirim etkileşimini oyunlaştırmak ve kullanıcıyı hızlı aksiyona yönlendirmek.
Detaylar:

Push bildirimi: “İlk katılan 50 kullanıcıya 1 CG bonus!”

Sistem, ilk X kullanıcıyı “timestamp ascending” sıralamasına göre belirler.

CG ödülü Firestore wallet_transactions koleksiyonuna otomatik eklenir.

Günlük toplam CG dağıtımı için üst limit (ör. 100 CG/gün) uygulanır.

Abuse engeli: aynı cihaz veya IP’den tekrarlı katılımlar engellenir.
Kazanç: Katılım motivasyonu artar, CringeGold ekosistemine canlılık kazandırır.


Geliştirici Deneyimi

Bu modül grubu, bildirim altyapısının geliştirici tarafındaki kullanım kolaylığını, test edilebilirliğini ve gözlemlenebilirliğini artırır.
Amaç: hızlı deneme, güvenli dağıtım ve standart telemetri ile geliştiricinin bildirim yaşam döngüsünü yönetmesini kolaylaştırmaktır.

1️⃣ Sandbox Gönderim

Amaç: Gerçek kullanıcıları etkilemeden bildirim sistemini test edebilmek.
Detaylar:

Sandbox Mode: yalnızca “test kullanıcıları” segmentine bildirim gönderir.

is_sandbox: true flag’i payload içinde iletilir; prod kuyruğuna düşmez.

Admin panelinde “Gönder (Sandbox)” ve “Gönder (Prod)” olmak üzere iki ayrı buton.

Prod ortamı yalnızca SuperAdmin yetkisine sahip kullanıcılarca erişilebilir.
Kazanç: Geliştirme/test süreçleri hızlanır, yanlış gönderim riski sıfıra iner.

2️⃣ CLI / SDK Araçları

Amaç: Bildirim gönderim, test ve analiz işlemlerini otomasyona bağlamak.
Detaylar:

CLI komut seti:

send-txn: işlem bildirimleri (ör. para transferi, ödül).

send-topic: segment bazlı gönderim.

send-silent: kullanıcı arayüzü göstermeyen arka plan bildirimi.

Komutlar JSON şablonlardan çalışır (templates/*.json).

SDK versiyonu (Node.js & Dart) aynı API’leri expose eder:

npx cringe-cli send-topic --topic=contest --template=win_alert.json


Kazanç: Geliştiriciler manuel panele ihtiyaç duymadan komut satırından test ve gönderim yapabilir.

3️⃣ Telemetry Kancaları (Analytics Hooks)

Amaç: Tüm bildirim yaşam döngüsünde (gönderim, açılma, tıklama) merkezi analiz standardı sağlamak.
Detaylar:

Tek tip event API:

analytics.logPushEvent({
  type: "open" | "click",
  templateId: "...",
  userId: "...",
  timestamp: ...
});


FCM onMessage ve onBackgroundMessage event’leri içine otomatik entegre.

Eventler Firestore → BigQuery pipeline’ına akar; dashboard üzerinden görselleştirilir.
Kazanç: Bildirimlerin performansı ve kullanıcı tepkisi tam olarak ölçülebilir hale gelir.

CringeGold (CG) Dönüşüm Politikası

Tanım:
CringeGold (CG), uygulama içi etkinlikler, yarışmalar veya görevler aracılığıyla kazanılabilen sanal bir ödül birimidir. CG, gerçek para karşılığı alınabilse de, nakit olarak geri çevrilebilirliği yalnızca uygulama içi kazanımlar için geçerlidir.

Politika Kuralları:

Satın Alınan CG’ler:

Gerçek para ile satın alınan CG bakiyeleri nakde çevrilemez.

Bu bakiyeler yalnızca uygulama içi kullanım (yarışma katılımı, mağaza harcaması, özel içerik erişimi vb.) için geçerlidir.

Kazanılan CG’ler:

Yarışmalar, etkinlikler, görevler veya promosyonlarla elde edilen CG’ler nakite dönüştürülebilir.

Dönüşüm oranı ve alt limitler sistem tarafından belirlenir (örneğin: 1000 CG = 100 ₺).

Kimlik doğrulama (KYC) adımı tamamlanmadan ödeme yapılmaz.

Transfer ve Denetim:

CG transferleri yalnızca uygulama içi kullanıcılar arasında ve belirlenmiş sınırlar dahilinde yapılabilir.

Şüpheli işlemler (çoklu hesap, haksız kazanç) sistem tarafından dondurulur ve denetlenir.


Market / Ekonomi / CG Tabanlı Sistem

Bu modül, CringeGold (CG) ekonomisinin kullanıcı, marka ve uygulama arasında dengeli bir değer döngüsü oluşturmasını sağlar.
Amaç: kullanıcı katılımını ödüllendirmek, markalara sponsorluk fırsatı sunmak ve sistemin sürdürülebilir gelir modeliyle desteklenmesini sağlamaktır.

1️⃣ CG Cüzdanı

Amaç: Kullanıcının CG bakiyesini, kazançlarını ve harcamalarını merkezi bir yapıdan yönetmek.
Detaylar:

Cüzdan verileri Firestore veya SQL tabanlı wallet_transactions tablosunda tutulur.

Her işlem için: amount, type (earn/spend/transfer), source, timestamp, ref_id.

Transfer özelliği: kullanıcılar CG’yi birbirine gönderebilir (anti-abuse limitleriyle).

Otomatik bakiye senkronizasyonu ve güvenli API erişimi (JWT + AppCheck).
Kazanç: Finansal şeffaflık artar, kullanıcı CG ekonomisinde aktif rol oynar.

2️⃣ Market Alanı

Amaç: Kullanıcıların CG ile dijital öğeler satın alabilmesini sağlamak.
Detaylar:

Market kategorileri:

🎨 İkonlar ve Efektler (profil temaları, arayüz animasyonları)

🏅 Premium Rozetler (profil görünürlüğü, statü göstergesi)

CG fiyatlandırması dinamik: item değeri talep ve nadirliğe göre belirlenebilir.

Market API’si: GET /market/items, POST /purchase/:id.

Satın alımlar “geri alınamaz” (non-refundable) statüsünde işlenir.
Kazanç: CG’nin uygulama içi dolaşımı artar, kullanıcı deneyimi kişiselleşir.

3️⃣ Sponsor Ödül Havuzu

Amaç: Markaların kampanya veya yarışmalara CG veya fiziksel ödül koyabilmesini sağlamak.
Detaylar:

Sponsorlar için yönetici panelinde “ödül ekle” modülü.

Ödül türleri: CG, kupon, indirim, hediye ürün.

Sponsor katkısı, etkinlik başına tanımlanır (event_prize_pool).

Sistem kazananları belirledikten sonra ödül dağıtımı 15 dk içinde otomatik yapılır.
Kazanç: Markalar görünürlük kazanır, kullanıcılar gerçek değere sahip ödüllerle motive olur.

4️⃣ CG Değer Dinamikleri

Amaç: Ekonomiye rekabet, istikrar ve şeffaflık kazandırmak.
Detaylar:

Haftalık lider tablosu: en çok CG kazanan, harcayan, transfer eden kullanıcılar.

İstatistik ekranı: toplam dolaşımdaki CG miktarı, dağıtım oranları, en aktif kullanıcılar.

CG’nin iç değeri (örn. 1 CG ≈ 0.10 ₺) yalnızca kazanılan CG’ler için geçerli.

Otomatik güncelleme cron job’larıyla haftalık bazda yenilenir.
Kazanç: Kullanıcı motivasyonu artar, ekonomi oyunlaştırılır.

AI & Kişiselleştirme Özellikleri

Bu modül grubu, kullanıcı davranışlarını öğrenen, içerikleri anlamlandıran ve etkileşimi kişiye özel hale getiren yapay zekâ altyapısını tanımlar.
Amaç: sistemin kullanıcıyı “tanıyan”, bağlama göre öneri sunan, içerik üreten ve güvenli ortam sağlayan bir yapıya dönüşmesini sağlamaktır.

1️⃣ AI Öneri Motoru

Amaç: Kullanıcının geçmiş etkileşimlerine göre içerik, yarışma veya arkadaş önerileri sunmak.
Detaylar:

Kullanıcı davranışlarını (beğeniler, aramalar, tıklamalar, katılım geçmişi) analiz eder.

ML model (ör. Firebase ML, TensorFlow Lite veya OpenAI Embeddings) ile benzer kullanıcı kümeleri oluşturur.

Öneri tipleri:

🎯 Yarışma önerisi (“Senin ilgi alanına göre yeni bir yarışma var.”)

👥 Arkadaş önerisi (benzer ilgi veya CG geçmişine göre).

📰 İçerik önerisi (önceden okunan veya görüntülenen içeriklere benzer).
Kazanç: Etkileşim süresi artar, kullanıcı uygulamada daha fazla vakit geçirir.

2️⃣ Sesli Asistan / Chatbot

Amaç: Kullanıcıyla doğal dille iletişim kurarak görevleri hatırlatmak, yarışmalara yönlendirmek veya uygulama içi rehberlik yapmak.
Detaylar:

Sesli komut sistemi (Speech-to-Text + Text-to-Speech).

Chatbot kişiliği: uygulamanın temasına uygun, sıcak ve yardımcı bir ton.

İşlevler:

“Bugün aktif yarışma var mı?” → yarışma listesi.

“Bana CG bakiyemi söyle.” → cüzdan verisi.

“Yeni görev var mı?” → görev ekranına yönlendirme.
Kazanç: Uygulama erişilebilirliği artar, kullanıcı deneyimi daha etkileşimli hale gelir.

3️⃣ AI Moderasyon

Amaç: Topluluk ortamını güvenli tutmak için spam, toksik veya uygunsuz içerikleri otomatik tespit etmek.
Detaylar:

NLP tabanlı içerik analizi (OpenAI Moderation API, TensorFlow Text).

On-device “light” model ile hızlı tespit; yüksek riskli içerikler Cloud Function üzerinden yeniden değerlendirilir.

Tespit edilen içerikler anında gizlenir veya moderatör onayına düşer.

Kapsam: metin, yorum, kullanıcı adı, profil açıklaması.
Kazanç: Güvenli ve saygılı topluluk ortamı korunur; manuel denetim yükü azalır.

4️⃣ AI İçerik Üretici

Amaç: Kullanıcıların içerik oluşturma sürecini kolaylaştırmak ve kaliteyi yükseltmek.
Detaylar:

Yazım ve dilbilgisi düzeltme.

Otomatik başlık ve etiket önerisi (ör. “#teknoloji”, “#yarışma”).

Uzun metinleri özetleme ve görsel önerisi (ör. OpenAI GPT + DALL·E API).

Gönderi oluşturma ekranına entegre “AI ile tamamla” butonu.
Kazanç: Üretkenlik artar, platformdaki içerik kalitesi yükselir.

5️⃣ Akıllı Arama

Amaç: Kullanıcıya semantik anlayışla doğru sonuçları sunmak; yalnızca kelime eşleşmesine değil, anlam benzerliğine dayalı sonuçlar üretmek.
Detaylar:

Semantic search modeli (embeddings tabanlı).

Kullanıcı sorgularını ilgi alanı, geçmiş etkileşim ve trend verileriyle birleştirir.

Arama önerileri: “Sık aranan”, “Senin için önerilen” gibi dinamik filtreler.
Kazanç: Arama sonuçları daha anlamlı ve kişisel hale gelir; kullanıcı hedef içeriğe daha hızlı ulaşır.

Paylaşımda Konum Ekleme (Açıklama)

Kullanıcılar, CringeBank uygulamasında paylaşım yaparken isteğe bağlı olarak gönderilerine konum ekleyebilirler. Bu özellik, paylaşımlara yerel bağlam kazandırır ve “yakınımdakiler”, “şehir bazlı trendler” gibi konum odaklı keşif akışlarının oluşturulmasını mümkün kılar.

Kullanım:
Konum ekleme tamamen isteğe bağlıdır. Kullanıcı “Konum ekle” seçeneğine bastığında, cihaz konum izni ister veya manuel arama ile yer seçimine izin verir.

Gizlilik:
Paylaşılan konumlar yalnızca kullanıcı onayıyla eklenir ve veriler KVKK uyumlu şekilde saklanır. Tam adres bilgisi değil, yalnızca şehir/mahalle düzeyinde anonimleştirilmiş koordinatlar tutulur. Kullanıcı dilerse konumu gizleyebilir veya yalnızca “şehir görünür” modunda paylaşabilir.

Veri Modeli:
Her gönderi, location alanında şu bilgileri içerebilir:
{ enabled: true, name: "İstanbul, Beyoğlu", lat: 41.025, lng: 28.974, visibility: "public|city_only|hidden" }.

Güvenlik & Moderasyon:
Konum paylaşımı suistimale karşı korumalıdır; aynı kullanıcının kısa sürede farklı şehirlerde paylaşım yapması durumunda sistem konum doğrulama kontrolü uygular. Tüm konumlu içerikler AI moderasyon pipeline’ından geçer.

Keşif:
Kullanıcılar “Yakınımdakiler” sekmesinde kendilerine yakın paylaşımları görebilir. Şehir veya ülke bazında filtreleme yapılabilir.

Teknoloji:
Harita ve konum servisleri için Google Maps SDK veya Mapbox kullanılabilir.
Konum çözümlemesi (reverse geocoding) sunucu tarafında yapılır ve sonuçlar cache’de saklanır.

💬 Özet:
CringeBank kullanıcıları, ister GPS ile ister manuel olarak, gönderilerine konum ekleyebilir. Bu özellik tamamen isteğe bağlıdır, KVKK uyumludur ve hem kullanıcı deneyimini hem de topluluk etkileşimini artırır.